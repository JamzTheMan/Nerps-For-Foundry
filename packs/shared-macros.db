{"_id":"09jRisijG5AwDbG4","name":"24 - T02 - Fire Shield 2","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myFireField\",\r\n    shieldType: 1,\r\n    gridPadding: 2,\r\n    color: 0xE58550,\r\n    time: 0,\r\n    blend: 2,\r\n    intensity: 1.2,\r\n    lightAlpha: 1,\r\n    lightSize: 0.7,\r\n    scale: 1,\r\n    radius: 1,\r\n    chromatic: false,\r\n    discardThreshold: 0.5,\r\n    alphaDiscard: true,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.world.token-magic-dev.WdxUWiUJALQVSO81"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"name":"26 - T02 - Mantle of Madness (liquid)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"liquid\",\r\n    filterId: \"myMantle\",\r\n    color: 0x0090FF,\r\n    time: 0,\r\n    blend: 5,\r\n    intensity: 0.0001,\r\n    spectral: false,\r\n    scale: 7,\r\n    animated :\r\n    {\r\n       time : \r\n       { \r\n          active: true, \r\n          speed: 0.0015, \r\n          animType: \"move\" \r\n       },\r\n       intensity : \r\n       { \r\n          active: true, \r\n          animType: \"syncCosOscillation\",\r\n          loopDuration: 30000,\r\n          val1: 0.0001, \r\n          val2: 4 \r\n       },\r\n       scale: \r\n       { \r\n          active: true, \r\n          animType: \"syncCosOscillation\",\r\n          loopDuration: 30000,\r\n          val1: 7, \r\n          val2: 1 \r\n       }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.8nsxKDYhS1Wcc139"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"0KmP9BhuSRqgjkPX"}
{"_id":"15igeFeBqnhyydKN","name":"35 - T02 - Chromatic Fire (xfire)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"xfire\",\r\n    filterId: \"myChromaticXFire\",\r\n    time: 0,\r\n    blend: 2,\r\n    amplitude: 1.1,\r\n    dispersion: 0,\r\n    chromatic: true,\r\n    scaleX: 1,\r\n    scaleY: 1,\r\n    inlay: false,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: -0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.9FRCMHBW6OsUXDwz"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"name":"24 - T06 - Air Bubble 2","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myAirField\",\r\n    shieldType: 6,\r\n    gridPadding: 1.2,\r\n    color: 0x7090AA,\r\n    time: 0,\r\n    blend: 2,\r\n    intensity: 1,\r\n    lightAlpha: 0,\r\n    lightSize: 0,\r\n    scale: 1,\r\n    radius: 1,\r\n    chromatic: false,\r\n    discardThreshold: 0.1,\r\n    alphaDiscard: true,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.etT28F5qKw6PpXq5"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"1PfO026rhHQP1lCZ"}
{"name":"F - 05 - Import FX Presets (URL)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// Replace the dummy url with a valid url that points to a Token Magic FX presets file (json)\r\n// Open the console (F12) to check the state of the import\r\n// You can configure in the module option panel the \"overwrite mode on import\"\r\n\r\n// TokenMagic.importPresetLibraryFromURL(\"https://presets-to-import-url\");\r\n\r\nui.notifications.warn(\"Open this macro and read the instructions.\");","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.sZmVZvLEYmlEC1bK"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"1gFd46NYuniob3HI"}
{"name":"27 - T02 - Glacial Aura (xglow)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"zapshadow\",\r\n    filterId: \"myGlacialZapShadow\",\r\n    alphaTolerance: 0.50\r\n},\r\n{\r\n    filterType: \"xglow\",\r\n    filterId: \"myGlacialAura\",\r\n    auraType: 1,\r\n    color: 0x5099DD,\r\n    thickness: 4.5,\r\n    scale: 3,\r\n    time: 0,\r\n    auraIntensity: 0.8,\r\n    subAuraIntensity: 0.25,\r\n    threshold: 0.5,\r\n    discard: false,\r\n    animated:\r\n    {\r\n        time : \r\n        {  \r\n           active: true,\r\n           speed: 0.0018, \r\n           animType: \"move\" \r\n        },\r\n        thickness:        \r\n        {\r\n           val1: 2, val2: 4.7,\r\n           animType: \"cosOscillation\",\r\n           loopDuration: 3000\r\n        },\r\n        subAuraIntensity:        \r\n        {\r\n           val1: 0.45, val2: 0.65,\r\n           animType: \"cosOscillation\",\r\n           loopDuration: 6000\r\n        },\r\n        auraIntensity:        \r\n        {\r\n           val1: 0.9, val2: 2.2,\r\n           animType: \"cosOscillation\",\r\n           loopDuration: 3000\r\n        }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.wdbgHdNcBwBETc1y"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"1nsjc4zp43tNlk7x"}
{"name":"24 - T05 - Mega - Chroma Shell (on top)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myEarthFieldTop\",\r\n    shieldType: 5,\r\n    gridPadding: 3,\r\n    color: 0xAAAAAA,\r\n    time: 0,\r\n    blend: 5,\r\n    intensity: 1.9,\r\n    lightAlpha: 1,\r\n    lightSize: 0.7,\r\n    scale: 1,\r\n    radius: 1,\r\n    zIndex: 5,\r\n    chromatic: true,\r\n    zOrder: 512,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.LrfXNjrImAWK5Hb2"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"3A7cSQKPpixh3p2M"}
{"name":"24 - T09 - Water Defense 2 - Ring","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myWaterField\",\r\n    shieldType: 9,\r\n    gridPadding: 1.2,\r\n    color: 0x20BBEE,\r\n    time: 0,\r\n    blend: 4,\r\n    intensity: 1,\r\n    lightAlpha: 0.7,\r\n    lightSize: 0.5,\r\n    scale: 0.6,\r\n    radius: 1,\r\n    chromatic: false,\r\n    hideRadius: 0.8,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      },\r\n      radius: \r\n       {\r\n          active: true, \r\n          loopDuration: 6000, \r\n          animType: \"cosOscillation\", \r\n          val1:1, \r\n          val2:0.8\r\n       },\r\n      hideRadius: \r\n       {\r\n          active: true, \r\n          loopDuration: 3000, \r\n          animType: \"cosOscillation\", \r\n          val1:0.6, \r\n          val2:0\r\n       }\r\n    }\r\n},{\r\n    filterType: \"liquid\",\r\n    filterId: \"myDriftLiquid\",\r\n    color: 0x002040,\r\n    time: 0,\r\n    blend: 4,\r\n    intensity: 4,\r\n    spectral: false,\r\n    scale: 1.5,\r\n    zOrder: 3000,\r\n    animated :\r\n    {\r\n       time : \r\n       { \r\n          active: true, \r\n          speed: 0.0018, \r\n          animType: \"move\" \r\n       }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.CPMuEoGlADZ4OfXv"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"3prQwgN5dZ15hAM6"}
{"name":"Roll Secret Religion","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/deity/Desna.webp","scope":"global","command":"game.PF2EToolbox.secretSkillRoll('rel')","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"5f4TMts2kOCUYVvc"}
{"name":"Stance: Point-Blank Shot","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/equipment/weapons/daikyu.webp","scope":"global","command":"const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\nif (!actors.length && game.user.character) {\n    actors.push(game.user.character);\n}\nconst ITEM_UUID = 'Compendium.pf2e.feat-effects.9HPxAKpP3WJmICBx'; // Stance: Point-Blank Shot\nconst source = (await fromUuid(ITEM_UUID)).toObject();\nsource.flags.core ??= {};\nsource.flags.core.sourceId = ITEM_UUID;\nfor await (const actor of actors) {\n    const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === ITEM_UUID);\n    if (existing) {\n        await existing.delete();\n    } else {\n        await actor.createEmbeddedDocuments('Item', [source]);\n    }\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_rws38wegmqi","path":"PC Macros#/CF_SEP/Mogo","color":"#28cc9a"}},"_id":"5hhmXyhJR3XYG9KH"}
{"name":"24 - T07 - Mage Armor","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myMageField\",\r\n    shieldType: 7,\r\n    gridPadding: 1.,\r\n    color: 0xFFFFFF,\r\n    time: 0,\r\n    blend: 4,\r\n    intensity: 0.8,\r\n    lightAlpha: 1,\r\n    lightSize: 0.45,\r\n    scale: 1,\r\n    radius: 1,\r\n    chromatic: false,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.6ZIpqLC3agLw2Vgx"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"61smbgPGdCBFoBUD"}
{"name":"Hymn of Healing","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/spells/hymn-of-healing.webp","scope":"global","command":"// Uses Turn Alert module\n\n// There should be combat started and tokens selected/targeted...\nif (game.combat === null) {\n\tui.notifications.error(\"Combat is not started, this macro only works during combat.\");\n\treturn;\n}\n\nif (game.user.targets.size > 1) {\n\tui.notifications.warn(\"You can only target a single token.\");\n\treturn;\n} else if (canvas.tokens.controlled.length > 1) {\n\tui.notifications.warn(\"You can only select a single token.\");\n\treturn;\n} else if (canvas.tokens.controlled.length < 1) {\n\tui.notifications.warn(\"You must select a token that is casting the spell.\");\n\treturn;\n}\n\n// Get source and target tokens\nconst healAmount = 4;\nconst duration = 5;\nconst source = canvas.tokens.controlled[0];\nlet target;\n\nif (game.user.targets.size !== 1) {\n\ttarget = canvas.tokens.controlled[0];\n} else {\n\ttarget = game.user.targets.values().next().value;\n}\n\n// Get the combat tracker id for the targeted token...\nlet combatant_source = game.combat.data.combatants.find(it => it.tokenId == source.id);\nif (combatant_source === undefined) {\n\tui.notifications.warn(`${target.data.name} is not in combat! They must be in combat for this macro to work.`);\n\treturn;\n}\n\n// Get the combat tracker id for the targeted token...\nlet combatant_target = game.combat.data.combatants.find(it => it.tokenId == target.id);\nif (combatant_target === undefined) {\n\tui.notifications.warn(`${target.data.name} is not in combat! They must be in combat for this macro to work.`);\n\treturn;\n}\n\n// Check if actor has acted yet or not this round and set Alert to this round if they haven't\nconst currentTurn = game.combat.turn;\nconst combatantTurn = game.combat.turns.findIndex(it => it.actor.id == target.actor.id);\nlet nextRound = (combatantTurn > currentTurn) ? 0 : 1;\n\nconst fastHealing_Alert = {\n\tname: `Spell Effect: Hymn of Healing - Fast Healing ${healAmount}`,\n\tlabel: `Spell Effect: Hymn of Healing - Fast Healing ${healAmount}`,\n\tturnId: combatant_target._id,\n\tround: nextRound,\n\tmessage: `Fast Healing ${healAmount} applied to ${target.data.name} from Hymn of Healing.`,\n\tmacro: \"Spell Effect: Hymn of Healing\",\n\targs: [target.id, combatant_source._id, healAmount, duration, 'applyFastHealing'],\n}\n\nconst sustainSpell_Alert = {\n\tname: \"Spell Effect: Hymn of Healing - Sustain Spell)\",\n\tlabel: \"Spell Effect: Hymn of Healing - Sustain Spell)\",\n\tturnId: combatant_source._id,\n\tendOfTurn: false,\n\tround: 1,\n\tmessage: `Temporary Hit Points removed from ${target.data.name} from Hymn of Healing. Sustaining the spell will reapply the effect.`,\n\tmacro: \"Spell Effect: Hymn of Healing\",\n\targs: [target.id, combatant_source._id, healAmount, duration, 'sustainSpell'],\n\tuserId: game.userId,\n}\n\nawait TurnAlert.create(fastHealing_Alert);\nawait TurnAlert.create(sustainSpell_Alert);\n\nNerps.addEffect(target.actor.id, \"Spell Effect: Hymn of Healing\");\n\nui.notifications.info(`${source.data.name} cast Hymn of Healing on ${target.data.name}.`);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"6AIWFBOQYpdrLqYR"}
{"name":"Measure Token Distances","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/tools/hand/ruler-steel-grey.webp","scope":"global","command":"// This macro will measure the distance between the selected tokens\n// and every targetted tokens within a scene.\n// It will then output the measured distances to the chat\n// If called with an argument, determines who to whisper the message to,\n// otherwise sends it as a public message\n\nvar message = \"\"\nfor (var token of canvas.tokens.controlled) {\n   let ruler = canvas.controls.ruler;\n   for (var target of game.user.targets) {\n       ruler.clear()\n       ruler.waypoints.push(token.center)\n       ruler.labels.addChild(new PIXI.Text(\"\"));\n       ruler.measure(target.center);\n       var distanceTxt = ruler.labels.children[0].text;\n       \n       \n       var distance = parseInt(distanceTxt, 10);\n       \n       var tokenHeight = token.data.elevation;\n       var targetHeight = target.data.elevation;\n       var heightDifference = Math.max(Math.abs(tokenHeight - targetHeight) - 5, 0);\n       \n       console.log(\"NERPS: \", heightDifference);\n       \n       var hypotenuse = Math.sqrt(Math.pow(distance, 2) + Math.pow(heightDifference, 2));\n       var finalDistance = Math.ceil(hypotenuse/5)*5;\n       \n       message += `From '${token.name}' to '${target.name}' : ${finalDistance} ft.<br/>`\n       ruler.clear();\n   }\n}\nif (message) {\n   const whisper = args[0] ? ChatMessage.getWhisperIDs(args[0]) : undefined;\n   ChatMessage.create({content: message, whisper});\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"combat-utility-belt":{"macroTrigger":""},"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"Measure Token Distances  ","colour":"#ff0000","trigger":""}},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"6vaZrU3P6os1DLRJ"}
{"name":"Skill Check vs DC","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"if (!actor) {\n  ui.notifications.warn(\"You must have an actor selected\");\n} else {\n\n  game.pf2e.Check.roll(\n    new game.pf2e.CheckModifier(\n      `<b>Passive Perception</b>`,\n      token.actor.data.data.attributes.perception),\n      { actor: token.actor, type: 'perception', dc: {value: 25} }, //for DC insert: , dc: {value: 30}\n      event\n      //for callback: ,(Roll) => {console.log(Roll);}\n  );\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_5lpecs4iq07","path":"Under Construction","color":"#e68600"}},"_id":"7STMzn2JQtwr0y3x"}
{"_id":"7fiHbf7EGasrXpQg","name":"35 - T05 - Black Fire (xfire)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"xfire\",\r\n    filterId: \"myBlackXFire\",\r\n    time: 0,\r\n    color: 0x707070,\r\n    blend: 11,\r\n    amplitude: 1,\r\n    dispersion: 2.2,\r\n    chromatic: false,\r\n    scaleX: 2.5,\r\n    scaleY: 2,\r\n    inlay: false,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: -0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.Zvg3xCOOPTtPH1MY"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"_id":"7n0mz3Q0vsLgpUkS","name":"Battlefield Medicine Immunity","type":"script","author":"hXcxbEK7hoL00kac","img":"tokens/Graknack.Avatar.png","scope":"global","command":"const ITEM_UUID = 'Item.bgclvpOjihqKWegn'; // Battlefield Medicine Immunity\n(async () => {\n  const effect = duplicate(await fromUuid(ITEM_UUID));\n  effect.flags.core = effect.flags.core ?? {};\n  effect.flags.core.sourceId = ITEM_UUID;\n  for await (const token of canvas.tokens.controlled) {\n    let existing = token.actor.items.find(i => i.type === 'effect' && i.data.flags.core?.sourceId === ITEM_UUID);\n    if (existing) {\n      token.actor.deleteOwnedItem(existing._id);\n    } else {\n      token.actor.createOwnedItem(effect);\n    }\n  }\n})();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_9jlc9ozs6qm","path":"Effect Toggles","color":"#9900d1"}}}
{"name":"29 - T02 - Phase Spider Web (xfog+web)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params = \r\n[{\r\n    filterType: \"web\",\r\n    filterId: \"phaseweb\",\r\n    time: 0,\r\n    animated:\r\n        {\r\n            time:\r\n            {\r\n                active: true,\r\n                speed: 0.0005,\r\n                animType: \"move\"\r\n            }\r\n        }\r\n},\r\n{\r\n    filterType: \"xfog\",\r\n    filterId: \"phaseweb\",\r\n    color: 0x30FF30,\r\n    time: 0,\r\n    animated:\r\n        {\r\n            time:\r\n            {\r\n                active: true,\r\n                speed: 0.0005,\r\n                animType: \"move\"\r\n            }\r\n        }\r\n}]\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.ki2AEmXzUJkGpU65"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"8024mIHwKWAXksaq"}
{"name":"Export Actor with embedded images","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/default-icons/mystery-man.svg","scope":"global","command":"// Convert token and portrait images to base64 for easier export/import to other servers\n\nif (!actor && canvas.tokens.controlled.length != 1) {\n\tui.notifications.warn(\"You must have a single actor selected.\");\n\treturn;\n}\n\nfunction toDataURL(src, callback, outputFormat) {\n\tlet image = new Image();\n\timage.crossOrigin = 'Anonymous';\n\timage.onload = function () {\n\t\tlet canvas = document.createElement('canvas');\n\t\tlet ctx = canvas.getContext('2d');\n\t\tlet dataURL;\n\t\tcanvas.height = this.naturalHeight;\n\t\tcanvas.width = this.naturalWidth;\n\t\tctx.drawImage(this, 0, 0);\n\t\tdataURL = canvas.toDataURL(outputFormat, 0.7);\n\t\t// console.log('base64 encoded:', dataURL);\n\n\t\t// Foundry refuses to accept webp as a valid file extension when using base64 even though it supports webp normally...\n\t\t// So we hack it by changing the image type to png but leaving the data as webp which works for now\n\t\tdataURL = dataURL.replace(\"data:image/webp\", \"data:image/png\");\n\t\tcallback(dataURL);\n\t};\n\n\timage.src = src;\n\tif (image.complete || image.complete === undefined) {\n\t\timage.src = \"data:image/gif;base64, R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\n\t\timage.src = src;\n\t}\n}\n\ntoDataURL(actor.img,\n\tasync function (dataUrl) {\n\t\tconst portraitImage = dataUrl;\n\n\t\ttoDataURL(actor.data.token.img,\n\t\t\tasync function (dataUrl) {\n\t\t\t\tconst tokenImage = dataUrl;\n\n\t\t\t\t// Deep clone so we leave the original actor with image references...\n\t\t\t\tvar newActor = JSON.parse(JSON.stringify(actor));\n\n\t\t\t\tnewActor.name = `${actor.name}`;\n\t\t\t\tnewActor.img = portraitImage;\n\t\t\t\tnewActor.token.img = tokenImage;\n\n\t\t\t\tlet actorClone = await Actor.create(newActor);\n\n\t\t\t\tactorClone.exportToJSON();\n\t\t\t\tactorClone.delete();\n\t\t\t}\n\t\t\t, \"image/webp\")\n\t}\n\t, \"image/webp\")","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_uqqajwofsun","path":"Macros","color":"#000000"}},"_id":"80MTSdYXp9gNyh8R"}
{"name":"31 - T02 - Fairy Outline (globes+glow)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// works better with non-round forms\r\nlet params = \r\n[{\r\n    filterType: \"globes\",\r\n    filterId: \"glowingGlobes\",\r\n    time: 0,\r\n    color: 0x3080EE,\r\n    distortion: 0.9,\r\n    scale: 320,\r\n    alphaDiscard: true,\r\n    zOrder: 1,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n},\r\n{\r\n    filterType: \"glow\",\r\n    filterId: \"superSpookyGlow\",\r\n    outerStrength: 4,\r\n    innerStrength: 0,\r\n    color: 0xFF3000,\r\n    quality: 0.5,\r\n    padding: 10,\r\n    animated:\r\n    {\r\n        color: \r\n        {\r\n           active: true, \r\n           loopDuration: 3000, \r\n           animType: \"colorOscillation\", \r\n           val1:0xFF3000, \r\n           val2:0x30FF00\r\n        }\r\n    }\r\n}]\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.URg5jbccjFontPwQ"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"8CtjOjbG68mFKUMR"}
{"name":"06 - Bloom","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params = \r\n[{\r\n   filterType: \"xbloom\",\r\n   filterId: \"letsShine\",\r\n   threshold: 0.35,\r\n   bloomScale: 0,\r\n   brightness: 1,\r\n   blur: 0.1,\r\n   padding: 10,\r\n   quality: 15,\r\n   blendMode: 0,\r\n   animated:\r\n   {\r\n       bloomScale: \r\n       { \r\n          active: true, \r\n          loopDuration: 2000, \r\n          animType: \"syncCosOscillation\", \r\n          val1: 0, \r\n          val2: 2.1\r\n       },\r\n       threshold:  \r\n       { \r\n          active: false, \r\n          loopDuration: 1000, \r\n          animType: \"syncCosOscillation\", \r\n          val1: 0.00, \r\n          val2: 1.90\r\n       }\r\n   }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.cCEOQFsJvjhSTbbM"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"8IC2rniXMNQUJmoP"}
{"name":"37 - T02 - Pentagram (sprite)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n[{\n    filterType: \"sprite\",\n    filterId: \"myPentagram\",\n    imagePath: \"modules/tokenmagic/fx/assets/pentagram.png\",\n    gridPadding: 2,\n    scaleX: 3,\n    scaleY: 3,\n    colorize: true,\n    color: 0xFF0000,\n    inverse: true,\n    top: false,\n    animated:\n        {\n          rotation: \n          { \n            active: true,\n            clockWise: false, \n            loopDuration: 4000, \n            animType: \"syncRotation\"\n          }\n        }\n}];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Macro.2bekjnAG0VHRtXGx"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"8O2WW6OntCzi59j1"}
{"name":"Add Hero Point","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/up.svg","scope":"global","command":"// Add Hero Points to selected tokens, if possible. \r\n\r\n// by JackRandom \r\n\r\n \r\n\r\nlet selectedtokens = canvas.tokens.controlled; \r\n\r\nif (selectedtokens.length < 1) { \r\n\r\n  ui.notifications.warn(\"You must select at least 1 token.\"); \r\n\r\n  return; \r\n\r\n} \r\n\r\n \r\n\r\nlet Hnames = []; \r\n\r\n \r\n\r\nfor (let t of selectedtokens) { \r\n\r\nlet hprank = t.actor.data.data.attributes.heroPoints.rank; \r\n\r\nlet hpmax = t.actor.data.data.attributes.heroPoints.max; \r\n\r\nif ((hprank < hpmax) && (t.actor.data.type = \"character\")) { \r\n\r\nlet HeroP = hprank + 1; \r\n\r\nt.actor.update({'data.attributes.heroPoints.rank': HeroP}); \r\n\r\nHnames.push(t.actor.data.name); \r\n\r\n} \r\n\r\n} \r\n\r\n \r\n\r\nif (Hnames.length < 1) { \r\n\r\nui.notifications.warn(\"No slected tokens eligible to receive hero points. (Max points or not characters.)\"); \r\n\r\n} else { \r\n\r\nChatMessage.create({user: game.user._id, content : `Hero Point(s) given to ${Hnames.join(\", \")}.`}, {}); \r\n\r\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_w4f9l9idxk","path":"GM Macros","color":"#940000"}},"_id":"8QtlWoC78j0MZU89"}
{"_id":"8WhFAW3e7fKeNztX","name":"Suppress Regeneration","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/spells/lock.webp","scope":"global","command":"const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\nif (!actors.length && game.user.character) {\n    actors.push(game.user.character);\n}\nconst ITEM_UUID = 'Item.yFT1Elfu53UGl96P'; // Suppress Regeneration\nconst source = (await fromUuid(ITEM_UUID)).toObject();\nsource.flags.core ??= {};\nsource.flags.core.sourceId = ITEM_UUID;\nfor await (const actor of actors) {\n    const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === ITEM_UUID);\n    if (existing) {\n        await existing.delete();\n    } else {\n        await actor.createEmbeddedDocuments('Item', [source]);\n    }\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_0bvuexgyxprc","path":"PC Macros#/CF_SEP/Jamz","color":"#940505"}}}
{"_id":"8a5shrMwb0ecKKDR","name":"24 - T02 - Fire Shield 4 - Lava Zone","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"zapshadow\",\r\n    filterId: \"myZap\",\r\n    alphaTolerance: 0.45\r\n},{\r\n    filterType: \"field\",\r\n    filterId: \"myLavaRing\",\r\n    shieldType: 6,\r\n    gridPadding: 1.25,\r\n    color: 0xFFAA00,\r\n    time: 0,\r\n    blend: 14,\r\n    intensity: 1,\r\n    lightAlpha: 0,\r\n    lightSize: 0.7,\r\n    scale: 1,\r\n    radius: 1,\r\n    chromatic: false,\r\n    discardThreshold: 0.30,\r\n    hideRadius: 0.95,\r\n    alphaDiscard: true,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      },\r\n      radius: \r\n       {\r\n          active: true, \r\n          loopDuration: 6000, \r\n          animType: \"cosOscillation\", \r\n          val1:1, \r\n          val2:0.8\r\n       },\r\n      hideRadius: \r\n       {\r\n          active: true, \r\n          loopDuration: 3000, \r\n          animType: \"cosOscillation\", \r\n          val1:0.75, \r\n          val2:0.4\r\n       }\r\n    }\r\n},{\r\n    filterType: \"xglow\",\r\n    filterId: \"myBurningAura\",\r\n    auraType: 2,\r\n    color: 0xFF5000,\r\n    thickness: 9.8,\r\n    scale: 1.,\r\n    time: 0,\r\n    auraIntensity: 2,\r\n    subAuraIntensity: 1,\r\n    threshold: 0.30,\r\n    discard: true,\r\n    zOrder: 3000,\r\n    animated:\r\n    {\r\n        time : \r\n        {  \r\n           active: true,\r\n           speed: 0.0027, \r\n           animType: \"move\" \r\n        },\r\n        thickness:\r\n        {\r\n           active: true,\r\n           loopDuration: 600, \r\n           animType: \"cosOscillation\", \r\n           val1:4, \r\n           val2:8\r\n        }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.world.token-magic-dev.kyQD90fSuNLDI4Y0"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"name":"24 - T12 - Warp Time Aura 2","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n[{\n    filterType: \"field\",\n    filterId: \"myMageField\",\n    shieldType: 7,\n    gridPadding: 2,\n    color: 0xFFFFFF,\n    time: 0,\n    blend: 4,\n    intensity: 0.8,\n    lightAlpha: 1,\n    lightSize: 0.45,\n    scale: 1,\n    radius: 1,\n    chromatic: true,\n    animated :\n    {\n      time : \n      { \n        active: true, \n        speed: 0.0080, \n        animType: \"move\" \n      }\n    }\n},{\n    filterType: \"field\",\n    filterId: \"myWarpField\",\n    shieldType: 12,\n    gridPadding: 2,\n    color: 0xFFFFFF,\n    time: 0,\n    blend: 2,\n    intensity: 1,\n    lightAlpha: 0,\n    lightSize: 0,\n    scale: 0.7,\n    radius: 1,\n    chromatic: false,\n    alphaDiscard: true,\n    discardThreshold: 0.1,\n    animated :\n    {\n      time : \n      { \n        active: true, \n        speed: 0.0009, \n        animType: \"move\" \n      }\n    }\n}];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.7078QmgtTEjnbAv0"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"8jiYLDExcaSUqd9x"}
{"name":"35 - T08 - Animated SuperFrost (xfire+xglow)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n    [{\r\n        filterType: \"zapshadow\",\r\n        filterId: \"myAnimSuperFrost\",\r\n        alphaTolerance: 0.50\r\n    },\r\n    {\r\n        filterType: \"xfire\",\r\n        filterId: \"myAnimSuperFrost\",\r\n        color: 0xACC5C5,\r\n        time: 0,\r\n        blend: 5,\r\n        amplitude: 1,\r\n        dispersion: 0,\r\n        chromatic: false,\r\n        scaleX: 1,\r\n        scaleY: 1,\r\n        inlay: true,\r\n        animated:\r\n        {\r\n            time:\r\n            {\r\n                active: true,\r\n                speed: -0.0020,\r\n                animType: \"move\"\r\n            },\r\n            dispersion:\r\n            {\r\n                animType: \"cosOscillation\",\r\n                val1: 0.25,\r\n                val2: 0.55,\r\n                loopDuration: 3000\r\n            }\r\n        }\r\n    },\r\n    {\r\n        filterType: \"xglow\",\r\n        filterId: \"myAnimSuperFrost\",\r\n        auraType: 1,\r\n        color: 0x6090AA,\r\n        thickness: 4.5,\r\n        scale: 10,\r\n        time: 0,\r\n        auraIntensity: 0.25,\r\n        subAuraIntensity: 1,\r\n        threshold: 0.5,\r\n        discard: false,\r\n        animated:\r\n        {\r\n            time:\r\n            {\r\n                active: true,\r\n                speed: 0.0018,\r\n                animType: \"move\"\r\n            },\r\n            thickness:\r\n            {\r\n                val1: 2, val2: 2.5,\r\n                animType: \"cosOscillation\",\r\n                loopDuration: 3000\r\n            },\r\n            subAuraIntensity:\r\n            {\r\n                val1: 0.45, val2: 0.65,\r\n                animType: \"cosOscillation\",\r\n                loopDuration: 6000\r\n            },\r\n            auraIntensity:\r\n            {\r\n                val1: 0.9, val2: 1.1,\r\n                animType: \"cosOscillation\",\r\n                loopDuration: 3000\r\n            }\r\n        }\r\n    }];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.TktbnfMR7IIWewbg"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"8oIx6OwZUoRsHvV8"}
{"name":"37 - T01 - Ioun Stone (sprite)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n[{\n    filterType: \"sprite\",\n    filterId: \"mySprite\",\n    imagePath: \"modules/tokenmagic/fx/assets/gem-2.png\",\n    gridPadding: 1,\n    scaleX: 0.20,\n    scaleY: 0.20,\n    colorize: true,\n    color: 0xFFBB00,\n    inverse: false,\n    top: true,\n    animated:\n        {\n          rotation: \n          { \n            active: true,\n            clockWise: false, \n            loopDuration: 2000, \n            animType: \"syncRotation\"\n          },\n          translationX:\n            {\n                active: true,\n                animType: \"cosOscillation\",\n                val1: 2.0,\n                val2: -2.0,\n                loopDuration: 4000,\n            },\n            translationY:\n            {\n                active: true,\n                animType: \"sinOscillation\",\n                val1: 2.0,\n                val2: -2.0,\n                loopDuration: 4000,\n            },\n            color:\n            {\n                active: true,\n                animType: \"colorOscillation\",\n                val1: 0xFFFF00,\n                val2: 0x00FFFF,\n                loopDuration: 4000,\n            }\n        }\n}];\n\nTokenMagic.addFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Macro.2bekjnAG0VHRtXGx"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"8tQGcC1dVbEm97pe"}
{"name":"Effect: Align Armament","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/features/classes/deific-weapon.webp","scope":"global","command":"const ITEM_UUID = 'Item.DpWiuSTK1gdiSLOL'; // Effect: Align Armament\n(async () => {\n  const effect = duplicate(await fromUuid(ITEM_UUID));\n  effect.flags.core = effect.flags.core ?? {};\n  effect.flags.core.sourceId = ITEM_UUID;\n  for await (const token of canvas.tokens.controlled) {\n    let existing = token.actor.items.find(i => i.type === 'effect' && i.data.flags.core?.sourceId === ITEM_UUID);\n    if (existing) {\n      token.actor.deleteOwnedItem(existing._id);\n    } else {\n      token.actor.createOwnedItem(effect);\n    }\n  }\n})();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_9jlc9ozs6qm","path":"Effect Toggles","color":"#9900d1"}},"_id":"8v5DFZsPmOyIIYZy"}
{"name":"24 - T07 - Mage Armor 2","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myMageField\",\r\n    shieldType: 7,\r\n    gridPadding: 1,\r\n    color: 0xEEFFFF,\r\n    time: 0,\r\n    blend: 4,\r\n    intensity: 0.8,\r\n    lightAlpha: 0,\r\n    lightSize: 0,\r\n    scale: 1,\r\n    radius: 1,\r\n    chromatic: false,\r\n    discardThreshold: 0.25,\r\n    alphaDiscard: true,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.003, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.Ii7MvSDFFEKMavuM"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"978SbuSksB7C5GDJ"}
{"name":"11 - Blur","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"blur\",\r\n    filterId: \"myBlur\",\r\n    padding: 10,\r\n    quality: 4.0,\r\n    blur: 0,\r\n    blurX: 0,\r\n    blurY: 0,\r\n    animated:\r\n    {\r\n        blurX: \r\n        { \r\n           active: true, \r\n           animType: \"syncCosOscillation\", \r\n           loopDuration: 500, \r\n           val1: 0, \r\n           val2: 6\r\n        },\r\n        blurY: \r\n        { \r\n           active: true, \r\n           animType: \"syncCosOscillation\", \r\n           loopDuration: 750, \r\n           val1: 0, \r\n           val2: 6}\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.CdFhWPKBMb5wj7cM"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"9AkAkKEXmFR6x7Hl"}
{"name":"24 - T01 - Hexa Force Field 2","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myHexaField\",\r\n    shieldType: 2,\r\n    gridPadding: 2,\r\n    color: 0x00CCDD,\r\n    time: 0,\r\n    blend: 2,\r\n    intensity: 0.95,\r\n    lightAlpha: 0,\r\n    lightSize: 0,\r\n    scale: 0.75,\r\n    radius: 1,\r\n    chromatic: false,\r\n    alphaDiscard: true,\r\n    zOrder: 5000,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.cqKydeDi9ay4PKdf"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"9G76TfGaXmc5mPXi"}
{"name":"24 - T08 - Chromatic Bubble","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n[{\n    filterType: \"field\",\n    filterId: \"myChromaField\",\n    shieldType: 8,\n    gridPadding: 2,\n    color: 0xAAAAAA,\n    time: 0,\n    blend: 2,\n    intensity: 1,\n    lightAlpha: 0,\n    lightSize: 0,\n    scale: 1,\n    radius: 1,\n    chromatic: true,\n    zOrder: 512,\n    animated :\n    {\n      time : \n      { \n        active: true, \n        speed: 0.0045, \n        animType: \"move\" \n      }\n    }\n}];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.f74nx1SMT5m8RRn8"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"9mwYnNupCuUwlZJZ"}
{"name":"24 - T09 - Water Defense","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myWaterField\",\r\n    shieldType: 9,\r\n    gridPadding: 1.2,\r\n    color: 0x20BBEE,\r\n    time: 0,\r\n    blend: 4,\r\n    intensity: 1,\r\n    lightAlpha: 0.7,\r\n    lightSize: 0.5,\r\n    scale: 0.6,\r\n    radius: 1,\r\n    chromatic: false,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.aoqr6qPxif62zWLo"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"9nMJem8KA7IK9zuP"}
{"_id":"AFXpUzG0Uc2FAqAI","name":"27 - T04 - Pure Fire (xglow+fire)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"fire\",\r\n    filterId: \"myPureFire\",\r\n    intensity: 1,\r\n    color: 0xFFFFFF,\r\n    amplitude: 1,\r\n    time: 0,\r\n    blend: 2,\r\n    fireBlend : 1,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: -0.0024, \r\n        animType: \"move\" \r\n      },\r\n      intensity:\r\n      {\r\n        active:true,\r\n        loopDuration: 15000,\r\n        val1: 0.8,\r\n        val2: 2,\r\n        animType: \"syncCosOscillation\"\r\n      },\r\n      amplitude:\r\n      {\r\n        active:true,\r\n        loopDuration: 4400,\r\n        val1: 1,\r\n        val2: 1.4,\r\n        animType: \"syncCosOscillation\"\r\n      }\r\n      \r\n    }\r\n},\r\n{\r\n    filterType: \"zapshadow\",\r\n    filterId: \"myPureFireShadow\",\r\n    alphaTolerance: 0.50\r\n},\r\n{\r\n    filterType: \"xglow\",\r\n    filterId: \"myPureFireAura\",\r\n    auraType: 2,\r\n    color: 0x903010,\r\n    thickness: 9.8,\r\n    scale: 4.,\r\n    time: 0,\r\n    auraIntensity: 2,\r\n    subAuraIntensity: 1.5,\r\n    threshold: 0.40,\r\n    discard: true,\r\n    animated:\r\n    {\r\n        time : \r\n        {  \r\n           active: true,\r\n           speed: 0.0027, \r\n           animType: \"move\" \r\n        },\r\n        thickness:\r\n        {\r\n           active: true,\r\n           loopDuration: 3000, \r\n           animType: \"cosOscillation\", \r\n           val1:2, \r\n           val2:5\r\n        }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.world.token-magic-dev.eJQSmnIitUUQMKDS"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"name":"17 - Fumes","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"fumes\",\r\n    filterId: \"myFumes\",\r\n    color: 0x808080,\r\n    time: 0,\r\n    blend: 8,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.001, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.ebWbFeiJP8UZG4Fd"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"AbO07eKtmeuDmMxZ"}
{"name":"Raise a Shield","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/actions/raise-a-shield.webp","scope":"global","command":"game.pf2e.actions.raiseAShield({ actors: [token?.actor ?? actor ?? game.user.character].filter((actor) => actor) })","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"furnace":{"runAsGM":false},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"BUxWPwg26q6wYyzi"}
{"name":"Remove Bless","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/spells/bless.webp","scope":"global","command":"// Toggle an \"Effect\" on a actor for a random duration\n\n/*************\n *  Globals  *\n**************/\nconst effectName = 'Spell Effect: Bless';\nconst numberOfRounds = 10;\n\n/************* \n * Functions *\n**************/\nasync function main() {\n\tif (!actor && canvas.tokens.controlled.length != 1) {\n\t\tui.notifications.warn(\"You must have a single actor selected.\");\n\t}\n\n    removeEffect(actor);\n}\n\n// function toggleEffect(actor) {\n// \tlet effectItems = actor.items.filter(item => item.type === 'effect' && item.name.includes(effectName));\n\n// \tif (effectItems.length > 0) {\n// \t\tremoveEffect(actor);\n// \t} else {\n// \t\taddEffect(actor);\n// \t}\n// }\n\nasync function removeEffect(actor) {\n\tui.notifications.info(`${actor.name}'s ${effectName} expired.`);\n\n\tlet effectItems = actor.items.filter(item => item.type === 'effect' && item.name.includes(effectName));\n\tfor (let effectItem of effectItems) {\n\t\tawait actor.deleteOwnedItem(effectItem._id);\n\t}\n\tawait removeTemplate(actor.token);\n}\n\nasync function addEffect(actor) {\n\taddTurnAlert(actor);\n\n\tlet effectItem = game.items.getName(effectName).data;\n\t// numberOfRounds = effectItem.data.duration.value;\n\n\tui.notifications.info(`${actor.name} now has ${effectName} for ${numberOfRounds} ${effectItem.data.duration.unit}.`);\n\n\tawait actor.createOwnedItem(effectItem);\n\tawait addTemplate(actor.token);\n}\n\nfunction addTurnAlert(actor) {\n\tif (game.combat === null) {\n\t\treturn;\n\t}\n\n\t// Get the combat tracker id for the targeted token...\n\tlet combatant_target = game.combat.combatants.find(it => it.actor.id == actor.id);\n\n\tif (combatant_target === undefined) {\n\t\tui.notifications.warn(`${actor.data.name} is not in combat! They must be in combat for this macro to work.`);\n\t\treturn;\n\t}\n\n\t// Check if actor has acted yet or not this round and set Alert to this round if they haven't\n\tconst currentTurn = game.combat.turn;\n\tconst combatantTurn = game.combat.turns.findIndex(it => it.actor.id == actor.id);\n\tlet nextRound = (combatantTurn > currentTurn) ? 0 : 1;\n\tnextRound += numberOfRounds -1;\n\n\tconst removeEffect_Alert = {\n\t\tname: `${effectName} expires`,\n\t\tlabel: `${effectName} expires`,\n\t\tturnId: combatant_target._id,\n\t\tround: nextRound,\n\t\t// endOfTurn: true,\n\t\tmacro: \"Cast Bless\",\n\t\targs: ['removeEffect']\n\t}\n\n\tTurnAlert.create(removeEffect_Alert);\n}\n\nasync function addTemplate() {\n\tlet templateSize = 5;\n\tlet elements = await tokenAttacher.getAllAttachedElementsByTypeOfToken(token, \"MeasuredTemplate\");\n\n\tif (elements.length > 0) {\n\t\tawait tokenAttacher.detachAllElementsFromToken(token);\n\n\t\ttemplateSize = canvas.templates.get(elements[0]).data.distance + 5;\n\t\tconsole.log(\"*** templateSize:\", templateSize);\n\n\t\tcanvas.templates.get(elements[0]).delete();\n\t}\n\n\tconst element = await MeasuredTemplate.create({\n\t\tt: \"circle\",\n\t\tuser: game.user._id,\n\t\tx: token.center.x,\n\t\ty: token.center.y,\n\t\tdirection: 0,\n\t\tdistance: templateSize,\n\t\tborderColor: \"#000000\",\n\t\tfillColor: \"#000077\"\n\t\t//   texture: \"links/Effects/AnimatedArt/Runes/teleportationCircle2.webm\"\n\t});\n\n\tawait tokenAttacher.attachElementToToken(element, token)\n}\n\nasync function removeTemplate() {\n\tlet elements = await tokenAttacher.getAllAttachedElementsByTypeOfToken(token, \"MeasuredTemplate\");\n\n\tif (elements.length > 0) {\n\t\tawait tokenAttacher.detachAllElementsFromToken(token);\n\t\tcanvas.templates.get(elements[0]).delete();\n\t}\n}\n\nmain();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_5lpecs4iq07","path":"Under Construction","color":"#e68600"}},"_id":"BohKDZOQiEb42I9Q"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493","name":"FX Macros","children":["TdLuTpQB9BIVjavx","sEKUmlQpBQhxQrVA","vBU833sBPCHv7q9k","nohxTIwYZ2jXdRfp","gFpDka2936TpA34H","fpkHQE4f6qhc5ZQN","bPBWD7LKNskARCKN","RAB1MT6HaV6lng1s","8IC2rniXMNQUJmoP","sNOh5pc586FG2uqX","kq2n7K92DqoYcdaS","v2S2op0GG9uMsLLm","C9i5WiEqbaT9u8Fa","UyQPFqEINkHXDp71","ufVNOkf32f9w0iIT","9AkAkKEXmFR6x7Hl","feI06orwdN78K78g","VgpuDWlOzMpec9px","plrHQXc754hjdoZ8","HFaLRLhMfloxS82w","nFJxhHE52yjdP8PL","AbO07eKtmeuDmMxZ","uwciF4YVoYl43pZ6","kG5mkAltHF3sppFS","kG5mkAltHF3sppFS","VdpwjS6wJj1myDUB","VdpwjS6wJj1myDUB","FkWHe3iyvbOAbuSO","DUtTkM2oYlSaoPVL","K9w5wkha4a64D68o","UWPBpN92gi4c7qDP","HxsYezuwzJO0T9RD","gUa56yDrwxGBt3Gj","wHih6z06oFlwFkHv","9G76TfGaXmc5mPXi","IM0aBrgcDWFAzr60","i6Z7nYDNe7o1undQ","i6Z7nYDNe7o1undQ","09jRisijG5AwDbG4","09jRisijG5AwDbG4","tb5wNLch7TPi9A8w","tb5wNLch7TPi9A8w","8a5shrMwb0ecKKDR","8a5shrMwb0ecKKDR","kMYXmkqAdriqeUg0","JbeJdjr7c0GXSaJ7","pnQtITlqgPB8vdym","3A7cSQKPpixh3p2M","NDnveyc2Ma5elRxh","PeSWJOiyODOYaNEP","1PfO026rhHQP1lCZ","61smbgPGdCBFoBUD","978SbuSksB7C5GDJ","9mwYnNupCuUwlZJZ","myIbl9vEZIQkKPpq","9nMJem8KA7IK9zuP","3prQwgN5dZ15hAM6","Pa6ZsUbdKqNrKFY6","uC6noHi16ux0UWxl","zfj9qZVbtR1ZRxk0","W9ZaFTh1vpxO8zkf","8jiYLDExcaSUqd9x","ISzHo5lFRwnHLh6I","XvzNDCAl36Oo9Rz7","g4x0Upd8Fr3TSMMY","hE14LWSDfKOTsYgq","oQ2H8D7Qc3jlQjaI","M8Cw55B22QnfykE6","0KmP9BhuSRqgjkPX","fO8VtcvAVteNDYGn","EpCQTyFGwZmdhrdO","EpCQTyFGwZmdhrdO","1nsjc4zp43tNlk7x","NskX3BreaordVLmT","AFXpUzG0Uc2FAqAI","AFXpUzG0Uc2FAqAI","LAgpdw99RqkoHeXG","LAgpdw99RqkoHeXG","nfUWl5GYaVpmTVds","YO5TJ4BcZkjObKPe","uvV7zR8NAhCDE7hL","8024mIHwKWAXksaq","jUffO5X9wbvhDfUR","NgdVbL9NXq8CNi89","lvLe19YhQFkKyNks","8CtjOjbG68mFKUMR","zjf6mYT0iZQzFjlT","zjf6mYT0iZQzFjlT","vZjhbsbhyd9rW7tU","zHG1T8lRks8H5DJg","MuBKza1DZtWJpHUl","N813J5wbf3UX1doB","aBHq9quRrCfe2Ogz","aegNvJcgWeHZgbUD","hdqGThYFh548agm5","mGg2PzndmwlaDXWI","P6nYdfJvJ6oiyFKW","P6nYdfJvJ6oiyFKW","15igeFeBqnhyydKN","15igeFeBqnhyydKN","wORm9zrX4PDEzfme","IzIy8vtbrXD2xwCC","IzIy8vtbrXD2xwCC","7fiHbf7EGasrXpQg","7fiHbf7EGasrXpQg","bp336e08ZCg6GwOb","dxi9mnBuxwbXervr","8oIx6OwZUoRsHvV8","V9UVLa7U6eebHVlo","V9UVLa7U6eebHVlo","OLc3zPPwLlvSAquW","Sc83NOOaFqXRPnrY","8tQGcC1dVbEm97pe","8O2WW6OntCzi59j1","RrkCkEMXyRn99RqW","Ox6BZCiRQg19UM1K","jNMcVcpOZiWTUBcq","wVHXzX0gluH3Vbvu","zMAfnm9ysnDAWdSZ","fiV8yawLWqpAOcvY","kHVU5OpldrhCpyyG","RbLEFS3P6O1xWi53","1gFd46NYuniob3HI","sEnJhON9udocKff2","MlnusjSKIiVgr1k6"],"folderPath":[]}},"_id":"C0LhQWVp6MXqOUnD"}
{"name":"09 - T02 - Moo Man Dance (transform)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n    [{\n        filterType: \"transform\",\n        filterId: \"theMooManDance\",\n        twRadiusPercent: 70,\n        bpRadiusPercent: 90,\n        padding: 50,\n        animated:\n        {\n            twRotation:\n            {\n                animType: \"sinOscillation\",\n                val1: -90,\n                val2: +90,\n                loopDuration: 1000,\n            },\n            bpStrength:\n            {\n                animType: \"cosOscillation\",\n                val1: 0,\n                val2: 0.55,\n                loopDuration: 1000,\n            },\n            translationX:\n            {\n                animType: \"sinOscillation\",\n                val1: -0.125,\n                val2: +0.125,\n                loopDuration: 1400,\n            },\n            translationY:\n            {\n                animType: \"cosOscillation\",\n                val1: -0.125,\n                val2: +0.125,\n                loopDuration: 1400,\n            },\n            rotation:\n            {\n                animType: \"cosOscillation\",\n                val1: 90,\n                val2: -90,\n                loopDuration: 4200,\n            },    \n        }\n    }];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.jFdKzkYqcKOmeQPW"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"C9i5WiEqbaT9u8Fa"}
{"name":"21 - Flood","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"flood\",\r\n    filterId: \"myFlood\",\r\n    time: 0,\r\n    color: 0x0020BB,\r\n    billowy: 0.43,\r\n    tintIntensity: 0.72,\r\n    glint: 0.31,\r\n    scale: 70,\r\n    padding: 10,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0006, \r\n        animType: \"move\"\r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.zCCp4x0EResFji7O"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"DUtTkM2oYlSaoPVL"}
{"name":"Roll Secret Arcana","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/deity/Nethys.webp","scope":"global","command":"game.PF2EToolbox.secretSkillRoll('arc')","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"DVnriSL2cKJE7RHL"}
{"_id":"EpCQTyFGwZmdhrdO","name":"27 - T01 - Burning Aura (xglow)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n[{\n    filterType: \"zapshadow\",\n    filterId: \"myZapShadow\",\n    alphaTolerance: 0.50\n},\n{\n    filterType: \"xglow\",\n    filterId: \"myBurningAura\",\n    auraType: 2,\n    color: 0x903010,\n    thickness: 9.8,\n    scale: 1.,\n    time: 0,\n    auraIntensity: 2,\n    subAuraIntensity: 1.5,\n    threshold: 0.40,\n    discard: true,\n    animated:\n    {\n        time : \n        {  \n           active: true,\n           speed: 0.0027, \n           animType: \"move\" \n        },\n        thickness:\n        {\n           active: true,\n           loopDuration: 3000, \n           animType: \"cosOscillation\", \n           val1:2, \n           val2:5\n        }\n    }\n}];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.cOaB7NxSQ5jNDd5g"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"name":"Spend a Hero Point","type":"script","author":"oiPWLVPNH7xQBULr","img":"modules/Nerps-For-Foundry/images/coins/Hero-Point-Tails.webp","scope":"global","command":"// Spend a Hero point\nlet messageContent = ''\nif (!actor) {\n    ui.notifications.warn(\"You must have an actor selected.\")\n}\n\n(async () => {\n    for (let token of canvas.tokens.controlled) {\n        let currentHeroPoionts = token.actor.data.data.attributes.heroPoints.rank\n\n        if (currentHeroPoionts > 0) {\n            \n            token.actor.update({ 'data.attributes.heroPoints.rank': currentHeroPoionts - 1 })\n            \n            messageContent = 'Hero Point Spent!<br>Hero Points left: ' + (currentHeroPoionts - 1);\n                \n            let roll = new Roll(\"1dc\").roll()\n            \n            let chatData = {\n                user: game.user._id,\n                speaker: ChatMessage.getSpeaker(),\n                flavor: messageContent,\n                type: CONST.CHAT_MESSAGE_TYPES.ROLL,\n                roll\n            }\n            \n            ChatMessage.create(chatData, {})\n            //  let roll = new Roll(\"1dc\").roll().toMessage(chatData)\n            // let rolld20 = new Roll(\"1d20\").roll().toMessage();\n        } else {\n             let chatData = {\n                user: game.user._id,\n                speaker: ChatMessage.getSpeaker(),\n                content: 'You are out of Hero Points! Sorry.',\n                type: CONST.CHAT_MESSAGE_TYPES.OOC,\n            }\n            \n            ChatMessage.create(chatData, {})\n        }\n    }\n})();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"EvlDtaijQiSh1DV2"}
{"name":"Distribute Hero Points","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// Prompt for how many to distribute\ngame.PF2EToolbox.distributeHeroPoints();\n\n// Always distribute 1 hero point\n// game.PF2EToolbox.distributeHeroPoints(1);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Macro.me76zzqyykBeqOO7"},"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_w4f9l9idxk","path":"GM Macros","color":"#940000"}},"_id":"FUdlEQuHcYvwCOVX"}
{"name":"20 - Waves","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// Below, you can turn on the anchor animation.\r\nlet params =\r\n[{\r\n    filterType: \"wave\",\r\n    filterId: \"myWaves\",\r\n    time: 0,\r\n    anchorX: 0.5,\r\n    anchorY: 0.5,\r\n    strength: 0.015,\r\n    frequency: 120,\r\n    color: 0xFFFFFF,\r\n    maxIntensity: 2.5,\r\n    minIntensity: 0.9,\r\n    padding:10,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0085, \r\n        animType: \"move\" \r\n      },\r\n      anchorX :\r\n      {\r\n        active: false,\r\n        val1: 0.15,\r\n        val2: 0.85,\r\n        animType: \"syncChaoticOscillation\",\r\n        loopDuration: 20000\r\n      },\r\n      anchorY :\r\n      {\r\n        active: false,\r\n        val1: 0.15,\r\n        val2: 0.85,\r\n        animType: \"syncSinOscillation\",\r\n        loopDuration: 20000\r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.DoXvYWKPRcTpHbPG"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"FkWHe3iyvbOAbuSO"}
{"name":"Spell Timer: Vital Beacon","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/spells/vital-beacon.webp","scope":"global","command":"const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\nif (!actors.length && game.user.character) {\n\tactors.push(game.user.character);\n}\nconst ITEM_UUID = 'Item.bG2PAkV25SCTKEzv'; // Spell Timer: Vital Beacon - D4\nconst ITEM_UUID_D6 = 'Item.UyTNCJptN3yO0riF'; // Spell Timer: Vital Beacon - D6\nconst ITEM_UUID_D8 = 'Item.pYFAMlKDvJmkSLzQ'; // Spell Timer: Vital Beacon - D8\nconst ITEM_UUID_D10 = 'Item.9o2oNlwjaZ3tlCAJ'; // Spell Timer: Vital Beacon - D10\n\nconst source = (await fromUuid(ITEM_UUID)).toObject();\nsource.flags.core ??= {};\nsource.flags.core.sourceId = ITEM_UUID;\n\nconst sourceD6 = (await fromUuid(ITEM_UUID_D6)).toObject();\nsourceD6.flags.core ??= {};\nsourceD6.flags.core.sourceId = ITEM_UUID_D6;\n\nconst sourceD8 = (await fromUuid(ITEM_UUID_D8)).toObject();\nsourceD8.flags.core ??= {};\nsourceD8.flags.core.sourceId = ITEM_UUID_D8;\n\nconst sourceD10 = (await fromUuid(ITEM_UUID_D10)).toObject();\nsourceD10.flags.core ??= {};\nsourceD10.flags.core.sourceId = ITEM_UUID_D10;\n\n\nfor await (const actor of actors) {\n\tconst existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === ITEM_UUID);\n\tconst existingD6 = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === ITEM_UUID_D6);\n\tconst existingD8 = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === ITEM_UUID_D8);\n\tconst existingD10 = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === ITEM_UUID_D10);\n\n\tif (existing) {\n\t\tawait existing.delete();\n\t\tif (existingD6) {\n\t\t\tawait existingD6.delete();\n\t\t}\n\t\tif (existingD8) {\n\t\t\tawait existingD8.delete();\n\t\t}\n\t\tif (existingD10) {\n\t\t\tawait existingD10.delete();\n\t\t}\n\t} else {\n\t\tawait actor.createEmbeddedDocuments('Item', [sourceD10]);\n\t\tawait actor.createEmbeddedDocuments('Item', [sourceD8]);\n\t\tawait actor.createEmbeddedDocuments('Item', [sourceD6]);\n\t\tawait actor.createEmbeddedDocuments('Item', [source]);\n\t}\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_9jlc9ozs6qm","path":"Effect Toggles","color":"#9900d1"}},"_id":"H4RaawEHGyAJ4fqM"}
{"name":"15 - Cosmic Ray","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n[{\n    filterType: \"ray\",\n    filterId : \"myRay\",\n    time: 0,\n    color: 0xCF8000,\n    alpha: 0.5,\n    divisor: 32,\n    anchorX: 0,\n    anchorY: 0,\n    animated :\n    {\n       time : \n       { \n          active: true, \n          speed: 0.0005, \n          animType: \"move\" \n       }\n    }\n}];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.37aHASDQzFvbqmJG"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"HFaLRLhMfloxS82w"}
{"name":"Process Healing (Regen / Fast Healing)","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/spells/regeneration.webp","scope":"global","command":"PF2EPersistentDamage.processHealing(canvas.tokens.controlled);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.pf2e-persistent-damage.pf2e-persistent-damage-macros.mh3yl3kgkp8onnom"},"cf":{"id":"temp_w4f9l9idxk","path":"GM Macros","color":"#940000"}},"_id":"HuGGbacApqouXSNl"}
{"name":"23 - T02 - Chaotic Images","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// This is an extreme example...\r\nlet params =\r\n[{\r\n    filterType: \"images\",\r\n    filterId: \"myChaoticImages\",\r\n    time: 0,\r\n    nbImage: 4,\r\n    alphaImg: 1.0,\r\n    alphaChr: 0.0,\r\n    blend: 4,\r\n    ampX: 0.10,\r\n    ampY: 0.10,\r\n    padding: 80,\r\n    zOrder: 20,\r\n    animated :\r\n    {\r\n      time: \r\n      { \r\n        active: true, \r\n        speed: 0.0010, \r\n        animType: \"move\" \r\n      },\r\n      ampX:\r\n      {\r\n        active: true,\r\n        val1: 0.00,\r\n        val2: 0.30,\r\n        chaosFactor: 0.03,\r\n        animType: \"syncChaoticOscillation\",\r\n        loopDuration: 2000\r\n      },\r\n      ampY:\r\n      {\r\n        active: true,\r\n        val1: 0.00,\r\n        val2: 0.30,\r\n        chaosFactor: 0.04,\r\n        animType: \"syncChaoticOscillation\",\r\n        loopDuration: 1650\r\n      },\r\n      alphaChr:        \r\n      { \r\n        active: true, \r\n        animType: \"randomNumberPerLoop\", \r\n        val1: 0.0, \r\n        val2: 1,\r\n        loopDuration: 250\r\n      },\r\n      alphaImg:        \r\n      { \r\n        active: true, \r\n        animType: \"randomNumberPerLoop\", \r\n        val1: 0.8, \r\n        val2: 1,\r\n        loopDuration: 250\r\n      },\r\n      nbImage:\r\n      {\r\n        active: true,\r\n        val1: 1,\r\n        val2: 9,\r\n        animType: \"syncSinOscillation\",\r\n        loopDuration: 1400\r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.ycesEG9gnQecVsDM"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"HxsYezuwzJO0T9RD"}
{"name":"24 - T01 - Hexa Force Field 3 - Scintillating","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myHexaField\",\r\n    shieldType: 2,\r\n    gridPadding: 2,\r\n    color: 0x00CCDD,\r\n    time: 0,\r\n    blend: 2,\r\n    intensity: 1,\r\n    lightAlpha: 0,\r\n    lightSize: 0,\r\n    scale: 2,\r\n    radius: 0.98,\r\n    chromatic: false,\r\n    discardThreshold: 0.13,\r\n    alphaDiscard: true,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n},\r\n{\r\n    filterType: \"xglow\",\r\n    filterId: \"myBurningAura\",\r\n    auraType: 2,\r\n    color: 0x500050,\r\n    scale: 1.,\r\n    time: 0,\r\n    auraIntensity: 1,\r\n    subAuraIntensity: 0,\r\n    threshold: 0,\r\n    discard: false,\r\n    zOrder: 3000,\r\n    animated:\r\n    {\r\n        time : \r\n        {  \r\n           active: true,\r\n           speed: 0.0027, \r\n           animType: \"move\" \r\n        },\r\n        thickness:\r\n        {\r\n           active: true,\r\n           loopDuration: 6000, \r\n           animType: \"cosOscillation\", \r\n           val1:2, \r\n           val2:4\r\n        }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.HfaGElkKX6xXf3zV"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"IM0aBrgcDWFAzr60"}
{"name":"24 - T13 - Simple Color","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"mySimpleField\",\r\n    shieldType: 13,\r\n    gridPadding: 2,\r\n    alpha: 0.25,\r\n    color: 0xCCCC00,\r\n    time: 0,\r\n    blend: 14,\r\n    intensity: 1.10,\r\n    lightSize: 0,\r\n    scale: 1,\r\n    radius: 1,\r\n    chromatic: false,\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.GHbWoqQWjeUjcStr"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"ISzHo5lFRwnHLh6I"}
{"_id":"IzIy8vtbrXD2xwCC","name":"35 - T04 - Cold Fire (xfire)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"xfire\",\r\n    filterId: \"myColdXFire\",\r\n    time: 0,\r\n    color: 0xBBDDEE,\r\n    blend: 1,\r\n    amplitude: 1,\r\n    dispersion: 0,\r\n    chromatic: false,\r\n    scaleX: 1,\r\n    scaleY: 1,\r\n    inlay: false,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: -0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.world.token-magic-dev.hC63QbO6aATjatSA"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"name":"24 - T04 - Shell - Earth","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myEarthField\",\r\n    shieldType: 4,\r\n    gridPadding: 2,\r\n    color: 0xBB9070,\r\n    time: 0,\r\n    blend: 1,\r\n    intensity: 1.25,\r\n    lightAlpha: 1,\r\n    lightSize: 0.7,\r\n    scale: 1,\r\n    radius: 1,\r\n    chromatic: false,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.359Mw23cvaEDevkP"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"JbeJdjr7c0GXSaJ7"}
{"name":"22 - Smoke","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"smoke\",\r\n    filterId: \"mySmoke\",\r\n    color: 0x50FFAA,\r\n    time: 0,\r\n    blend: 2,\r\n    dimX: 1,\r\n    dimY: 1,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\"\r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.2zRNjnw7Ps26h5xz"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"K9w5wkha4a64D68o"}
{"name":"StatusCheck","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/clockwork.svg","scope":"global","command":"// console.log(\"StatusCheck args: \", args)\n\nconst negateRegenEffectName = \"Regeneration Negated\"\n\nif (args[2] == \"delete\" && args[3] == false) {\n\tremoveCondition(args[0], args[1])\n}\n\nif (args[3] == true) {\n\tconst roll = new Roll(args[4]).roll();\n\tlet myToken = canvas.tokens.placeables.find(token => token.id === args[1]);\n\tlet newHealth = myToken.actor.data.data.attributes.hp.value;\n\n\tif (args[0] == \"regeneration\") {\n\t\tlet negateRegenEffect = myToken.actor.items.filter(item => item.type === 'effect' && item.name.includes(negateRegenEffectName));\n\n\t\tif (negateRegenEffect.length == 0) {\n\t\t\tnewHealth += roll.total;\n\t\t\tif (newHealth > myToken.actor.data.data.attributes.hp.max) { newHealth = myToken.actor.data.data.attributes.hp.max }\n\t\t}\n\t} else {\n\t\tnewHealth -= roll.total;\n\t\tif (newHealth < 0) { newHealth = 0 }\n\t}\n\n\tmyToken.actor.update({ 'data.attributes.hp.value': newHealth })\n\t\n\tif (args[0] != \"regeneration\") {\n\t\troll.toMessage({\n\t\t\trollMode: \"GM Roll\"\n\t\t});\n\t}\n}\n\nfunction removeCondition(type, target) {\n\tlet myToken = canvas.tokens.placeables.find(token => token.id === target);\n\tlet delCondition = myToken.actor.data.items.find(i => i.name === type);\n\t// console.log(delCondition)\n\n\tif (type === \"Frightened\" && delCondition.data.value.value > 1) {\n\t\tPF2eConditionManager.updateConditionValue(delCondition._id, myToken, delCondition.data.value.value - 1)\n\t} else {\n\t\tlet promise = new Promise(function (resolve, reject) {\n\t\t\t// the function is executed automatically when the promise is constructed\n\t\t\t// after 1 second signal that the job is done with the result \"done\"\n\t\t\tsetTimeout(() => resolve(PF2eConditionManager.removeConditionFromToken(delCondition._id, myToken)), 1000);\n\t\t})\n\t}\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"macro-marker":{"activeData":{"icon":"icons/svg/clockwork.svg","tooltip":"StatusCheck                                 ","colour":"#ff0000","trigger":""}},"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"cf":{"id":"temp_w4f9l9idxk","path":"GM Macros","color":"#940000"}},"_id":"KPRXAQtFwuAAYDiT"}
{"_id":"LAgpdw99RqkoHeXG","name":"27 - T05 - Pure Fire v2 (xglow+fire)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// In this version, the glow is blending with the fire\r\n// This is to show that the order of the filters is important\r\nlet params =\r\n[{\r\n    filterType: \"zapshadow\",\r\n    filterId: \"myPureFireShadow\",\r\n    alphaTolerance: 0.50\r\n},\r\n{\r\n    filterType: \"xglow\",\r\n    filterId: \"myPureFireAura\",\r\n    auraType: 2,\r\n    color: 0x903010,\r\n    thickness: 9.8,\r\n    scale: 3.,\r\n    time: 0,\r\n    auraIntensity: 1,\r\n    subAuraIntensity: 0.3,\r\n    threshold: 0.25,\r\n    discard: true,\r\n    animated:\r\n    {\r\n        time : \r\n        {  \r\n           active: true,\r\n           speed: 0.0027, \r\n           animType: \"move\" \r\n        },\r\n        thickness:\r\n        {\r\n           active: true,\r\n           loopDuration: 3000, \r\n           animType: \"cosOscillation\", \r\n           val1:2, \r\n           val2:3.6\r\n        }\r\n    }\r\n},\r\n{\r\n    filterType: \"fire\",\r\n    filterId: \"myPureFire\",\r\n    intensity: 1,\r\n    color: 0xFFFFFF,\r\n    amplitude: 1,\r\n    time: 0,\r\n    blend: 2,\r\n    fireBlend : 1,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: -0.0024, \r\n        animType: \"move\" \r\n      },\r\n      intensity:\r\n      {\r\n        active:true,\r\n        loopDuration: 15000,\r\n        val1: 0.8,\r\n        val2: 3,\r\n        animType: \"syncCosOscillation\"\r\n      },\r\n      amplitude:\r\n      {\r\n        active:true,\r\n        loopDuration: 4400,\r\n        val1: 1,\r\n        val2: 1.6,\r\n        animType: \"syncCosOscillation\"\r\n      }\r\n      \r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.world.token-magic-dev.wRWqUK0wliNZSsgl"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"name":"Cast Stoneskin","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/spells/stone-skin.webp","scope":"global","command":"/*************\n *  Globals  *\n**************/\nconst effect = await game.items.find(a => a.id == \"fVPxSwCp4evWPTNf\").toObject(); // Shared Compendium Effect\n\n/************* \n * Functions *\n**************/\nasync function main() {\n\tif (!token?.actor && canvas.tokens.controlled.length != 1) {\n\t\tui.notifications.warn(\"You must have a single actor selected.\");\n\t}\n\n\tlet task = args[0];\n\n\tswitch (task) {\n\t\tcase 'addEffect':\n\t\t\taddEffect(token.actor);\n\t\t\tbreak;\n\t\tcase 'removeEffect':\n\t\t\tremoveEffect(token.actor);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\ttoggleEffect(token.actor);\n\t}\n}\n\n\nfunction toggleEffect(tActor) {\n\tlet effectItems = tActor.items.filter(item => item.type === 'effect' && item.name.includes(effect.name));\n\n\tif (effectItems.length > 0) {\n\t\tremoveEffect(tActor);\n\t} else {\n\t\taddEffect(tActor);\n\t}\n}\n\nasync function addEffect(tActor) {\n\tui.notifications.info(`${tActor.name} now has ${effect.name} for ${effect.data.duration.value} ${effect.data.duration.unit}.`);\n\tawait tActor.createEmbeddedDocuments(\"Item\", [effect]);\n\taddTurnAlert(tActor);\n}\n\nasync function removeEffect(tActor) {\n\tlet effectItems = tActor.items.filter(item => item.type === 'effect' && item.name.includes(effect.name));\n\tfor (let effectItem of effectItems) {\n        let newDuration = (effectItem.data.data.duration.value) - 1;\n        if(newDuration <= 0) {\n\t        ui.notifications.info(`${tActor.name}'s ${effect.name} expired.`);\n            await tActor.deleteOwnedItem(effectItem._id);            \n        } else {\n\t        ui.notifications.info(`${tActor.name}'s ${effect.name} now has ${newDuration} minutes left.`);\n            await effectItem.update({'data.duration.value': newDuration})    \n        }\n\t}\n}\n\nfunction addTurnAlert(tActor) {\n\tif (!game.modules.get(\"turnAlert\")?.active || game.combat === null) {\n\t\treturn;\n\t}\n\n\t// Get the combat tracker id for the targeted token...\n\tlet combatant_target = game.combat.combatants.find(it => it.actor.id == tActor.id);\n\n\tif (combatant_target === undefined) {\n\t\tui.notifications.warn(`${tActor.data.name} is not in combat! They must be in combat for this macro to work.`);\n\t\treturn;\n\t}\n\n\t// Check if actor has acted yet or not this round and set Alert to this round if they haven't\n\tconst currentTurn = game.combat.turn;\n\tconst combatantTurn = game.combat.turns.findIndex(it => it.actor.id == tActor.id);\n\tlet nextRound = (combatantTurn > currentTurn) ? 0 : 1;\n\tnextRound += effect.data.duration.value\n\n\tconst removeEffect_Alert = {\n\t\tname: `${effect.name} expires`,\n\t\tlabel: `${effect.name} expires`,\n\t\tturnId: combatant_target._id,\n\t\tround: nextRound,\n\t\t// endOfTurn: true,\n\t\tmacro: \"Cast Stoneskin\",\n\t\targs: ['removeEffect']\n\t}\n\n\tTurnAlert.create(removeEffect_Alert);\n}\n\nmain();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_9jlc9ozs6qm","path":"Effect Toggles","color":"#9900d1"}},"_id":"LnMuATGBgmHnbbLr"}
{"name":"Spell: Darkness","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/blind.svg","scope":"global","command":"const ld={\"t\":\"l\",\"dim\":0,\"bright\":-20,\"angle\":360,\"rotation\":0,\"darknessThreshold\":0,\"tintColor\":\"\",\"tintAlpha\":0.49,\"lightAnimation\":{\"type\":\"\",\"speed\":5,\"intensity\":5},\"flags\":{}};\nLightTemplates.activate(this.id,ld);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"df-architect":{"isLightTemplate":true},"core":{"sourceId":"Macro.8HamcPRu0qzmfA4X"},"cf":{"id":"temp_5lpecs4iq07","path":"Under Construction","color":"#e68600"}},"_id":"LweZz1FNKKyjuM72"}
{"name":"26 - T01 - Spectral Body (liquid)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"liquid\",\r\n    filterId: \"mySpectralBody\",\r\n    color: 0x20AAEE,\r\n    time: 0,\r\n    blend: 8,\r\n    intensity: 4,\r\n    spectral: true,\r\n    scale: 0.9,\r\n    animated :\r\n    {\r\n       time : \r\n       { \r\n          active: true, \r\n          speed: 0.0010, \r\n          animType: \"move\" \r\n       },\r\n       color: \r\n       {\r\n          active: true, \r\n          loopDuration: 6000, \r\n          animType: \"colorOscillation\", \r\n          val1:0xFFFFFF, \r\n          val2:0x00AAFF\r\n       }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.SpvVIO1eHYG96TGX"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"M8Cw55B22QnfykE6"}
{"name":"Activate Wind Barrier","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/spells/gust-of-wind.webp","scope":"global","command":"// 'Cast Relic Gift Wind Barrier' macro casts the Wind Barrier\n\n/*************\n *  Globals  *\n**************/\nconst effectImage = 'systems/pf2e/icons/spells/gust-of-wind.jpg';\n\n/************* \n * Functions *\n**************/\nasync function main() {\n\tif (!actor && canvas.tokens.controlled.length != 1) {\n\t\tui.notifications.warn(\"You must have a single actor selected.\");\n\t}\n\n\tlet task = args[0];\n\n\tswitch (task) {\n\t\tcase 'raiseShield':\n\t\t\traiseShield(actor);\n\t\t\tbreak;\n\t\tcase 'lowerShield':\n\t\t\tlowerShield(actor);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\ttoggleShield(actor);\n\t}\n}\n\nfunction toggleShield(actor) {\n\tif (token.data.effects.includes(effectImage)) {\n\t\tlowerShield(actor);\n\t} else {\n\t\traiseShield(actor);\n\t}\n}\n\nasync function lowerShield(actor) {\n\tui.notifications.info(`${actor.name}'s Wind Barrier expired.`);\n\n\tlet effectItems = actor.items.filter(item => item.type === 'effect' && item.name.includes(\"Gift Effect: Wind Barrier\"));\n\tfor (let effectItem of effectItems) {\n\t\tawait actor.deleteOwnedItem(effectItem._id);\n\t}\n\n\tif (token.data.effects.includes(effectImage)) {\n\t\ttoken.toggleEffect(effectImage);\n\t}\n}\n\nasync function raiseShield(actor) {\n\taddTurnAlert(actor);\n\tui.notifications.info(`${actor.name} casts Wind Barrier.`);\n\n\tlet effectItem = game.items.getName(\"Gift Effect: Wind Barrier\").data;\n\tawait actor.createOwnedItem(effectItem);\n\n\tif (!token.data.effects.includes(effectImage)) {\n\t\ttoken.toggleEffect(effectImage);\n\t}\n}\n\nfunction addTurnAlert(actor) {\n\tif (game.combat === null) {\n\t\treturn;\n\t}\n\n\t// Get the combat tracker id for the targeted token...\n\tlet combatant_target = game.combat.combatants.find(it => it.actor.id == actor.id);\n\n\tif (combatant_target === undefined) {\n\t\tui.notifications.warn(`${actor.data.name} is not in combat! They must be in combat for this macro to work.`);\n\t\treturn;\n\t}\n\n\t// Check if actor has acted yet or not this round and set Alert to this round if they haven't\n\tconst currentTurn = game.combat.turn;\n\tconst combatantTurn = game.combat.turns.findIndex(it => it.actor.id == actor.id);\n\tlet nextRound = (combatantTurn > currentTurn) ? 0 : 1;\n\n\tconst lowerShield_Alert = {\n\t\tname: \"Wind Barrier expires\",\n\t\tlabel: \"Wind Barrier expires\",\n\t\tturnId: combatant_target._id,\n\t\tround: nextRound,\n\t\tmacro: \"Activate Wind Barrier\",\n\t\targs: ['lowerShield']\n\t}\n\n\tTurnAlert.create(lowerShield_Alert);\n}\n\nmain();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"macro-marker":{"activeData":{"icon":"icons/svg/mage-shield.svg","tooltip":"Cast Shield   ","colour":"#ff0000","trigger":""}},"furnace":{"runAsGM":false},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"MPaigFlPG3ZCQ9dD"}
{"name":"Stealth For Selected Tokens","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/features/classes/surprice-attack.webp","scope":"global","command":"const tokens = canvas.tokens.controlled.filter((t) => ['character', 'npc', 'familiar'].includes(t.actor.data.type));\n\nif (tokens.length === 0) {\n    ui.notifications.error(`You must select at least one npc/pc token`);\n} else {\n    tokens.map((p) => p.actor).forEach((actor) => actor.data.data.skills.ste.roll(event, ['secret']));\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.pf2e.pf2e-macros.yBuEphSaJJ7V9Yw3"},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"MclrLi2xwBkCaEGY"}
{"name":"F - 07 - Import Template Settings (local)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// Open the console (F12) to check the state of the import\n\nTokenMagic.importTemplateSettings();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.QzFJd7hkaYesE7Ud"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"MlnusjSKIiVgr1k6"}
{"name":"33 - T02 - Saving Roll (transform)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n    [{\r\n        filterType: \"transform\",\r\n        filterId: \"savingRoll\",\r\n        autoDestroy: true,\r\n        padding: 80,\r\n        pivotX: 0.5,\r\n        pivotY: 0.55,\r\n        animated:\r\n        {\r\n            translationX:\r\n            {\r\n                animType: \"sinOscillation\",\r\n                val1: -0.220,\r\n                val2: +0.220,\r\n                loops: 1,\r\n                loopDuration: 1250\r\n            },\r\n            rotation:\r\n            {\r\n                animType: \"sinOscillation\",\r\n                val1: -360,\r\n                val2: +360,\r\n                loops: 1,\r\n                loopDuration: 1250,\r\n            },\r\n            scaleY:\r\n            {\r\n                animType: \"cosOscillation\",\r\n                val1: 1,\r\n                val2: 1.3,\r\n                loops: 2,\r\n                loopDuration: 625,\r\n            },\r\n            scaleX:\r\n            {\r\n                animType: \"cosOscillation\",\r\n                val1: 1,\r\n                val2: 1.4,\r\n                loops: 2,\r\n                loopDuration: 625,\r\n            }\r\n        }\r\n    }];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.Rcfdd8fQYH3Ripm1"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"MuBKza1DZtWJpHUl"}
{"name":"Set Darkvision","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/magic/perception/eye-tendrils-web-purple.webp","scope":"global","command":"// Open a dialog for quickly changing token vision parameters of the controlled tokens.\n\nif (canvas.tokens.controlled.length === 0)\n  return ui.notifications.error(\"Please select a token first\");\n\n\n// await User.updateDocuments(\n//   game.users.map(\n//     (user) => ({ _id: user.id, \"flags.pf2e.settings.darkvisionFilter\": !user.settings.darkvisionFilter })\n//   )\n// );\n\nawait canvas.tokens.controlled\n    .filter(token => token.actor.type == \"npc\")\n    .filter(token => token.actor.data.data.traits.senses.value.toLowerCase().includes(\"darkvision\"))\n    .map(token => {\n        console.log(\"Setting darkvision to 1000\");\n        token.update({brightSight: 1000});\n        token.actor.token.update({brightSight: 1000});\n    });\n\n// canvas.tokens.controlled\n//     .filter(token => token.actor.type == \"npc\")\n//     .filter(token => token.actor.data.data.traits.senses.value.toLowerCase().includes(\"low-light vision\"))\n//     .map(token => {\n//         console.log(\"Setting darkvision to 1000\");\n//         token.data.dimSight=1000;\n//     });","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_0bvuexgyxprc","path":"PC Macros#/CF_SEP/Jamz","color":"#940505"}},"_id":"N1Sd4llvG5nY1KDZ"}
{"name":"33 - T03 - Dodge Jump (transform)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n    [{\r\n        filterType: \"transform\",\r\n        filterId: \"jumpedDodge\",\r\n        autoDestroy: true,\r\n        padding: 80,\r\n        animated:\r\n        {\r\n            translationY:\r\n            {\r\n                animType: \"cosOscillation\",\r\n                val1: 0,\r\n                val2: -0.225,\r\n                loops: 1,\r\n                loopDuration: 900\r\n            },\r\n            scaleY:\r\n            {\r\n                animType: \"cosOscillation\",\r\n                val1: 1,\r\n                val2: 0.65,\r\n                loops: 2,\r\n                loopDuration: 450,\r\n            },\r\n            scaleX:\r\n            {\r\n                animType: \"cosOscillation\",\r\n                val1: 1,\r\n                val2: 0.65,\r\n                loops: 2,\r\n                loopDuration: 450,\r\n            }\r\n        }\r\n    }];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.snidZpTtUrrRZpiF"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"N813J5wbf3UX1doB"}
{"name":"24 - T05 - Mega - Ice Shell (on top)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myEarthFieldTop\",\r\n    shieldType: 5,\r\n    gridPadding: 3,\r\n    color: 0x00DDFF,\r\n    time: 0,\r\n    blend: 5,\r\n    intensity: 1.9,\r\n    lightAlpha: 0,\r\n    lightSize: 0,\r\n    scale: 1,\r\n    radius: 1,\r\n    zIndex: 5,\r\n    discardThreshold: 0.09,\r\n    alphaDiscard: true,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n},\r\n    {\r\n        filterType: \"xglow\",\r\n        filterId: \"myEarthFieldTopGlow\",\r\n        auraType: 1,\r\n        color: 0x5099DD,\r\n        thickness: 4.5,\r\n        scale: 1,\r\n        time: 0,\r\n        auraIntensity: 0.25,\r\n        subAuraIntensity: 1,\r\n        threshold: 0.5,\r\n        discard: false,\r\n        zOrder: 3000,\r\n        animated:\r\n        {\r\n            time:\r\n            {\r\n                active: true,\r\n                speed: 0.0018,\r\n                animType: \"move\"\r\n            },\r\n            thickness:\r\n            {\r\n                val1: 2, val2: 2.5,\r\n                animType: \"cosOscillation\",\r\n                loopDuration: 3000\r\n            },\r\n            subAuraIntensity:\r\n            {\r\n                val1: 0.45, val2: 0.65,\r\n                animType: \"cosOscillation\",\r\n                loopDuration: 6000\r\n            },\r\n            auraIntensity:\r\n            {\r\n                val1: 0.9, val2: 2.2,\r\n                animType: \"cosOscillation\",\r\n                loopDuration: 3000\r\n            }\r\n        }\r\n    }];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.QHFSZ2GTB3gdDijZ"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"NDnveyc2Ma5elRxh"}
{"name":"30 - T02 - Infernal Web (field+web)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params = \r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"infernalWeb\",\r\n    shieldType: 1,\r\n    gridPadding: 1.5,\r\n    color: 0xCC2050,\r\n    time: 0,\r\n    blend: 3,\r\n    intensity: 1,\r\n    lightAlpha: 1,\r\n    lightSize: 0.8,\r\n    scale: 1,\r\n    radius: 1,\r\n    chromatic: false,\r\n    zOrder: 512,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0012, \r\n        animType: \"move\" \r\n      },\r\n      lightSize:        \r\n      {\r\n        val1: 0.4, val2: 1.5,\r\n        animType: \"syncCosOscillation\",\r\n        loopDuration: 5000\r\n      }\r\n    }\r\n}\r\n,{\r\n    filterType: \"web\",\r\n    filterId: \"infernalWeb\",\r\n    time: 100,\r\n    div1: 16,\r\n    div2: 8,\r\n    tear: 0.45,\r\n    amplitude: 0.8,\r\n    thickness: 2,\r\n    color: 0xAA3030,\r\n    zOrder: 1024,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0005, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}]\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.D2su0oqd2SLY0uZ7"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"NgdVbL9NXq8CNi89"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_w4f9l9idxk","path":"GM Macros","color":"#940000","name":"GM Macros","children":["a5KtxMBnBdnOxGmQ","eGmEXGO1nnMjjXMU","8QtlWoC78j0MZU89","f76uNbnWRahFttLH","RZH5ymLyNSyFPQeQ","XWMmDEhrINB3jjZ1","Dayy7lyWNgIngEgV","M9MpZXgpHu5npvlD","FUdlEQuHcYvwCOVX","VyyAfrDJICoLfhdy","x0W7ScATL0nBK9FW","PLSLhfVcuyJ6fMkv","KEqp8vBo7imSu5wg","UBJaxS47Gxr76qWg","HuGGbacApqouXSNl","x84PaWKV26WQZcsz","nODun9eh8MXxpx85","kmfuSuMjG4kwyGln","wlMkpgkRmL6CVLFK","KPRXAQtFwuAAYDiT","hbPsegayRtkYK36Z","GIakK0Db3PyNi44C","o8yKdpCjzC1Lvxzt"],"folderPath":[]}},"_id":"Nk4H4K1Gbps3h7Q1"}
{"name":"27 - T03 - Ugly Villains Aura (xglow)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"zapshadow\",\r\n    filterId: \"myUglyZapShadow\",\r\n    alphaTolerance: 0.50\r\n},\r\n{\r\n    filterType: \"xglow\",\r\n    filterId: \"myUglyGlow\",\r\n    auraType: 2,\r\n    color: 0x050505,\r\n    thickness: 2.7,\r\n    scale: 7,\r\n    time: 0,\r\n    auraIntensity: 5,\r\n    subAuraIntensity: 2,\r\n    threshold: 0.08,\r\n    discard: false,\r\n    animated:\r\n    {\r\n        time : \r\n        {  \r\n           active: true,\r\n           speed: 0.0012, \r\n           animType: \"move\" \r\n        },\r\n        auraIntensity:\r\n        {\r\n           active: true,\r\n           loopDuration: 3000, \r\n           animType: \"syncCosOscillation\", \r\n           val1:5, \r\n           val2:0\r\n        },\r\n        subAuraIntensity:\r\n        {\r\n           active: true,\r\n           loopDuration: 3000, \r\n           animType: \"syncCosOscillation\", \r\n           val1:2, \r\n           val2:0\r\n        },\r\n        color:\r\n        {\r\n           active: true,\r\n           loopDuration: 6000, \r\n           animType: \"syncColorOscillation\", \r\n           val1:0x050505, \r\n           val2:0x200000\r\n        },\r\n        threshold:\r\n        {\r\n           active: true,\r\n           loopDuration: 1500, \r\n           animType: \"syncCosOscillation\", \r\n           val1:0.02, \r\n           val2:0.50\r\n        }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.ydY1XOCO4yIhunkj"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"NskX3BreaordVLmT"}
{"name":"35 - T10 - Animated SuperHeat (xfire+liquid+wave)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"xfire\",\r\n    filterId: \"myAnimSuperHeat\",\r\n    time: 0,\r\n    blend: 5,\r\n    amplitude: 0.5,\r\n    dispersion: -1,\r\n    chromatic: false,\r\n    scaleX: 1,\r\n    scaleY: 1,\r\n    inlay: true,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: -0.0090, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n},\r\n{\r\n    filterType: \"liquid\",\r\n    filterId: \"myAnimSuperHeat\",\r\n    color: 0xBB9500,\r\n    time: 0,\r\n    blend: 8,\r\n    intensity: 1,\r\n    spectral: false,\r\n    scale: 0.25,\r\n    animated :\r\n    {\r\n       time : \r\n       { \r\n          active: true, \r\n          speed: 0.0010, \r\n          animType: \"move\" \r\n       }\r\n    }\r\n},\r\n{\r\n    filterType: \"wave\",\r\n    filterId: \"myAnimSuperHeat\",\r\n    time: 0,\r\n    anchorX: 0.5,\r\n    anchorY: 0.5,\r\n    strength: 0.005,\r\n    frequency: 60,\r\n    color: 0xFFFFFF,\r\n    maxIntensity: 2.0,\r\n    minIntensity: 1.0,\r\n    padding:10,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0100, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.eBGBaCFsLO8b3lMb"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"OLc3zPPwLlvSAquW"}
{"name":"A - Multi-Filters Example","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"fog\",\r\n    color: 0x00FF50,\r\n    density: 0.20,\r\n    time: 0,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 1.2, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n},\r\n{\r\n    filterType: \"ray\",\r\n    time: 0,\r\n    color: 0x00DE50,\r\n    alpha: 0.25,\r\n    divisor: 32,\r\n    anchorY: 0,\r\n    animated :\r\n    {\r\n       time : \r\n       { \r\n          active: true, \r\n          speed: 0.0005, \r\n          animType: \"move\" \r\n       }\r\n    }\r\n},\r\n{\r\n    filterType: \"glow\",\r\n    distance: 10,\r\n    outerStrength: 8,\r\n    innerStrength: 0,\r\n    color: 0x003000,\r\n    quality: 0.5,\r\n    padding: 10,\r\n    animated:\r\n    {\r\n        color: \r\n        {\r\n           active: true, \r\n           loopDuration: 3000, \r\n           animType: \"colorOscillation\", \r\n           val1:0x003000, \r\n           val2:0x00EF00\r\n        }\r\n    }\r\n}\r\n];\r\n\r\nTokenMagic.addFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.tvDGSwbeQ97HNS8v"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"Ox6BZCiRQg19UM1K"}
{"_id":"P6nYdfJvJ6oiyFKW","name":"35 - T01 - Fire v2 (xfire)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"xfire\",\r\n    filterId: \"myFireV2XFire\",\r\n    time: 0,\r\n    blend: 1,\r\n    amplitude: 1,\r\n    dispersion: 0,\r\n    chromatic: false,\r\n    scaleX: 1.5,\r\n    scaleY: 1,\r\n    inlay: false,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: -0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.world.token-magic-dev.URV08yIJk4cBTppj"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"_id":"PLjhtPJATWOM7ccf","name":"Refresh Items from Compendium","type":"script","author":"oiPWLVPNH7xQBULr","img":"modules/game-icons-net/whitetransparent/orb-direction.svg","scope":"global","command":"for (const item of _token.actor.items) {\n    await item.sheet.refreshItemFromCompendium();\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.7RMUa2D1zKreuuw3"},"cf":{"id":"temp_jgmri56d4gm","path":"System Macros","color":"#02ac24"}}}
{"name":"24 - T10 - Evil Aura","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myEvilField\",\r\n    shieldType: 10,\r\n    gridPadding: 1,\r\n    color: 0xFF3010,\r\n    time: 0,\r\n    blend: 5,\r\n    intensity: 1,\r\n    lightAlpha: 4,\r\n    lightSize: 0.8,\r\n    scale: 0.5,\r\n    radius: 1,\r\n    chromatic: false,\r\n    zOrder: 512,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0012, \r\n        animType: \"move\" \r\n      },\r\n      lightSize:        \r\n      {\r\n        val1: 0.4, val2: 1.5,\r\n        animType: \"syncCosOscillation\",\r\n        loopDuration: 5000\r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.4Ywsytul1no7EwKb"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"Pa6ZsUbdKqNrKFY6"}
{"name":"24 - T06 - Air Bubble","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myAirField\",\r\n    shieldType: 6,\r\n    gridPadding: 1.2,\r\n    color: 0x7090AA,\r\n    time: 0,\r\n    blend: 1,\r\n    intensity: 1,\r\n    lightAlpha: 1,\r\n    lightSize: 0.7,\r\n    scale: 1,\r\n    radius: 1,\r\n    chromatic: false,\r\n    zOrder: 512,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.6Do4AOxfbtCG8R4j"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"PeSWJOiyODOYaNEP"}
{"name":"Add Persistent Damage","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/features/classes/brutality.webp","scope":"global","command":"PF2EPersistentDamage.showDialog();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_uqqajwofsun","path":"Macros","color":"#000000"}},"_id":"PvnIzkCDGxf77jjS"}
{"name":"Repair Sturdy Shield (Lesser)","type":"script","author":"oiPWLVPNH7xQBULr","img":"modules/Nerps-For-Foundry/images/rpg-icons/ResourcesAndCrafting/Tools/en_craft_31.webp","scope":"global","command":"if (!actor) {\n\tui.notifications.warn(\"You must have an actor selected\");\n} else {\n\tconst skillName = \"Craft\";\n\tconst skillKey = \"cra\";\n\tconst actionSlug = \"repair\"\n\tconst actionName = \"Repair\"\n\n\tconst modifiers = []\n\t// list custom modifiers for a single roll here\n\t//const modifiers = [\n\t//new game.pf2e.Modifier('Expanded Healer\\'s Tools', 1, 'item')\n\t//];\n\tconst level = token.actor.data.data.details.level.value;\n\n  \t// const DC = 14 + level + Math.floor(level / 3);\n  \tconst DC = 23; // Sturdy Shield (Lesser)\n//\tconst DC = 27; // Sturdy Shield (Moderate)\n\n    const skillRank = token.actor.data.data.skills[skillKey].rank\n\n    const repairSuccessTotal = 5 + (CheckFeat(\"crafters-eyepiece\") ? (skillRank * 10) : (skillRank * 5));\n    const hasCraftersEyepiece = CheckFeat(\"crafters-eyepiece\") ? `Crafter's Eyepiece: +${skillRank*5}` : \"\";\n\n\tconst notes = [...token.actor.data.data.skills[skillKey].notes]; // add more notes if necessary\n\tconst options = token.actor.getRollOptions(['all', 'skill-check', skillName.toLowerCase()]);\n\toptions.push(`action:${actionSlug}`); // add more traits here in new lines\n\tgame.pf2e.Check.roll(\n\t\tnew game.pf2e.CheckModifier(\n\t\t\t`<span class=\"pf2-icon\">A</span> <b>${actionName}</b> - <p class=\"compact-text\">${skillName} Skill Check</p><p class=\"compact-text\"><i>Repairs <b>${repairSuccessTotal} HP</b> on success, <b>${repairSuccessTotal*2} HP</b> on Critical Success, and deals 2d6 damage on Critical Fail.</i></p>${hasCraftersEyepiece}`,\n\t\t\ttoken.actor.data.data.skills[skillKey], modifiers),\n\t\t{ actor: token.actor, type: 'skill-check', options, notes, dc: { value: DC } },\n\t\tevent\n\t\t//, (Roll) => { console.log(Roll); } // for callback\n\t);\n}\n\nfunction CheckFeat(slug) {\n    if (token.actor.items.find(\n        (i) => i.data.data.slug === slug && i.type === 'equipment' && i.isInvested === true)) {\n        return true;\n    }\n    return false;\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_0bvuexgyxprc","path":"PC Macros#/CF_SEP/Jamz","color":"#940505"}},"_id":"QxSRXHyo7aPK6JcX"}
{"name":"05 - Glow","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"glow\",\r\n    filterId: \"superSpookyGlow\",\r\n    outerStrength: 4,\r\n    innerStrength: 0,\r\n    color: 0x5099DD,\r\n    quality: 0.5,\r\n    padding: 10,\r\n    animated:\r\n    {\r\n        color: \r\n        {\r\n           active: true, \r\n           loopDuration: 3000, \r\n           animType: \"colorOscillation\", \r\n           val1:0x5099DD, \r\n           val2:0x90EEFF\r\n        }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.g7O4u4dTaWcnajW7"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"RAB1MT6HaV6lng1s"}
{"name":"Add Timer","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/tools/navigation/hourglass-grey.webp","scope":"global","command":"const ITEM_UUID = 'Compendium.Nerps-For-Foundry.shared-items.O72nH1FuDpP6j9Zm'; // Timer: Generic\nconst effect = (await fromUuid(ITEM_UUID)).toObject();\n\ncountdownEffect();\n\nfunction countdownEffect() {\n\tlet template = `\n  <p>\n    Time: <input id=\"countdowninput\" type=\"string\" style=\"width: 50px;\" value=\"1d4\">\n\n\t<select name=\"durationUnit\" id=\"durationUnit\">\n\t\t<option value=\"rounds\" selected>Rounds</option>\n\t\t<option value=\"minutes\">Minutes</option>\n\t\t<option value=\"hours\">Hours</option>\n\t\t<option value=\"days\">Days</option>\n\t</select>\n  </p>\n  <p>\n    Name: <input id=\"countdownname\" type=\"string\" style=\"width: 100px;\" value=\"Countdown\">\n  </p> \n  <p>\n    <input type=\"checkbox\" id=\"cooldown\"/>\n    Cooldown (adds 1 to duration)\n  </p>\n  `;\n\n\tnew Dialog({\n\t\ttitle: \"Countdown Effect\",\n\t\tcontent: template,\n\t\tbuttons: {\n\t\t\tok: {\n\t\t\t\tlabel: \"Apply\",\n\t\t\t\tcallback: (html) => {\n\t\t\t\t\tmain(html);\n\t\t\t\t},\n\t\t\t},\n\t\t\tcancel: {\n\t\t\t\tlabel: \"Cancel\",\n\t\t\t},\n\t\t},\n\t}).render(true);\n}\n\nasync function main(html) {\n\tlet coolDownText = \"\";\n\tlet countdownNumber = \"\";\n\tlet duration = html.find(\"#countdowninput\")[0].value;\n\tlet durationUnit = html.find(\"#durationUnit\")[0].value;\n\tconst isCooldown = html.find(\"#cooldown\")[0].checked;\n\t\n\teffect.name = \"Timer: \" + html.find(\"#countdownname\")[0].value;\n\t\n\tif (duration.includes(\"d\")) {\n\t\tcountdownNumber = new Roll(duration).roll({ async: false }).total;\n\t} else {\n\t\tcountdownNumber = duration;\n\t}\n\t\n\tif (isCooldown) {\n\t\tcountdownNumber = parseInt(countdownNumber) + 1;\n\t\tcoolDownText = \"a cool down \";\n\t};\n\n\tui.notifications.info(`${actor.name} now has ${coolDownText}${effect.name} for ${countdownNumber} ${durationUnit}.`);\n\n\teffect.data.duration.value = countdownNumber;\n\teffect.data.duration.unit = durationUnit;\n\tawait token.actor.createEmbeddedDocuments(\"Item\", [effect]);\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_w4f9l9idxk","path":"GM Macros","color":"#940000"}},"_id":"RZH5ymLyNSyFPQeQ"}
{"name":"F - 04 - Import FX Presets (local)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// Open the console (F12) to check the state of the import\r\n// You can configure in the module option panel the \"overwrite mode on import\"\r\n\r\nTokenMagic.importPresetLibrary();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.QzFJd7hkaYesE7Ud"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"RbLEFS3P6O1xWi53"}
{"name":"37 - T03 - Fire Pentagram (sprite+xglow)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n[{\n    filterType: \"sprite\",\n    filterId: \"myFirePentagram\",\n    imagePath: \"modules/tokenmagic/fx/assets/pentagram.png\",\n    gridPadding: 2,\n    scaleX: 3,\n    scaleY: 3,\n    colorize: true,\n    color: 0x000000,\n    inverse: true,\n    top: false,\n    animated:\n        {\n          rotation: \n          { \n            active: true,\n            clockWise: false, \n            loopDuration: 4000, \n            animType: \"syncRotation\"\n          }\n        }\n},\n{\n    filterType: \"zapshadow\",\n    filterId: \"myFirePentagram\",\n    alphaTolerance: 0.50\n},\n{\n    filterType: \"xglow\",\n    filterId: \"myFirePentagram\",\n    auraType: 2,\n    color: 0x903010,\n    thickness: 9.8,\n    scale: 1.,\n    time: 0,\n    auraIntensity: 2,\n    subAuraIntensity: 1.5,\n    threshold: 0.40,\n    discard: true,\n    animated:\n    {\n        time : \n        {  \n           active: true,\n           speed: 0.0027, \n           animType: \"move\" \n        },\n        thickness:\n        {\n           active: true,\n           loopDuration: 3000, \n           animType: \"cosOscillation\", \n           val1:2, \n           val2:5\n        }\n    }\n}];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Macro.2bekjnAG0VHRtXGx"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"RrkCkEMXyRn99RqW"}
{"name":"36 - T01 - Turn into Mystery Man (polymorph)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// This macro contains a small tutorial : how to work with non-infinite loops and halfCosOscillation animType\n\n// Click once to transform your token and again to revert to the original shape (thank to halfCosOscillation)\n\n// There is 9 types of metamorphose\n// 1 - Simple transition\n// 2 - Dreamy\n// 3 - Twist\n// 4 - Water drop\n// 5 - TV Noise\n// 6 - Morphing\n// 7 - Take off/Put on you disguise!\n// 8 - Wind\n// 9 - Hologram\n\n// change the type here\nlet transitionType = 4;\n\n// change the target image here\nlet targetImagePath = \"icons/svg/mystery-man.svg\";\n\n// declare filter id (think to change the id for personal macros)\n// each filterId should be unique to a player or gm to prevent collisions\n// example : \"brutusChthulhuPolymorph\"\nlet polymorphFilterId = \"myPolymorph\";\n\n// we put our code into an async function that will be called later\nlet polymorphFunc = async function () {\n\n    for (const token of canvas.tokens.controlled) {\n        let params;\n        \n        // Is the filter already activated on the placeable ? \n        if (token.TMFXhasFilterId(polymorphFilterId)) {\n           \n            // Yes. So we update the type in the general section and loops + active in the progress animated section, to activate the animation for just one loop.\n            // \"type\" to allow you to change the animation type\n            // \"active\" to say at Token Magic : \"Hey filter! It's time to work again!\"\n            // \"loops\" so that Token Magic can know how many loops it needs to schedule for the animation.\n            // Each animation loop decreases \"loops\" by one. When \"loops\" reach 0, \"active\" becomes \"false\" and the animation will be dormant again.\n            // Thank to the halfCosOscillation, a loop brings the value of the property from val1 to val2. A second loop is needed to bring val2 to val1. This is useful for monitoring progress with back and forth movements.\n            params =\n                [{\n                    filterType: \"polymorph\",\n                    filterId: polymorphFilterId,\n                    type: transitionType,\n                    animated:\n                    {\n                        progress:\n                        {\n                            active: true,\n                            loops: 1\n                        }\n                    }\n                }];\n\n        } else {\n\n            // No. So we create the entirety of the filter\n            params =\n                [{\n                    filterType: \"polymorph\",\n                    filterId: polymorphFilterId,\n                    type: transitionType,\n                    padding: 70,\n                    magnify: 1,\n                    imagePath: targetImagePath,\n                    animated:\n                    {\n                        progress:\n                        {\n                            active: true,\n                            animType: \"halfCosOscillation\",\n                            val1: 0,\n                            val2: 100,\n                            loops: 1,\n                            loopDuration: 1000\n                        }\n                    }\n                }];\n        }\n\n        // all functions that add, update or delete filters are asynchronous\n        // if you are in a loop AND/OR you chain these functions, it is MANDATORY to await them\n        // otherwise, data persistence may not works.\n        // this is the reason why we use an async function (we cant use await in a non-async function)\n        // avoid awaiting in a forEach loop, use \"for\" or \"for/of\" loop.\n        await token.TMFXaddUpdateFilters(params);\n    }\n\n};\n\n// polymorph async function call\npolymorphFunc();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.lZefFMIYs8WYRpdZ"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"Sc83NOOaFqXRPnrY"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_9jlc9ozs6qm","path":"Effect Toggles","color":"#9900d1","name":"Effect Toggles","children":["7n0mz3Q0vsLgpUkS","7n0mz3Q0vsLgpUkS","7n0mz3Q0vsLgpUkS","LnMuATGBgmHnbbLr","8v5DFZsPmOyIIYZy","q2AHwt9TcovzrcNo","Weo89jdN2edPoIyG","ogielwlEHWFMUF6h","H4RaawEHGyAJ4fqM"],"folderPath":[]}},"_id":"SmxiZ5uqqTR0XE2R"}
{"name":"Take Cover","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/environment/settlement/fence-stone-brick.webp","scope":"global","command":"function CoverMacro() {\n    if (!actor) {\n        ui.notifications.warn(\"You must have an actor selected.\");\n        return;\n    }\n    coverDialog(actor).render(true);\n}\n\nfunction coverDialog(pc) {\n\n  const optsCover = [\n      {name: \"Lesser\"},\n      {name: \"Standard\"},\n      {name: \"Greater\"},\n      {name: \"Clear\"},\n  ]    \n  let coveringUp;\n\n  let content = `<p><strong>Character:</strong> ${pc.name}<br/>`;\n  content += '</p>';\n  content += '<hr/>';\n  content += '<div class=\"form-group\">';\n  content += '<p><label>Cover Type : </label><select id=\"coverType\">';\n  for (let i = 0 ; i < optsCover.length ; i++) {\n    content += `<option value='${i}'`;\n    content += `>${optsCover[i].name}</option>`;\n  }\n  content += '</select></p>';\n  content += '</div>';\n\n  return new Dialog({\n    title: \"Cover\",\n    content: content,\n    buttons: {\n      roll: {\n        icon: \"<i class='fas fa-check'></i>\",\n        label: \"Activate\",\n        callback: () => coveringUp = true,\n      },\n      cancel: {\n        icon: \"<i class='fas fa-times'></i>\",\n        label: \"Cancel\",\n        callback: () => coveringUp = false,\n      },\n    },\n    default: \"Activate\",\n    close: html => {\n        if (coveringUp) {\n            let chosenCover = optsCover[html.find('#coverType')[0].value];\n            activateCover(chosenCover.name);\n        }\n    }\n  });\n}\n\nasync function activateCover(chosenCover) {\n    let msgContent;\n    let myCover;\n    let takingCover = true;\n    let lesserCover = 'Compendium.pf2e.equipment-effects.lKkQvMzNG55Yhyef';\n    let standardCover = 'Compendium.pf2e.equipment-effects.I9lfZUiCwMiGogVi';\n    let greaterCover = 'Compendium.pf2e.equipment-effects.dlxrYwsliiZbsTYB';\n    let allCovers = [lesserCover, standardCover, greaterCover];\n    switch(chosenCover) {\n        case 'Clear':\n            var i;\n            for(i=0; i< allCovers.length; i++){\n                let existing = token.actor.items.find(\n                   (e) => e.type === 'effect' && e?.data?.flags?.core?.sourceId === allCovers[i],\n                );\n                if (existing) {\n                    await token.actor.deleteEmbeddedDocuments('Item', [existing.id]);\n                }\n            }\n            msgContent = \"Clearing cover modifiers for \";\n            takingCover = false;\n            break;\n        case 'Lesser':\n            myCover = lesserCover;\n            msgContent = \"Granting lesser cover to \";\n            break;\n        case 'Standard':\n            myCover = standardCover;\n            msgContent = \"Granting standard cover to \";\n            break;\n        case 'Greater':\n            myCover = greaterCover;\n            msgContent = \"Granting greater cover to \";\n            break;\n        default:\n    }\n\n    \n    if (takingCover) {\n        const item = (await fromUuid(myCover)).toObject();\n        await token.actor.createEmbeddedDocuments('Item', [item]);    \n    }\n    \n    msgContent = msgContent + actor.data.name\n\n    let chatData = {\n        user: game.user.id,\n        content: msgContent,\n        whisper: [game.user.id],\n    };\n    ChatMessage.create(chatData, {});\n}\n\n\nCoverMacro()","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.pf2e.pf2e-macros.jO4Ipjz3BGo6ZzG9"},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"TBKnyIMAjLq0cqBF"}
{"name":"00 - A - Delete filters on Selected","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// Delete all filters on the selected tokens/tiles\nTokenMagic.deleteFiltersOnSelected();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.DCRnfJDBd25fOQxc"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"TdLuTpQB9BIVjavx"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_4684sw9cu1y","path":"PC Macros#/CF_SEP/Clint","color":"#363636","name":"Clint","children":["Y9IIMIzitE4hbI82"],"folderPath":["temp_qx20rfr41e"]}},"_id":"TiMp1Vw7oqOfH722"}
{"name":"Ignore Difficult Terrain","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/features/classes/wild-stride.webp","scope":"global","command":"game.pf2e.rollItemMacro(\"G6pSbk7D7f9XPCqA\");","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"pf2e":{"itemMacro":true},"cf":{"id":"temp_qs7elflrmm","path":"PC Macros#/CF_SEP/Marc","color":"#3328cc"}},"_id":"U3sHqpz91ixga9qo"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_56ygvkoskmv","path":"PC Macros#/CF_SEP/Chewy","color":"#2844cc","name":"Chewy","children":["q2AHwt9TcovzrcNo","q2AHwt9TcovzrcNo","q2AHwt9TcovzrcNo","ogielwlEHWFMUF6h"],"folderPath":["temp_qx20rfr41e"]}},"_id":"UOJeOHLHsEkHNlbU"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_qs7elflrmm","path":"PC Macros#/CF_SEP/Marc","color":"#3328cc","name":"Marc","children":["Ua35yDdbVe2OkRDs","te1QxgMnlrHvEEdo","U3sHqpz91ixga9qo"],"folderPath":["temp_qx20rfr41e"]}},"_id":"UOsvUoFcL3ImYnIc"}
{"name":"23 - T01 - Mirror Images","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n[{\n    filterType: \"images\",\n    filterId: \"myMirrorImages\",\n    time: 0,\n    nbImage: 4,\n    alphaImg: 1.0,\n    alphaChr: 0.0,\n    blend: 4,\n    ampX: 0.10,\n    ampY: 0.10,\n    zOrder: 20,\n    animated :\n    {\n      time: \n      { \n        active: true, \n        speed: 0.0010, \n        animType: \"move\" \n      }\n    }\n}];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.Ac6lTCiwnycb2Hbw"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"UWPBpN92gi4c7qDP"}
{"name":"Effect: Align Armament (Chaotic)","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/spells/weapon-storm.webp","scope":"global","command":"const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\nif (!actors.length && game.user.character) {\n    actors.push(game.user.character);\n}\nconst ITEM_UUID = 'Compendium.pf2e.feat-effects.XC3dRbwfu35vuvmM'; // Effect: Align Armament (Chaotic)\nconst source = (await fromUuid(ITEM_UUID)).toObject();\nsource.flags.core ??= {};\nsource.flags.core.sourceId = ITEM_UUID;\nfor await (const actor of actors) {\n    const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === ITEM_UUID);\n    if (existing) {\n        await existing.delete();\n    } else {\n        await actor.createEmbeddedDocuments('Item', [source]);\n    }\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_qs7elflrmm","path":"PC Macros#/CF_SEP/Marc","color":"#3328cc"}},"_id":"Ua35yDdbVe2OkRDs"}
{"name":"Exploration Activities","type":"script","author":"oiPWLVPNH7xQBULr","img":"modules/Nerps-For-Foundry/images/Exploration Actions/small/Exploration-Mode.webp","scope":"global","command":"// allows  choice for the exploration activity selected\n\nlet baseDir = \"modules/Nerps-For-Foundry/images/Exploration%20Actions/small/\"\n\nif (!token) {\n\tui.notifications.warn(\"You must have an actor selected.\");\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Avoid-Notice.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Avoid-Notice.webp\")\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Defend.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Defend.webp\")\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Detect-Magic.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Detect-Magic.webp\")\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Follow-The-Expert.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Follow-The-Expert.webp\")\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Hustle.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Hustle.webp\")\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Investigate.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Investigate.webp\")\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Repeat-A-Spell.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Repeat-A-Spell.webp\")\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Scout.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Scout.webp\")\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Search.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Search.webp\")\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Identify-Alchemy.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Identify-Alchemy.webp\")\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Identify-Magic.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Identify-Magic.webp\")\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Repair.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Repair.webp\")\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Refocus.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Refocus.webp\")\n\treturn\n}\nif (token.data.effects.includes(baseDir + \"Treat-Wounds.webp\")) {\n\ttoken.toggleEffect(baseDir + \"Treat-Wounds.webp\")\n\treturn\n}\n\n\n\n\n\n\n\n\n\n\n\nlet mustRoll = false;\nlet clearIcon = false;\nlet options = [\n\t{ name: \"Avoid Notice\", item: \"AN\" },\n\t{ name: \"Defend\", item: \"D\" },\n\t{ name: \"Detect Magic\", item: \"DM\" },\n\t{ name: \"Follow the Expert\", item: \"FTE\" },\n\t{ name: \"Hustle\", item: \"H\" },\n\t{ name: \"Investigate\", item: \"I\" },\n\t{ name: \"Repeat a Spell\", item: \"RAS\" },\n\t{ name: \"Scout\", item: \"S\" },\n\t{ name: \"Search\", item: \"SCH\" },\n\t{ name: \"Identify Alchemy\", item: \"ALC\" },\n\t{ name: \"Identify Magic\", item: \"MAG\" },\n\t{ name: \"Repair\", item: \"RE\" },\n\t{ name: \"Refocus\", item: \"RF\" },\n\t{ name: \"Treat Wounds\", item: \"TW\" },\n];\n\n\nlet content = `\n<style>\n      #pf2-template-creator header {\n        border-radius: 0;\n        background: linear-gradient(90deg, var(--secondary) 0%, #202b93 50%, var(--secondary) 100%);\n        border: none;\n        box-shadow: inset 0 0 0 1px #9f725b,inset 0 0 0 2px var(--tertiary),inset 0 0 0 3px #956d58;\n        margin-bottom: 2px;\n        font-size: .75rem;\n      }\n#pf2-template-creator .window-content {\n        background-size: cover;\n        padding: 9px;\n        background-origin: border-box;\n        color: #000;\n        border-width: 9px;\n        border-image: url(systems/pf2e/assets/sheet/corner-box.webp) 9 repeat;\n        border-style: solid;\n        border-image-outset: 0;\n      }\n      #pf2-template-creator form {\n        margin-bottom: 20px;\n      }\n      #pf2-template-creator .form-fields.buttons {\n        justify-content: flex-start !important;\n      }\n      #pf2-template-creator .button {\n        flex: 1 !important;\n        border-width: 9px;\n        border-image: url(systems/pf2e/assets/sheet/corner-box.webp) 9 repeat;\n        font-size: 12px;\n        padding: 0;\n        background: linear-gradient(90deg, var(--secondary) 0%, #202b93 50%, var(--secondary) 100%);\n        color: #fff;\n        cursor: pointer;\n      }\n      #pf2-template-creator .button:hover {\n        box-shadow: 0 0 8px black;\n      }\n      #pf2-template-creator .radios input[type=\"radio\"] {\n        opacity: 0;\n        position: fixed;\n        width: 0;\n      }\n      #pf2-template-creator .radios label {\n        cursor: pointer;\n        display: flex;\n        flex: 1 !important;\n        margin: -2px 0;\n        background: rgba(0, 0, 0, 0.1);\n        border: 2px groove #f0f0e0;\n        width: 100%;\n        border-radius: 3px;\n        font-size: 13px;\n        font-family: \"Signika\", sans-serif;\n        justify-content: center;\n        align-items: center;\n        background: #171f69;\n        color: #fff;\n        border-width: 9px;\n        border-image: url(systems/pf2e/assets/sheet/corner-box.webp) 9 repeat;\n      }\n      #pf2-template-creator .radios label i {\n        margin-right: 5px;\n        color: #fff;\n        background: #171f69;\n      }\n      #pf2-template-creator .radios label:hover {\n        box-shadow: 0 0 8px black;\n      }\n      #pf2-template-creator .radios input[type=\"radio\"]:checked + label {\n        background: #212121;\n      }\n      #pf2-template-creator .dialog-button {\n        height: 50px;\n        background: linear-gradient(90deg, var(--secondary) 0%, #202b93 50%, var(--secondary) 100%);\n        border-image: url(systems/pf2e/assets/sheet/corner-box.webp) 9 repeat;\n        color: #fff;\n        border-width: 9px;\n        display: inline-flex;\n        justify-content: space-evenly;\n        align-items: center;\n        cursor: pointer;\n      }\n      #pf2-template-creator .dialog-button:hover {\n        box-shadow: 0 0 8px black;\n      }\n      #pf2-template-creator .notes {\n        color: #000 !important;\n        flex: 0 0 100% !important;\n        font-size: 12px !important;\n        line-height: 16px !important;\n        margin: 10px 0 5px 0 !important;\n      }\n      #pf2-template-creator .notes.title {\n        border-bottom: 1px solid #000;\n        font-size: 14px !important;\n        font-weight: bold;\n        margin: 10px 0 10px 0 !important;\n      }\n      #pf2-template-creator .notes.toptitle {\n        font-size: 14px !important;\n        font-weight: bold;\n        margin: 0px 0 10px 0 !important;\n      }\n    </style>\n<div style=\"font-size: large; line-height: 50px; height: 50px; color: #000; text-align: left; vertical-align: middle; position: relative;\"><img src=\"modules/Nerps-For-Foundry/images/Exploration%20Actions/small/Exploration-Mode.webp\" width=\"50\" height=\"50\" position=\"absolute\" align=\"left\" style=\"border:2px solid #000\" \\><b>&nbsp<u>Exploration Activities</u></b></div><div class=\"choices\"><p><select  class=\"choices\" id=\"selectTest\">`;\nfor (let i = 0; i < options.length; i++) {\n\tif (options[i].group !== undefined)\n\t\tcontent += `<optgroup label='${options[i].group}'/>`;\n\telse\n\t\tcontent += `<option class=\"choices other\" value='${i}'>${options[i].name}</option>`;\n}\ncontent += `</select></p>`;\n\n\n\ncontent += `</div>`;\n\nlet dialog = new Dialog({\n\ttitle: \"Exploration Activity\",\n\tcontent: content,\n\tbuttons: {\n\t\troll: {\n\t\t\ticon: \"<i class='fas fa-check'></i>\",\n\t\t\tlabel: \"Confirm\",\n\t\t\tcallback: () => mustRoll = true,\n\t\t},\n\t\tcancel: {\n\t\t\ticon: \"<i class='fas fa-times'></i>\",\n\t\t\tlabel: \"Cancel\",\n\t\t\tcallback: () => mustRoll = false,\n\t\t},\n\t\tclear: {\n\t\t\ticon: \"<i class='fas fa-times'></i>\",\n\t\t\tlabel: \"Clear\",\n\t\t\tcallback: () => clearIcon = true,\n\t\t},\n\t},\n\tdefault: \"roll\",\n\tclose: html => {\n\t\tif (clearIcon) {\n\t\t\tif (token.data.effects.includes(baseDir + \"Avoid-Notice.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Avoid-Notice.webp\")\n\t\t\t}\n\t\t\tif (token.data.effects.includes(baseDir + \"Defend.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Defend.webp\")\n\t\t\t}\n\t\t\tif (token.data.effects.includes(baseDir + \"Detect-Magic.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Detect-Magic.webp\")\n\t\t\t}\n\t\t\tif (token.data.effects.includes(baseDir + \"Follow-The-Expert.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Follow-The-Expert.webp\")\n\t\t\t}\n\t\t\tif (token.data.effects.includes(baseDir + \"Hustle.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Hustle.webp\")\n\t\t\t}\n\t\t\tif (token.data.effects.includes(baseDir + \"Investigate.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Investigate.webp\")\n\t\t\t}\n\t\t\tif (token.data.effects.includes(baseDir + \"Repeat-A-Spell.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Repeat-A-Spell.webp\")\n\t\t\t}\n\t\t\tif (token.data.effects.includes(baseDir + \"Scout.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Scout.webp\")\n\t\t\t}\n\t\t\tif (token.data.effects.includes(baseDir + \"Search.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Search.webp\")\n\t\t\t}\n\t\t\tif (token.data.effects.includes(baseDir + \"Identify-Alchemy.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Identify-Alchemy.webp\")\n\t\t\t}\n\t\t\tif (token.data.effects.includes(baseDir + \"Identify-Magic.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Identify-Magic.webp\")\n\t\t\t}\n\t\t\tif (token.data.effects.includes(baseDir + \"Repair.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Repair.webp\")\n\n\t\t\t}\n\t\t\tif (token.data.effects.includes(baseDir + \"Refocus.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Refocus.webp\")\n\n\t\t\t}\n\t\t\tif (token.data.effects.includes(baseDir + \"Treat-Wounds.webp\")) {\n\t\t\t\ttoken.toggleEffect(baseDir + \"Treat-Wounds.webp\")\n\n\t\t\t}\n\t\t}\n\t\tif (mustRoll) {\n\t\t\tlet choice = options[html.find('#selectTest')[0].value].name;\n\t\t\tlet setcolour = ``;\n\t\t\tlet saystuff = ``;\n\t\t\tlet descoutput = ``\n\n\t\t\tif (choice === 'Avoid Notice') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `creeps around trying to move silently`;\n\t\t\t\tdescoutput += `You attempt a Stealth check to avoid notice while traveling at half speed. If you have the Swift Sneak feat, you can move at full Speed rather than half, but you still cant use another exploration activity while you do so. If you have the Legendary Sneak feat, you can move at full Speed and use a second exploration activity. If youre Avoiding Notice at the start of an encounter, you usually roll a Stealth check instead of a Perception check both to determine your initiative and to see if the enemies notice you (based on their Perception DCs, as normal for Sneak, regardless of their initiative check results).`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Avoid-Notice.webp\")\n\t\t\t}\n\t\t\tif (choice === 'Defend') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `raises their shield and moves slowly looking for an imminent attack`;\n\t\t\t\tdescoutput += `You move at half your travel speed with your shield raised. If combat breaks out, you gain the benefits of Raising a Shield before your first turn begins.`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Defend.webp\")\n\n\t\t\t\t// Why not go ahead and raise the shield for them then...\n\t\t\t\tgame.pf2e.actions.raiseAShield({ actors: [token?.actor ?? actor ?? game.use.character].filter((actor) => actor) })\n\t\t\t}\n\t\t\tif (choice === 'Detect Magic') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `looks around but not really focused on the real world`;\n\t\t\t\tdescoutput += `You cast detect magic at regular intervals. You move at half your travel speed or slower. You have no chance of accidentally overlooking a magic aura at a travel speed up to 300 feet per minute, but must be traveling no more than 150 feet per minute to detect magic auras before the party moves into them.`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Detect-Magic.webp\")\n\n\t\t\t}\n\n\t\t\tif (choice === 'Follow the Expert') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `tries to help someone who looks like they know what they are doing`;\n\t\t\t\tdescoutput += `Choose an ally attempting a recurring skill check while exploring, such as climbing, or performing a different exploration tactic that requires a skill check (like Avoiding Notice). The ally must be at least an expert in that skill and must be willing to provide assistance. While Following the Expert, you match their tactic or attempt similar skill checks. Thanks to your allys assistance, you can add your level as a proficiency bonus to the associated skill check, even if youre untrained. Additionally, you gain a circumstance bonus to your skill check based on your allys proficiency (+2 for expert, +3 for master, and +4 for legendary).`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Follow-The-Expert.webp\")\n\n\t\t\t}\n\t\t\tif (choice === 'Hustle') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `jogs quickly onwards`;\n\t\t\t\tdescoutput += `You strain yourself to move at double your travel speed. You can Hustle only for a number of minutes equal to your Constitution modifier  10 (minimum 10 minutes). If you are in a group that is Hustling, use the lowest Constitution modifier among everyone to determine how fast the group can Hustle together.`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Hustle.webp\")\n\n\t\t\t}\n\t\t\tif (choice === 'Investigate') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `peers intently at something, scratching their head`;\n\t\t\t\tdescoutput += `You seek out information about your surroundings while traveling at half speed. You use Recall Knowledge as a secret check to discover clues among the various things you can see and engage with as you journey along. You can use any skill that has a Recall Knowledge action while Investigating, but the GM determines whether the skill is relevant to the clues you could find.`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Investigate.webp\")\n\n\t\t\t}\n\t\t\tif (choice === 'Repeat a Spell') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `mumbles something under their breath`;\n\t\t\t\tdescoutput += `You repeatedly cast the same spell while moving at half speed. Typically, this spell is a cantrip that you want to have in effect in the event a combat breaks out, and it must be one you can cast in 2 actions or fewer. In order to prevent fatigue due to repeated casting, youll likely use this activity only when something out of the ordinary occurs. You can instead use this activity to continue Sustaining a Spell or Activation with a sustained duration. Most such spells or item effects can be sustained for 10 minutes, though some specify they can be sustained for a different duration.`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Repeat-A-Spell.webp\")\n\n\t\t\t}\n\t\t\tif (choice === 'Scout') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `keeps an eye out for any adversaries<br />@Compendium[Nerps-For-Foundry.shared-items.XYvgSSBZeAU8ve7v]{Exploration Effect: Scouting}`;\n\t\t\t\tdescoutput += `You scout ahead and behind the group to watch danger, moving at half speed. At the start of the next encounter, every creature in your party gains a +1 circumstance bonus to their initiative rolls.`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Scout.webp\")\n\n\t\t\t}\n\t\t\tif (choice === 'Search') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `looks through all the stuff around them`;\n\t\t\t\tdescoutput += `You Seek meticulously for hidden doors, concealed hazards, and so on. You can usually make an educated guess as to which locations are best to check and move at half speed, but if you want to be thorough and guarantee you checked everything, you need to travel at a Speed of no more than 300 feet per minute, or 150 feet per minute to ensure you check everything before you walk into it. You can always move more slowly while Searching to cover the area more thoroughly, and the Expeditious Search feat increases these maximum Speeds. If you come across a secret door, item, or hazard while Searching, the GM will attempt a free secret check to Seek to see if you notice the hidden object or hazard. In locations with many objects to search, you have to stop and spend significantly longer to search thoroughly.`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Search.webp\")\n\t\t\t}\n\t\t\tif (choice === 'Identify Alchemy') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `attemps to identify an alchemical item`;\n\t\t\t\tdescoutput += `<p><span id=\"ctl00_MainContent_DetailedOutput\"><strong>Requirements</strong> You have @Compendium[pf2e.equipment-srd.4ftXXUCBHcf4b0MH]{Alchemist&rsquo;s Tools}.</span></p><hr /><p>You can identify the nature of an alchemical item with 10 minutes of testing using alchemist&rsquo;s tools. If your attempt is interrupted in any way, you must start over.</p><p><strong><u>success</u></strong> You identify the item and the means of activating it.<br /><strong><u>failure</u></strong> You fail to identify the item but can try again.<br /><strong><u>critical failure</u></strong> You misidentify the item as another item of the GM&rsquo;s choice.</p>`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Identify-Alchemy.webp\")\n\t\t\t}\n\t\t\tif (choice === 'Identify Magic') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `attemps to identify a magical item`;\n\t\t\t\tdescoutput += `<p><span id=\"ctl00_MainContent_DetailedOutput\">Once you discover that an item, location, or ongoing effect is magical, you can spend 10 minutes to try to identify the particulars of its magic. If your attempt is interrupted, you must start over. The GM sets the DC for your check. Cursed or esoteric subjects usually have higher DCs or might even be impossible to identify using this activity alone. Heightening a spell doesn&rsquo;t increase the DC to identify it.<br /></span></p><p><span id=\"ctl00_MainContent_DetailedOutput\"><strong><u>critical success</u></strong> You learn all the attributes of the magic, including its name (for an effect), what it does, any means of activating it (for an item or location), and whether it is cursed.<br /><strong><u>success</u></strong> For an item or location, you get a sense of what it does and learn any means of activating it. For an ongoing effect (such as a spell with a duration), you learn the effect&rsquo;s name and what it does. You can&rsquo;t try again in hopes of getting a critical success.<br /><strong><u>failure</u></strong> You fail to identify the magic and can&rsquo;t try again for 1 day.<br /><strong><u>critical failure</u></strong> You misidentify the magic as something else of the GM&rsquo;s choice.</span></p>`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Identify-Magic.webp\")\n\t\t\t}\n\t\t\tif (choice === 'Repair') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `attemps to repair an item`;\n\t\t\t\tdescoutput += `<p><span id=\"ctl00_MainContent_DetailedOutput\"><strong>Requirements</strong> You have a @Compendium[pf2e.equipment-srd.vLGDUFrg4yGzpTQX]{Repair Kit}</span></p><hr /><p>You spend 10 minutes attempting to fix a damaged item, placing the item on a stable surface and using the repair&nbsp;kit with both&nbsp;hands. The GM sets the DC, but it&rsquo;s usually about the same DC to Repair a given item as it is to Craft it in the first place. You can&rsquo;t Repair a destroyed item.<br /><br /><strong><u>critical success</u></strong> You restore 10 Hit Points to the item, plus an additional 10 Hit Points per proficiency rank you have in Crafting (a total of 20 HP if you&rsquo;re trained, 30 HP if you&rsquo;re an expert, 40 HP if you&rsquo;re a master, or 50 HP if you&rsquo;re legendary).<br /><strong><u>success</u></strong> You restore 5 Hit Points to the item, plus an additional 5 per proficiency rank you have in Crafting (for a total of 10 HP if you are trained, 15 HP if you&rsquo;re an expert, 20 HP if you&rsquo;re a master, or 25 HP if you&rsquo;re legendary).<br /><strong><u>critical failure</u></strong> You deal 2d6 damage to the item. Apply the item&rsquo;s Hardness to this damage.</p>`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Repair.webp\")\n\t\t\t}\n\t\t\tif (choice === 'Refocus') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `take time to refocus himself`;\n\t\t\t\tdescoutput += `<p><strong>Requirements</strong> You have a focus pool, and you have spent at least 1 focus Point since you last regained any focus Points.</p><hr /><p>You spend 10 minutes performing deeds to restore your magical connection. This restores 1 focus Point to your focus pool. The deeds you need to perform are specified in the class or ability that gives you your focus spells. These deeds can usually overlap with other tasks that relate to the source of your focus spells. For instance, a cleric with focus spells from a good deity can usually Refocus while tending the wounds of their allies, and a wizard of the illusionist school might be able to Refocus while attempting to Identify Magic of the illusion school.</p>`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Refocus.webp\")\n\t\t\t}\n\t\t\tif (choice === 'Treat Wounds') {\n\t\t\t\tsetcolour += `000000`;\n\t\t\t\tsaystuff += `prepare to heal some wounds`;\n\t\t\t\tdescoutput += `<p><strong>Requirements </strong>You have @Compendium[pf2e.equipment-srd.s1vB3HdXjMigYAnY]{Healer&rsquo;s Tools}</p><hr /><p>You spend 10 minutes treating one injured living creature (targeting yourself, if you so choose). The target is then temporarily immune to Treat Wounds actions for 1 hour, but this interval overlaps with the time you spent treating (so a patient can be treated once per hour, not once per 70 minutes).</p><p>The Medicine check DC is usually 15, though the GM might adjust it based on the circumstances, such as treating a patient outside in a storm, or treating magically cursed wounds. If you&rsquo;re an expert in Medicine, you can instead attempt a DC 20 check to increase the Hit Points regained by 10; if you&rsquo;re a master of Medicine, you can instead attempt a DC 30 check to increase the Hit Points regained by 30; and if you&rsquo;re legendary, you can instead attempt a DC 40 check to increase the Hit Points regained by 50. The damage dealt on a critical failure remains the same.</p><p>If you succeed at your check, you can continue treating the target to grant additional healing. If you treat them for a total of 1 hour, double the Hit Points they regain from Treat Wounds.</p><p>The result of your Medicine check determines how many Hit Points the target regains.<br /><br /><strong><u>critical success</u></strong> The target regains 4d8 Hit Points, and its wounded condition is removed.<br /><strong><u>success</u></strong> The target regains 2d8 Hit Points, and its wounded condition is removed.<br /><strong><u>critical failure</u></strong> The target takes 1d8 damage.&nbsp;</p>`;\n\t\t\t\ttoken.toggleEffect(baseDir + \"Treat-Wounds.webp\")\n\t\t\t}\n\n\n\t\t\t// create the message\n\t\t\tlet messageContent1 = '';\n\n\t\t\tmessageContent1 += `<p>${token.name} ${saystuff}</p><hr><details closed=\"\"><summary><a>Exploration Activity: ${choice}</a></summary><p>${descoutput}</p></details>`\n\t\t\tif (messageContent1 !== '') {\n\t\t\t\tlet chatData = {\n\t\t\t\t\tuser: game.user._id,\n\t\t\t\t\tspeaker: ChatMessage.getSpeaker(),\n\t\t\t\t\tcontent: messageContent1,\n\t\t\t\t};\n\t\t\t\tChatMessage.create(chatData, {});\n\n\n\t\t\t}\n\t\t}\n\t}\n},\n\t{\n\t\tid: 'pf2-template-creator'\n\t}); dialog.render(true);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"exportSource":{"world":"aoa1","system":"pf2e","coreVersion":"0.7.1","systemVersion":"1.10.2.1717"},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"UpgJAXrxxI0jxmVW"}
{"name":"Cast Bless","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/spells/bless.webp","scope":"global","command":"// Toggle an \"Effect\" on a actor for a random duration\n\n/*************\n *  Globals  *\n**************/\nconst effectName = 'Spell Effect: Bless';\nconst numberOfRounds = 10;\n\n/************* \n * Functions *\n**************/\nasync function main() {\n\tif (!actor && canvas.tokens.controlled.length != 1) {\n\t\tui.notifications.warn(\"You must have a single actor selected.\");\n\t}\n\n\tlet task = args[0];\n\n\tswitch (task) {\n\t\tcase 'addEffect':\n\t\t\taddEffect(actor);\n\t\t\tbreak;\n\t\tcase 'removeEffect':\n\t\t\tremoveEffect(actor);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\taddEffect(actor);\n\t}\n}\n\n// function toggleEffect(actor) {\n// \tlet effectItems = actor.items.filter(item => item.type === 'effect' && item.name.includes(effectName));\n\n// \tif (effectItems.length > 0) {\n// \t\tremoveEffect(actor);\n// \t} else {\n// \t\taddEffect(actor);\n// \t}\n// }\n\nasync function removeEffect(actor) {\n\tui.notifications.info(`${actor.name}'s ${effectName} expired.`);\n\n\tlet effectItems = actor.items.filter(item => item.type === 'effect' && item.name.includes(effectName));\n\tfor (let effectItem of effectItems) {\n\t\tawait actor.deleteOwnedItem(effectItem._id);\n\t}\n\tawait removeTemplate(actor.token);\n}\n\nasync function addEffect(actor) {\n\taddTurnAlert(actor);\n\n\tlet effectItem = game.items.getName(effectName).data;\n\t// numberOfRounds = effectItem.data.duration.value;\n\n\tui.notifications.info(`${actor.name} now has ${effectName} for ${numberOfRounds} ${effectItem.data.duration.unit}.`);\n\n\tawait actor.createOwnedItem(effectItem);\n\tawait addTemplate(actor.token);\n}\n\nfunction addTurnAlert(actor) {\n\tif (game.combat === null) {\n\t\treturn;\n\t}\n\n\t// Get the combat tracker id for the targeted token...\n\tlet combatant_target = game.combat.combatants.find(it => it.actor.id == actor.id);\n\n\tif (combatant_target === undefined) {\n\t\tui.notifications.warn(`${actor.data.name} is not in combat! They must be in combat for this macro to work.`);\n\t\treturn;\n\t}\n\n\t// Check if actor has acted yet or not this round and set Alert to this round if they haven't\n\tconst currentTurn = game.combat.turn;\n\tconst combatantTurn = game.combat.turns.findIndex(it => it.actor.id == actor.id);\n\tlet nextRound = (combatantTurn > currentTurn) ? 0 : 1;\n\tnextRound += numberOfRounds -1;\n\n\tconst removeEffect_Alert = {\n\t\tname: `${effectName} expires`,\n\t\tlabel: `${effectName} expires`,\n\t\tturnId: combatant_target._id,\n\t\tround: nextRound,\n\t\t// endOfTurn: true,\n\t\tmacro: \"Cast Bless\",\n\t\targs: ['removeEffect']\n\t}\n\n\tTurnAlert.create(removeEffect_Alert);\n}\n\nasync function addTemplate() {\n\tlet templateSize = 5;\n\tlet elements = await tokenAttacher.getAllAttachedElementsByTypeOfToken(token, \"MeasuredTemplate\");\n\n\tif (elements.length > 0) {\n\t\tawait tokenAttacher.detachAllElementsFromToken(token);\n\n\t\ttemplateSize = canvas.templates.get(elements[0]).data.distance + 5;\n\t\tconsole.log(\"*** templateSize:\", templateSize);\n\n\t\tcanvas.templates.get(elements[0]).delete();\n\t}\n\n\tconst element = await MeasuredTemplate.create({\n\t\tt: \"circle\",\n\t\tuser: game.user._id,\n\t\tx: token.center.x,\n\t\ty: token.center.y,\n\t\tdirection: 0,\n\t\tdistance: templateSize,\n\t\tborderColor: \"#000000\",\n\t\tfillColor: \"#000077\"\n\t\t//   texture: \"links/Effects/AnimatedArt/Runes/teleportationCircle2.webm\"\n\t});\n\n\tawait tokenAttacher.attachElementToToken(element, token)\n}\n\nasync function removeTemplate() {\n\tlet elements = await tokenAttacher.getAllAttachedElementsByTypeOfToken(token, \"MeasuredTemplate\");\n\n\tif (elements.length > 0) {\n\t\tawait tokenAttacher.detachAllElementsFromToken(token);\n\t\tcanvas.templates.get(elements[0]).delete();\n\t}\n}\n\nmain();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_5lpecs4iq07","path":"Under Construction","color":"#e68600"}},"_id":"UujvOC9OdMnvAxYJ"}
{"name":"10 - T01 - Bulge (transform)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n    [{\n        filterType: \"transform\",\n        filterId: \"myBulgeTransform\",\n        bpRadiusPercent: 70,\n        padding: 100,\n        animated:\n        {\n            bpStrength:\n            {\n                animType: \"cosOscillation\",\n                val1: 0,\n                val2: 0.65,\n                loopDuration: 3500,\n            }\n        }\n    }];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.FBQzhLveCvFKOvJ7"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"UyQPFqEINkHXDp71"}
{"_id":"V9UVLa7U6eebHVlo","name":"35 - T09 - SuperHeat (xfire)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"xfire\",\r\n    filterId: \"mySuperHeat\",\r\n    time: 0,\r\n    blend: 5,\r\n    amplitude: 0.25,\r\n    dispersion: -1,\r\n    chromatic: false,\r\n    scaleX: 1,\r\n    scaleY: 1,\r\n    inlay: true,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: -0.0090, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.2l4UxekocRzIzaPE"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"_id":"VdpwjS6wJj1myDUB","name":"19 - T02 - Devouring Fire","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"fire\",\r\n    filterId: \"myFire\",\r\n    intensity: 3,\r\n    color: 0xFFFFFF,\r\n    amplitude: 2,\r\n    time: 0,\r\n    blend: 10,\r\n    fireBlend : 1,\r\n    alphaDiscard: true,\r\n    zOrder: 50,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: -0.0024, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n},{\r\n    filterType: \"glow\",\r\n    filterId: \"glowripples\",\r\n    outerStrength: 4,\r\n    innerStrength: 2,\r\n    color: 0xAA6500,\r\n    quality: 0.5,\r\n    padding: 10,\r\n    zOrder: 100,\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.world.token-magic-dev.Gec6BaJMehMO7p7v"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"name":"13 - Shockwave (wave)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// Below, you can turn on the anchor animation.\r\nlet params =\r\n[{\r\n    filterType: \"wave\",\r\n    filterId: \"myShockwave\",\r\n    time: 0,\r\n    strength: 0.03,\r\n    frequency: 15,\r\n    maxIntensity: 4.0,\r\n    minIntensity: 0.5,\r\n    padding:25,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0180,\r\n        animType: \"move\",\r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.r3JzTibAUnlpgPsD"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"VgpuDWlOzMpec9px"}
{"name":"Group Saving Throw","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/sundries/gaming/dice-runed-brown.webp","scope":"global","command":"game.PF2EToolbox.groupSave();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Macro.8Q09qdNv8Ry5v3pF"},"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_w4f9l9idxk","path":"GM Macros","color":"#940000"}},"_id":"VyyAfrDJICoLfhdy"}
{"name":"Athletics with MAP","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"for (let token of canvas.tokens.ownedTokens) {\n    const actor = token.actor\n    \n    if(actor.hasPlayerOwner) {\n        const options = actor.getRollOptions(['all', 'str-based', 'ath'])\n        console.log(options)\n        actor.data.data.skills.ath.variants[0].roll(event, options)\n    }\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_5lpecs4iq07","path":"Under Construction","color":"#e68600"}},"_id":"W4uMGViq31Hxvx0K"}
{"name":"24 - T12 - Warp Time Aura","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n[{\n    filterType: \"field\",\n    filterId: \"myWarpField\",\n    shieldType: 12,\n    gridPadding: 2,\n    color: 0xFFFFFF,\n    time: 0,\n    blend: 2,\n    intensity: 1.5,\n    lightAlpha: 0.8,\n    lightSize: 0.5,\n    scale: 0.7,\n    radius: 1,\n    chromatic: false,\n    animated :\n    {\n      time : \n      { \n        active: true, \n        speed: 0.0009, \n        animType: \"move\" \n      }\n    }\n}];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.2IOkNL2J1jETUvSP"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"W9ZaFTh1vpxO8zkf"}
{"name":"Spell Effect: Hymn of Healing","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/heal.svg","scope":"global","command":"async function main() {\n\tconst target = canvas.tokens.placeables.find(target => target.id === args[0]);\n\tconst source = args[1];\n\tconst healAmount = args[2];\n\tconst duration = args[3] - 1;\n\tconst task = args[4];\n\n\tlet combatant_target = game.combat.data.combatants.find(it => it.tokenId == target.id);\n\tif (combatant_target === undefined) {\n\t\tui.notifications.warn(`${target.data.name} is not in combat! They must be in combat for this macro to work.`);\n\t\treturn;\n\t}\n\n\t// Check if actor has acted yet or not this round and set Alert to this round if they haven't\n\tconst currentTurn = game.combat.turn;\n\tconst combatantTurn = game.combat.turns.findIndex(it => it.actor.id == target.actor.id);\n\tlet nextRound = (combatantTurn > currentTurn) ? 0 : 1;\n\n\tconst fastHealing_Alert = {\n\t\tname: `Spell Effect: Hymn of Healing - Fast Healing ${healAmount}`,\n\t\tlabel: `Spell Effect: Hymn of Healing - Fast Healing ${healAmount}`,\n\t\tturnId: combatant_target._id,\n\t\tround: nextRound,\n\t\tmessage: `Fast Healing ${healAmount} applied to ${target.data.name} from Hymn of Healing.`,\n\t\tmacro: \"Spell Effect: Hymn of Healing\",\n\t\targs: [target.id, source, healAmount, duration, 'applyFastHealing']\n\t}\n\n\tconst sustainSpell_Alert = {\n\t\tname: \"Spell Effect: Hymn of Healing - Sustain Spell)\",\n\t\tlabel: \"Spell Effect: Hymn of Healing - Sustain Spell)\",\n\t\tturnId: source,\n\t\tendOfTurn: false,\n\t\tround: 1,\n\t\tmessage: `Temporary Hit Points removed from ${target.data.name} from Hymn of Healing. Sustaining the spell will reapply the effect.`,\n\t\tmacro: \"Spell Effect: Hymn of Healing\",\n\t\targs: [target.id, source, healAmount, duration, 'sustainSpell'],\n\t\tuserId: game.userId,\n\t}\n\n\tswitch (task) {\n\t\tcase 'applyFastHealing':\n\t\t\tlet actorHP = target.actor.data.data.attributes.hp;\n\t\t\tawait target.actor.update({ 'data.attributes.hp.value': actorHP.value + healAmount })\n\t\t\tbreak;\n\t\tcase 'addTempHP':\n\t\t\tlet effectItem = game.items.getName(\"Spell Effect: Hymn of Healing\").data;\n\t\t\t// console.log(\"*********** EFFECT ITEM:\", effectItem);\n\t\t\ttarget.actor.createOwnedItem(effectItem);\n\t\t\tbreak;\n\t\tcase 'sustainSpell':\n\t\t\tNerps.removeEffect(target.actor.id, \"Spell Effect: Hymn of Healing\");\n\n\t\t\tif (duration > 0) {\n\t\t\t\tlet d = Dialog.confirm({\n\t\t\t\t\ttitle: \"Sustain Spell Action Required\",\n\t\t\t\t\tcontent: `<p>Do you wish to sustain Hymn of Healing?</p>${duration} rounds of duration left.`,\n\t\t\t\t\tyes: () => {\n\t\t\t\t\t\tui.notifications.info(\"Hymn of Healing sustained.\");\n\n\t\t\t\t\t\tTurnAlert.create(sustainSpell_Alert);\n\t\t\t\t\t\tTurnAlert.create(fastHealing_Alert);\n\t\t\t\t\t\tNerps.addEffect(target.actor.id, \"Spell Effect: Hymn of Healing\");\n\t\t\t\t\t},\n\t\t\t\t\tno: () => {\n\t\t\t\t\t\tui.notifications.warn(\"Hymn of Healing will expire at end of your turn.\");\n\t\t\t\t\t\t// console.log(\"Hymn of Healing will expire at end of your turn.\")\n\t\t\t\t\t},\n\t\t\t\t\tdefaultYes: true\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tui.notifications.error(\"Hymn of Healing duration has ended and can no longer be sustained.\");\n\t\t\t}\n\t\t\tbreak;;\n\t\tdefault:\n\t\t\tconsole.log(`Unknown task sent to Spell Effect: Hymn of Healing macro.`);\n\t}\n}\n\nmain();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"cf":{"id":"temp_9jlc9ozs6qm","path":"Effect Toggles","color":"#9900d1"}},"_id":"Weo89jdN2edPoIyG"}
{"name":"25 - T01 - Sunburst Rays (xray)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"xray\",\r\n    filterId: \"mySunburstRays\",\r\n    time: 0,\r\n    color: 0xFFBB00,\r\n    blend: 9,\r\n    dimX: 1,\r\n    dimY: 1,\r\n    anchorX: 0,\r\n    anchorY: 0,\r\n    divisor: 36,\r\n    intensity: 4,\r\n    animated :\r\n    {\r\n       time : \r\n       { \r\n          active: true, \r\n          speed: 0.0012, \r\n          animType: \"move\" \r\n       },\r\n       anchorX:\r\n       {\r\n          animType: \"syncCosOscillation\",\r\n          loopDuration : 6000,\r\n          val1: 0.40,\r\n          val2: 0.60\r\n       }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.IEl6F5dtFcYBZDDZ"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"XvzNDCAl36Oo9Rz7"}
{"name":"Import Compendium Mapping","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// https://gitlab.com/-/snippets/2138719\n\nconst folderName = encodeURL(`${game.system.id}CompendiumMappingBackup`);\n\nasync function getJSON(path){\n  const response = await fetch(path);\n  const json = await response.json();\n  return json;\n}\n\nui.notifications.info(\"Starting import, this may take a few moments.\")\n\nasync function importMapping(gamePack){\n    let filepath = `${folderName}/${gamePack}.json`;\n    let actors = await getJSON(filepath);\n    const updates = actors.map(a => ({_id: a.id, img: a.img, token: { img: a.data.token.img, randomImg: a.data.token.randomImg, scale: a.data.token.scale }}));\n    try {\n        const pack = game.packs.get(gamePack);\n        pack.configure({locked: false})\n        const docs = await pack.getDocuments();\n        const updated = await Actor.updateDocuments(updates, {pack: gamePack});\n        pack.configure({locked: true});\n        ui.notifications.info(`${gamePack} imported`)\n        } catch (error) {\n        console.error(`Could not load data for ${gamePack}.  That pack may not exist in this world or it may be damaged.`)\n    }\n}\n\nconst folderList = await FilePicker.browse('data',folderName);\nconst files = folderList.files.filter(f => f.endsWith('.json'));\nfor (let file of files) {\n    let gamePack = file.split('/').slice(-1)[0].replace('.json','')\n    await importMapping(gamePack);\n}\nui.notifications.info(\"done\")","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_jgmri56d4gm","path":"System Macros","color":"#02ac24"}},"_id":"Xx9TKoCq7Xtd6msQ"}
{"name":"28 - Glory to Pixels","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params = \r\n[{\r\n    filterType: \"pixel\",\r\n    filterId: \"pixelate\",\r\n    sizeX: 2.5,\r\n    sizeY: 2.5\r\n}]\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.8KIRbHAgs6SCs8mT"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"YO5TJ4BcZkjObKPe"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_rws38wegmqi","path":"PC Macros#/CF_SEP/Mogo","color":"#28cc9a","name":"Mogo","children":["5hhmXyhJR3XYG9KH"],"folderPath":["temp_qx20rfr41e"]}},"_id":"YrtX7wSiV1BdIg4q"}
{"name":"Magic Missle!","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"new Sequence()\n    .effect()\n        .atLocation(canvas.tokens.controlled[0])\n        .reachTowards(canvas.tokens.controlled[1])\n        .baseFolder(\"Images/Effects/Magic_Missile\")\n        .startPoint(200)\n        .endPoint(200)\n        .setMustache({\n            \"color\": () => {\n                return ['Blue', 'Green', 'Purple', 'Yellow'][Math.floor(Math.random() * 4)]\n            },\n            \"number\": () => {\n                return Math.floor(Math.random() * 9) + 1;\n            }\n        })\n        .addOverride(\n            async (effect, data) => {\n                if(data.distance <= 1800){\n                    data.file = \"MagicMissile_01_Regular_{{color}}_30ft_0{{number}}_1600x400.webm\";\n                }else{\n                    data.file = \"MagicMissile_01_Regular_{{color}}_60ft_0{{number}}_2800x400.webm\";\n                }\n                return data\n            }\n        )\n        .repeats(3, 200, 300)\n    .play();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_5lpecs4iq07","path":"Under Construction","color":"#e68600"}},"_id":"Z7T4cNuTZb9sQ3vs"}
{"name":"33 - T04 - Some Real Nuts Here! (transform)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n    [{\r\n        filterType: \"transform\",\r\n        filterId: \"myTransform\",\r\n        padding: 200,\r\n        animated:\r\n        {\r\n            rotation:\r\n            {\r\n                clockWise: true,\r\n                loopDuration: 700,\r\n                animType: \"syncRotation\"\r\n            },\r\n            translationX:\r\n            {\r\n                animType: \"sinOscillation\",\r\n                val1: -0.25,\r\n                val2: +0.25\r\n            },\r\n            translationY:\r\n            {\r\n                animType: \"sinOscillation\",\r\n                val1: -0.125,\r\n                val2: +0.125,\r\n                loopDuration: 1500\r\n            },\r\n            scaleX:\r\n            {\r\n                animType: \"sinOscillation\",\r\n                val1: 0.5,\r\n                val2: 2.6,\r\n                loopDuration: 1200\r\n            },\r\n            scaleY:\r\n            {\r\n                animType: \"sinOscillation\",\r\n                val1: 0.5,\r\n                val2: 2.6,\r\n                loopDuration: 1200\r\n            }\r\n        }\r\n    }];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.PHe9kakKlPKpARvm"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"aBHq9quRrCfe2Ogz"}
{"name":"34 - T01 - Wound/Splash - Repeatable (splash)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n    [{\r\n        filterType: \"splash\",\r\n        filterId: \"mySplash\",\r\n        rank:5,\r\n        color: 0x990505,\r\n        padding: 80,\r\n        time: Math.random()*1000,\r\n        seed: Math.random(),\r\n        splashFactor: 1,\r\n        spread: 0.4,\r\n        blend: 1,\r\n        dimX: 1,\r\n        dimY: 1,\r\n        cut: false,\r\n        textureAlphaBlend: true,\r\n        anchorX: 0.32+(Math.random()*0.36),\r\n        anchorY: 0.32+(Math.random()*0.36)\r\n    }];\r\n\r\nTokenMagic.addFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.XzB3cj1TLsx7qABY"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"aegNvJcgWeHZgbUD"}
{"name":"04 - Outline","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params = \r\n[{\r\n   filterType: \"outline\",\r\n   filterId: \"myOutline\",\r\n   padding: 10,\r\n   color: 0xEE6035,\r\n   thickness: 1,\r\n   quality: 5,\r\n   zOrder: 9,\r\n   animated :\r\n   {\r\n      thickness: \r\n      { \r\n         active: true,\r\n         loopDuration: 800,\r\n         animType: \"syncCosOscillation\",\r\n         val1: 1, \r\n         val2: 6\r\n      }\r\n   }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.b5Enw7tEwfjDNHuY"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"bPBWD7LKNskARCKN"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_31sdln39pmy","path":"PC Macros#/CF_SEP/Mike","color":"#7d4695","name":"Mike","children":["q2AHwt9TcovzrcNo"],"folderPath":["temp_qx20rfr41e"]}},"_id":"bo4y3S4n2CO24z6c"}
{"name":"35 - T06 - Custom Color Fire (xfire)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// example with color fine tuning\r\nlet params =\r\n[{\r\n    filterType: \"xfire\",\r\n    filterId: \"myCustomXFire\",\r\n    time: 0,\r\n    color1: 0x00DD20,\r\n    color2: 0x009090,\r\n    color3: 0x001020,\r\n    color4: 0x00CCFF,\r\n    blend: 1,\r\n    amplitude: 1,\r\n    dispersion: 0,\r\n    chromatic: false,\r\n    scaleX: 1,\r\n    scaleY: 1,\r\n    inlay: false,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: -0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.llpMoa9rOjeCzWf3"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"bp336e08ZCg6GwOb"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8","name":"PC Macros","children":["MPaigFlPG3ZCQ9dD","v5M5v55uHkYOEY1b","bvXGXy2TrX3HUNn7","13gJfJi8fvxRvbsF","bRsZex4jZ19wTSgI","f3WyHsh8Z36nyIUq","UpgJAXrxxI0jxmVW","iBFHsbO9koZQWVLJ","6AIWFBOQYpdrLqYR","6vaZrU3P6os1DLRJ","ouoOWgFlfpWmpkOl","qykkGzV7QblzzXMd","BUxWPwg26q6wYyzi","HKZQiR2OD7WzT5Yi","rKUvXQS5vwnu9xmB","1SomXYAqD9pzLxRq","DVnriSL2cKJE7RHL","gFItut9fVBKyEViA","5f4TMts2kOCUYVvc","sVApVkMNawNHnNLn","jHk5QZkxCETE3Df8","oR2g0MCrsSFAkAwu","EvlDtaijQiSh1DV2","MclrLi2xwBkCaEGY","TBKnyIMAjLq0cqBF","ra1iiXLfOTbNTCWv","r31yfxIHru2Px8vF"],"folderPath":[]}},"_id":"cSIwkCxnVUska1H1"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_uqqajwofsun","path":"Macros","color":"#000000","name":"Macros","children":["PvnIzkCDGxf77jjS","80MTSdYXp9gNyh8R"],"folderPath":[]}},"_id":"cmAs840UudlI251K"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_0bvuexgyxprc","path":"PC Macros#/CF_SEP/Jamz","color":"#940505","name":"Jamz","children":["kIwBB7t6irMm3LfJ","QxSRXHyo7aPK6JcX","N1Sd4llvG5nY1KDZ","8WhFAW3e7fKeNztX","8WhFAW3e7fKeNztX","o8yKdpCjzC1Lvxzt"],"folderPath":["temp_qx20rfr41e"]}},"_id":"dDtq9XZFYhSIhUMJ"}
{"name":"35 - T07 - SuperFrost (xfire)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"xfire\",\r\n    filterId: \"mySuperFrost\",\r\n    color: 0xACC5C5,\r\n    time: 0,\r\n    blend: 5,\r\n    amplitude: 1,\r\n    dispersion: 0,\r\n    chromatic: false,\r\n    scaleX: 1,\r\n    scaleY: 1,\r\n    inlay: true,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: -0.0020, \r\n        animType: \"move\" \r\n      }  \r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.TUyzBYb350Gcn5rE"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"dxi9mnBuxwbXervr"}
{"name":"Add Breath Weapon Delay","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/magic/fire/blast-jet-stream-embers-orange.webp","scope":"global","command":"/*************\n *  Globals  *\n**************/\nconst effect = await game.items.find(a => a.id == \"soTXke2nVQHnEtBk\").toObject(); // Shared Compendium Effect\nconst numberOfRounds = Math.floor(Math.random() * 4) + 1;\neffect.data.duration.value = numberOfRounds;\n\n/************* \n * Functions *\n**************/\nasync function main() {\n\tif (!token?.actor && canvas.tokens.controlled.length != 1) {\n\t\tui.notifications.warn(\"You must have a single actor selected.\");\n\t}\n\n\tlet task = args[0];\n\n\tswitch (task) {\n\t\tcase 'addEffect':\n\t\t\taddEffect(token.actor);\n\t\t\tbreak;\n\t\tcase 'removeEffect':\n\t\t\tremoveEffect(token.actor);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\ttoggleEffect(token.actor);\n\t}\n}\n\nfunction toggleEffect(tActor) {\n\tlet effectItems = tActor.items.filter(item => item.type === 'effect' && item.name.includes(effect.name));\n\n\tif (effectItems.length > 0) {\n\t\tremoveEffect(tActor);\n\t} else {\n\t\taddEffect(tActor);\n\t}\n}\n\nasync function removeEffect(tActor) {\n\tui.notifications.info(`${tActor.name}'s ${effect.name} expired.`);\n\n\tlet effectItems = tActor.items.filter(item => item.type === 'effect' && item.name.includes(effect.name));\n\tfor (let effectItem of effectItems) {\n\t\tawait tActor.deleteOwnedItem(effectItem._id);\n\t}\n}\n\nasync function addEffect(tActor) {\n\tui.notifications.info(`${tActor.name} now has ${effect.name} for ${numberOfRounds} ${effect.data.duration.unit}.`);\n\tawait tActor.createEmbeddedDocuments(\"Item\", [effect]);\n\taddTurnAlert(tActor);\n}\n\nfunction addTurnAlert(tActor) {\n\tif (!game.modules.get(\"turnAlert\")?.active || game.combat === null) {\n\t\treturn;\n\t}\n\n\t// Get the combat tracker id for the targeted token...\n\tlet combatant_target = game.combat.combatants.find(it => it.tActor.id == tActor.id);\n\n\tif (combatant_target === undefined) {\n\t\tui.notifications.warn(`${tActor.data.name} is not in combat! They must be in combat for this macro to work.`);\n\t\treturn;\n\t}\n\n\t// Check if actor has acted yet or not this round and set Alert to this round if they haven't\n\tconst currentTurn = game.combat.turn;\n\tconst combatantTurn = game.combat.turns.findIndex(it => it.tActor.id == tActor.id);\n\tlet nextRound = (combatantTurn > currentTurn) ? 0 : 1;\n\tnextRound += numberOfRounds\n\n\tconst removeEffect_Alert = {\n\t\tname: `${effect.name} expires`,\n\t\tlabel: `${effect.name} expires`,\n\t\tturnId: combatant_target._id,\n\t\tround: nextRound,\n\t\t// endOfTurn: true,\n\t\tmacro: \"Add Breath Weapon Delay\",\n\t\targs: ['removeEffect']\n\t}\n\n\tTurnAlert.create(removeEffect_Alert);\n}\n\nmain();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"macro-marker":{"activeData":{"icon":"icons/svg/mage-shield.svg","tooltip":"Cast Shield   ","colour":"#ff0000","trigger":""}},"furnace":{"runAsGM":false},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_w4f9l9idxk","path":"GM Macros","color":"#940000"}},"_id":"eGmEXGO1nnMjjXMU"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_uc5t42j0ab","path":"PC Macros#/CF_SEP/Gamemaster","color":"#800000","name":"Gamemaster","children":[],"folderPath":["temp_qx20rfr41e"]}},"_id":"fL2BK6oV0HafUn5c"}
{"name":"26 - T03 - Drift in Plans (liquid+waves)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"wave\",\r\n    filterId: \"myDriftWaves\",\r\n    time: 0,\r\n    anchorX: 0.5,\r\n    anchorY: 0.5,\r\n    strength: 0.035,\r\n    frequency: 20,\r\n    color: 0xFFFFFF,\r\n    maxIntensity: 1.5,\r\n    minIntensity: 0.5,\r\n    padding:10,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0085, \r\n        animType: \"move\" \r\n      },\r\n      anchorX :\r\n      {\r\n        active: true,\r\n        val1: 0.35,\r\n        val2: 0.65,\r\n        animType: \"syncCosOscillation\",\r\n        loopDuration: 10000\r\n      },\r\n      anchorY :\r\n      {\r\n        active: true,\r\n        val1: 0.35,\r\n        val2: 0.65,\r\n        animType: \"syncSinOscillation\",\r\n        loopDuration: 10000\r\n      }\r\n    }\r\n},\r\n{\r\n    filterType: \"liquid\",\r\n    filterId: \"myDriftLiquid\",\r\n    color: 0xFF0000,\r\n    time: 0,\r\n    blend: 6,\r\n    intensity: 5,\r\n    spectral: false,\r\n    scale: 2.5,\r\n    animated :\r\n    {\r\n       time : \r\n       { \r\n          active: true, \r\n          speed: 0.0018, \r\n          animType: \"move\" \r\n       },\r\n       color: \r\n       {\r\n          active: true, \r\n          loopDuration: 9000, \r\n          animType: \"colorOscillation\", \r\n          val1:0xFF0000, \r\n          val2:0xFFFFFF\r\n       }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.T953GJB235BbrCll"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"fO8VtcvAVteNDYGn"}
{"name":"12 - Zoom Blur","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"zoomblur\",\r\n    filterId: \"myZoomBlur\",\r\n    strength: 0.15,\r\n    innerRadiusPercent: 65,\r\n    radiusPercent: 100,\r\n    padding: 30,\r\n    animated:\r\n    {\r\n        innerRadiusPercent: \r\n        { \r\n           active: true, \r\n           animType: \"sinOscillation\", \r\n           loopDuration: 500, \r\n           val1: 65, \r\n           val2: 75\r\n        }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.t2MjFs4cVUCYsbMr"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"feI06orwdN78K78g"}
{"name":"E - Click, click, click and click !","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let glowFunc = async function() {\r\n\r\n   const myTokens = canvas.tokens.placeables;\r\n\r\n   for (const myToken of myTokens ){\r\n       if (myToken.TMFXhasFilterId(\"funnyAlternateGlow\")) {\r\n           await myToken.TMFXdeleteFilters(\"funnyAlternateGlow\");\r\n       } else {\r\n           let params =\r\n           [{\r\n               filterType: \"glow\",\r\n               filterId: \"funnyAlternateGlow\",\r\n               color: Math.floor(Math.random() * 16777215),\r\n               animated: null\r\n           }];\r\n           await myToken.TMFXaddUpdateFilters(params);\r\n       }\r\n   }\r\n};\r\n\r\nglowFunc();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.BGz9j7xPy0H2QlBf"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"fiV8yawLWqpAOcvY"}
{"name":"03 - Drop Shadow","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"shadow\",\r\n    filterId: \"myShadow\",\r\n    rotation: 35,\r\n    blur: 2,\r\n    quality: 5,\r\n    distance: 20,\r\n    alpha: 0.7,\r\n    padding: 10,\r\n    shadowOnly: false,\r\n    color: 0x000000,\r\n    zOrder: 6000,\r\n    animated:\r\n    {\r\n        blur:     \r\n        { \r\n           active: true, \r\n           loopDuration: 500, \r\n           animType: \"syncCosOscillation\", \r\n           val1: 2, \r\n           val2: 4\r\n        },\r\n        rotation:\r\n        {\r\n           active: true,\r\n           loopDuration: 100,\r\n           animType: \"syncSinOscillation\",\r\n           val1: 33,\r\n           val2: 37\r\n        }\r\n     }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.hayiRem3LXoEP3tL"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"fpkHQE4f6qhc5ZQN"}
{"name":"25 - T02 - Lucky Clover (xray)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"xray\",\r\n    filterId: \"myLuckyRays\",\r\n    time: 0,\r\n    color: 0x00FF00,\r\n    blend: 9,\r\n    dimX: 0.05,\r\n    dimY: 0.05,\r\n    anchorX: 0.5,\r\n    anchorY: 0.5,\r\n    divisor: 4,\r\n    intensity: 1,\r\n    animated :\r\n    {\r\n       time : \r\n       { \r\n          active: true, \r\n          speed: 0.0012, \r\n          animType: \"move\" \r\n       },\r\n       anchorX:\r\n       {\r\n          animType: \"syncCosOscillation\",\r\n          loopDuration : 6000,\r\n          val1: 0.40,\r\n          val2: 0.60\r\n       },\r\n       anchorY:\r\n       {\r\n          animType: \"syncSinOscillation\",\r\n          loopDuration : 6000,\r\n          val1: 0.40,\r\n          val2: 0.60\r\n       }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.YPOoPH63FqcEoVTk"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"g4x0Upd8Fr3TSMMY"}
{"name":"Roll Secret Perception","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/eye.svg","scope":"global","command":"// Makes an always-secret roll with a skill using the selected token, or the configured character if none are selected\n// Make a roll with a dialog to choose the skill\n// game.PF2EToolbox.secretSkillRoll()\n\n// Roll acrobatics\n// game.PF2EToolbox.secretSkillRoll('acr')\n\n// Roll perception\ngame.PF2EToolbox.secretSkillRoll('perception')\n\n// Show available skills for the selected token\n// game.PF2EToolbox.secretSkillRoll('give me the skills!')","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"gFItut9fVBKyEViA"}
{"name":"02 - Adjustment","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"adjustment\",\r\n    filterId: \"myAdjust\",\r\n    saturation: 1,\r\n    brightness: 1,\r\n    contrast: 1,\r\n    gamma: 1,\r\n    red: 0.2,\r\n    green: 0.2,\r\n    blue: 0.2,\r\n    alpha: 1,\r\n    animated:\r\n    {\r\n        alpha: \r\n        { \r\n           active: true, \r\n           loopDuration: 2000, \r\n           animType: \"syncCosOscillation\",\r\n           val1: 0.35,\r\n           val2: 0.75 }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.VWTz2fKfSb6WK7Mo"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"gFpDka2936TpA34H"}
{"name":"23 - T03 - Spectral Images","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// Another extreme example...\r\nlet params =\r\n[{\r\n    filterType: \"images\",\r\n    filterId: \"mySpectralImages\",\r\n    time: 0, \r\n    blend: 4,\r\n    nbImage: 4, \r\n    padding: 0,\r\n    alphaImg: 0.5, \r\n    alphaChr: 0.0,\r\n    ampX: 0.10, \r\n    ampY: 0.10,\r\n    zOrder: 20,\r\n    animated :\r\n    {\r\n      time: \r\n      { \r\n        speed: 0.0010, \r\n        animType: \"move\" \r\n      },\r\n      ampX:\r\n      {\r\n        val1: 0, val2: 0.22,\r\n        animType: \"syncCosOscillation\",\r\n        loopDuration: 2500\r\n      },\r\n      ampY:\r\n      {\r\n        val1: 0, val2: 0.28,\r\n        animType: \"syncCosOscillation\",\r\n        loopDuration: 2500,\r\n      },\r\n      alphaChr:        \r\n      {\r\n        val1: 1, val2: 0,\r\n        animType: \"syncCosOscillation\",\r\n        loopDuration: 2500\r\n      },\r\n      alphaImg:        \r\n      {\r\n        val1: 0.2, val2: 0.8,\r\n        animType: \"syncSinOscillation\",\r\n        loopDuration: 2500\r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.UEsyHtvWqlOGbUAG"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"gUa56yDrwxGBt3Gj"}
{"name":"25 - T03 - X-ray Scan (xray)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"xray\",\r\n    filterId: \"myXrayScan\",\r\n    time: 0,\r\n    color: 0xFFFFFF,\r\n    blend: 5,\r\n    dimX: 20,\r\n    dimY: 20,\r\n    anchorX: 0.5,\r\n    anchorY: 0,\r\n    divisor: 8,\r\n    intensity: 1,\r\n    animated :\r\n    {\r\n       time : \r\n       { \r\n          active: true, \r\n          speed: 0.00038, \r\n          animType: \"move\" \r\n       }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.hFZvMSE5VMCUiYNE"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"hE14LWSDfKOTsYgq"}
{"name":"Delete all Macros","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/combat.svg","scope":"global","command":"// game.macros.foreach(async (m) => await m.delete(););","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_jgmri56d4gm","path":"System Macros","color":"#02ac24"}},"_id":"hKLLZFWeOt7kAAWC"}
{"name":"Toggle Blind Vision","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/conditions/blinded.webp","scope":"global","command":"let currentVisionLimit = token.getFlag('perfect-vision', 'sightLimit');\n\n// console.log(\"currentVisionLimit\", currentVisionLimit)\n\nif(currentVisionLimit == undefined) {\n    token.setFlag('perfect-vision', 'sightLimit', 0);\n} else {\n    token.setFlag('perfect-vision', 'sightLimit', null);\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_w4f9l9idxk","path":"GM Macros","color":"#940000"}},"_id":"hbPsegayRtkYK36Z"}
{"name":"34 - T02 - Dead (splash)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n    [{\r\n        filterType: \"splash\",\r\n        filterId: \"mySplash\",\r\n        color: 0x900505,\r\n        padding: 30,\r\n        time: Math.random()*1000,\r\n        seed: Math.random()/100,\r\n        splashFactor: 2,\r\n        spread: 7,\r\n        blend: 1,\r\n        dimX: 1,\r\n        dimY: 1,\r\n        cut: true,\r\n        textureAlphaBlend: false\r\n    }];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.WyiMXpscxVhgE1zy"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"hdqGThYFh548agm5"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_5lpecs4iq07","path":"Under Construction","color":"#e68600","name":"Under Construction","children":["W4uMGViq31Hxvx0K","UujvOC9OdMnvAxYJ","Z7T4cNuTZb9sQ3vs","BohKDZOQiEb42I9Q","yQjEBK2I3dFLwpfL","7STMzn2JQtwr0y3x","LweZz1FNKKyjuM72"],"folderPath":[]}},"_id":"hfU9zOomRJvEDOh1"}
{"_id":"i6Z7nYDNe7o1undQ","name":"24 - T02 - Fire Shield","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myFireField\",\r\n    shieldType: 1,\r\n    gridPadding: 2,\r\n    color: 0xE58550,\r\n    time: 0,\r\n    blend: 2,\r\n    intensity: 1.2,\r\n    lightAlpha: 1,\r\n    lightSize: 0.7,\r\n    scale: 1,\r\n    radius: 1,\r\n    chromatic: false,\r\n    zOrder: 512,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.world.token-magic-dev.IA3ofbRDpi3Rjgcy"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"name":"Flat Check","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/vtt-512.png","scope":"global","command":"/r 1d20#Rolling a Flat Check...","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"iBFHsbO9koZQWVLJ"}
{"name":"Secret Skill Roll","type":"script","author":"oiPWLVPNH7xQBULr","img":"modules/game-icons-net/whitetransparent/blindfold.svg","scope":"global","command":"// Makes an always-secret roll with a skill using the selected token, or the configured character if none are selected\n// Make a roll with a dialog to choose the skill\ngame.PF2EToolbox.secretSkillRoll()\n\n// Roll acrobatics\n// game.PF2EToolbox.secretSkillRoll('acr')\n\n// Roll perception\n// game.PF2EToolbox.secretSkillRoll('perception')\n\n// Show available skills for the selected token\n// game.PF2EToolbox.secretSkillRoll('give me the skills!')","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"jHk5QZkxCETE3Df8"}
{"name":"B - Multi-Filters Example","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"distortion\",\r\n    maskPath: \"modules/tokenmagic/fx/assets/waves-2.png\",\r\n    maskSpriteScaleX: 7,\r\n    maskSpriteScaleY: 7,\r\n    padding: 50,\r\n    animated:\r\n    {\r\n        maskSpriteX: { active: true, speed: 0.05, animType: \"move\" },\r\n        maskSpriteY: { active: true, speed: 0.07, animType: \"move\" }\r\n    }\r\n},\r\n{\r\n    filterType: \"ray\",\r\n    time: 0,\r\n    color: 0xEF9000,\r\n    alpha: 0.25,\r\n    divisor: 32,\r\n    anchorY: 1,\r\n    animated :\r\n    {\r\n       time : \r\n       { \r\n          active: true, \r\n          speed: 0.0005, \r\n          animType: \"move\" \r\n       }\r\n    }\r\n},\r\n{\r\n    filterType: \"glow\",\r\n    distance: 10,\r\n    outerStrength: 8,\r\n    innerStrength: 0,\r\n    color: 0xB03000,\r\n    quality: 0.5,\r\n    animated:\r\n    {\r\n        color: \r\n        {\r\n           active: true, \r\n           loopDuration: 3000, \r\n           animType: \"colorOscillation\", \r\n           val1:0xB03000, \r\n           val2:0xFFD010\r\n        }\r\n    }\r\n}\r\n];\r\n\r\nTokenMagic.addFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.eJnsq5g4Pldh8Z6Q"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"jNMcVcpOZiWTUBcq"}
{"name":"30 - T01 - Simple Web (web)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params = \r\n[{\r\n    filterType: \"web\",\r\n    filterId: \"simpleweb\",\r\n    time: 100,\r\n    div1: 20,\r\n    div2: 10,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0005, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}]\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.9gvCwVdvis3NABbI"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"jUffO5X9wbvhDfUR"}
{"name":"#[CF_tempEntity]","type":"chat","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_jgmri56d4gm","path":"System Macros","color":"#02ac24","name":"System Macros","children":["hKLLZFWeOt7kAAWC","xEWrtwcCZEJ5Y3UH","Xx9TKoCq7Xtd6msQ","QnUhmiJV0phH17gj"],"folderPath":[]}},"_id":"k7CQp18S8E1rH9gQ"}
{"_id":"kG5mkAltHF3sppFS","name":"19 - T01 - Fire","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"fire\",\r\n    filterId: \"myFire\",\r\n    intensity: 1,\r\n    color: 0xFFFFFF,\r\n    amplitude: 1,\r\n    time: 0,\r\n    blend: 2,\r\n    fireBlend : 1,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: -0.0024, \r\n        animType: \"move\" \r\n      },\r\n      intensity:\r\n      {\r\n        active:true,\r\n        loopDuration: 15000,\r\n        val1: 0.8,\r\n        val2: 2,\r\n        animType: \"syncCosOscillation\"\r\n      },\r\n      amplitude:\r\n      {\r\n        active:true,\r\n        loopDuration: 4400,\r\n        val1: 1,\r\n        val2: 1.4,\r\n        animType: \"syncCosOscillation\"\r\n      }\r\n      \r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.world.token-magic-dev.F47j6ivhmXxeYVmY"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"name":"F - 03 - Export FX Presets","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"TokenMagic.exportPresetLibrary();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.Ku4jBl972O7hHczs"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"kHVU5OpldrhCpyyG"}
{"name":"24 - T03 - Poisoned Smoke","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"mySmokeField\",\r\n    shieldType: 3,\r\n    gridPadding: 1,\r\n    color: 0x60CC70,\r\n    time: 0,\r\n    blend: 0,\r\n    intensity: 0.9,\r\n    lightAlpha: 1,\r\n    lightSize: 0.7,\r\n    scale: 1,\r\n    radius: 1,\r\n    chromatic: false,\r\n    zOrder: 512,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.SSY0fjib0PgJaKEK"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"kMYXmkqAdriqeUg0"}
{"name":"Set Token bars and nameplate","type":"script","author":"oiPWLVPNH7xQBULr","img":"modules/game-icons-net/whitetransparent/network-bars.svg","scope":"global","command":"/* This will set every token in scene to always display their\n * token bars and nameplate, and sets the first bar to represent \n * HP and removes the second token bar.\n*/\n\nconst tokens = canvas.tokens.placeables.map(token => {\n   return {\n       _id: token.id,\n       \"bar1.attribute\": \"attributes.hp\",\n       \"bar2.attribute\": \"\",\n       \"displayName\": CONST.TOKEN_DISPLAY_MODES.OWNER_HOVER,\n       \"displayBars\": CONST.TOKEN_DISPLAY_MODES.ALWAYS\n   };\n});\n\ncanvas.scene.updateEmbeddedEntity('Token', tokens)","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"cf":{"id":"temp_w4f9l9idxk","path":"GM Macros","color":"#940000"}},"_id":"kmfuSuMjG4kwyGln"}
{"name":"08 - Old film","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// special : the OldFilm filter need an Outline filter to be contained (or else, it will affect all the container)\r\nlet params =\r\n[{\r\n    filterType: \"oldfilm\",\r\n    filterId: \"myOldfilm\",\r\n    sepia: 0.6,\r\n    noise: 0.2,\r\n    noiseSize: 1.0,\r\n    scratch: 0.8,\r\n    scratchDensity: 0.5,\r\n    scratchWidth: 1.2,\r\n    vignetting: 0.9,\r\n    vignettingAlpha: 0.6,\r\n    vignettingBlur: 0.2,\r\n    animated:\r\n    {\r\n        seed:        \r\n        { \r\n           active: true, \r\n           animType: \"randomNumber\", \r\n           val1: 0, \r\n           val2: 1 \r\n        },\r\n        vignetting:  \r\n        { \r\n           active: true, \r\n           animType: \"syncCosOscillation\" , \r\n           loopDuration: 2000, \r\n           val1: 0.2, \r\n           val2: 0.4 }\r\n    }\r\n},\r\n{\r\n    filterType: \"outline\",\r\n    filterId: \"oldfilmOutline\",\r\n    color: 0x000000,\r\n    thickness: 0,\r\n    zOrder: 61\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.lH53KTce3zYEFXos"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"kq2n7K92DqoYcdaS"}
{"name":"31 - T01 - Glowing Globes (globes)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params = \r\n[{\r\n    filterType: \"globes\",\r\n    filterId: \"glowingGlobes\",\r\n    time: 0,\r\n    color: 0x5099DD,\r\n    distortion: 0.4,\r\n    scale: 80,\r\n    alphaDiscard: false,\r\n    zOrder: 1,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0005, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}]\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.BV1FdyFefneHRoEx"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"lvLe19YhQFkKyNks"}
{"name":"34 - T03 - Blood Bath (splash)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n    [{\r\n        filterType: \"splash\",\r\n        filterId: \"mySplash\",\r\n        color: 0xFF0505,\r\n        padding: 80,\r\n        time: 0,\r\n        seed: 0.10,\r\n        splashFactor: 2.25,\r\n        spread: 7,\r\n        blend: 7,\r\n        dimX: 1,\r\n        dimY: 1,\r\n        alphaBlending: false,\r\n        alphaDiscard: true,\r\n        cut: true,\r\n        animated :\r\n        {\r\n          time : \r\n          { \r\n            active: true, \r\n            speed: 0.0009, \r\n            animType: \"move\" \r\n          }\r\n        }\r\n    }];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.CRwxsDAsfCkXXTOa"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"mGg2PzndmwlaDXWI"}
{"name":"24 - T08 - Chromatic Bubble 2","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n[{\n    filterType: \"field\",\n    filterId: \"myChromaField\",\n    shieldType: 8,\n    gridPadding: 1,\n    color: 0xAAAAAA,\n    time: 0,\n    blend: 2,\n    intensity: 1,\n    lightAlpha: 0,\n    lightSize: 0,\n    scale: 1,\n    radius: 1,\n    chromatic: true,\n    discardThreshold: 0.3,\n    alphaDiscard: true,\n    animated :\n    {\n      time : \n      { \n        active: true, \n        speed: 0.0045, \n        animType: \"move\" \n      }\n    }\n}];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.EzV1RAvmD9azXoNe"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"myIbl9vEZIQkKPpq"}
{"name":"16 - Inner Fog","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"fog\",\r\n    filterId: \"myFog\",\r\n    color: 0x000000,\r\n    density: 0.65,\r\n    time: 0,\r\n    dimX: 1,\r\n    dimY: 1,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 2.2, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.Edw0KaZiBtWEG86g"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"nFJxhHE52yjdP8PL"}
{"name":"27 - T06 - Pure Ice (xglow+smoke)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n    [{\r\n        filterType: \"zapshadow\",\r\n        filterId: \"myPureIceZapShadow\",\r\n        alphaTolerance: 0.50\r\n    },\r\n    {\r\n        filterType: \"xglow\",\r\n        filterId: \"myPureIceAura\",\r\n        auraType: 1,\r\n        color: 0x5099DD,\r\n        thickness: 4.5,\r\n        scale: 10,\r\n        time: 0,\r\n        auraIntensity: 0.25,\r\n        subAuraIntensity: 1,\r\n        threshold: 0.5,\r\n        discard: false,\r\n        animated:\r\n        {\r\n            time:\r\n            {\r\n                active: true,\r\n                speed: 0.0018,\r\n                animType: \"move\"\r\n            },\r\n            thickness:\r\n            {\r\n                val1: 2, val2: 2.5,\r\n                animType: \"cosOscillation\",\r\n                loopDuration: 3000\r\n            },\r\n            subAuraIntensity:\r\n            {\r\n                val1: 0.45, val2: 0.65,\r\n                animType: \"cosOscillation\",\r\n                loopDuration: 6000\r\n            },\r\n            auraIntensity:\r\n            {\r\n                val1: 0.9, val2: 2.2,\r\n                animType: \"cosOscillation\",\r\n                loopDuration: 3000\r\n            }\r\n        }\r\n    },\r\n    {\r\n        filterType: \"smoke\",\r\n        filterId: \"myPureIceSmoke\",\r\n        color: 0x80CCFF,\r\n        time: 0,\r\n        blend: 2,\r\n        dimX: 0.3,\r\n        dimY: 1,\r\n        animated:\r\n        {\r\n            time:\r\n            {\r\n                active: true,\r\n                speed: -0.006,\r\n                animType: \"move\"\r\n            },\r\n            dimX:\r\n            {\r\n                val1: 0.4, val2: 0.2,\r\n                animType: \"cosOscillation\",\r\n                loopDuration: 3000\r\n            }\r\n        }\r\n    }];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.QkPSIfIOf72oD49L"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"nfUWl5GYaVpmTVds"}
{"name":"01 - Bevel","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params = \r\n[{\r\n    filterType: \"bevel\",\r\n    filterId: \"myBevel\",\r\n    rotation: 0,\r\n    thickness: 5,\r\n    lightColor: 0xFF0000,\r\n    lightAlpha: 0.8,\r\n    shadowColor: 0x00FF00,\r\n    shadowAlpha: 0.5,\r\n    animated :\r\n    {\r\n       rotation: \r\n       { \r\n          active: true,\r\n          clockWise: true, \r\n          loopDuration: 1600, \r\n          animType: \"syncRotation\"\r\n       }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.GvYp56Thtf3n9RYy"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"nohxTIwYZ2jXdRfp"}
{"name":"25 - T04 - Blue Rays ! (xray)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"xray\",\r\n    filterId: \"myBlueRay\",\r\n    time: 0,\r\n    color: 0x1030FF,\r\n    blend: 9,\r\n    dimX: 1,\r\n    dimY: 1,\r\n    anchorX: 0,\r\n    anchorY: 0,\r\n    divisor: 24,\r\n    intensity: 1,\r\n    animated :\r\n    {\r\n       time : \r\n       { \r\n          active: true, \r\n          speed: 0.0002, \r\n          animType: \"move\" \r\n       },\r\n       anchorX:\r\n       {\r\n          animType: \"syncCosOscillation\",\r\n          loopDuration : 18000,\r\n          val1: 0.05,\r\n          val2: 0.95\r\n       },\r\n       anchorY:\r\n       {\r\n          animType: \"syncSinOscillation\",\r\n          loopDuration : 18000,\r\n          val1: 0.05,\r\n          val2: 0.95\r\n       }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.SpHEaIwubKpbwzvV"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"oQ2H8D7Qc3jlQjaI"}
{"name":"Skill Actions","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/sundries/gaming/dice-pair-white-green.webp","scope":"global","command":"let journal = game.journal.getName(\"Skill Actions\");\n\nif (journal.sheet.rendered) \n\n  journal.sheet.close();\n\nelse\n\n  journal.sheet.render(true)","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"oR2g0MCrsSFAkAwu"}
{"name":"Open Compendium Browser","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/equipment/adventuring-gear/advanced-book-of-translation.webp","scope":"global","command":"game.pf2e.compendiumBrowser.render(true);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.pf2e.pf2e-macros.s2sa8lo9dcIA6UGe"},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"ouoOWgFlfpWmpkOl"}
{"name":"14 - Remove Shadow","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// this simple filter remove pixels with a certain amount of alpha\r\n// it can be useful to remove shadows before using glow or outline filters.\r\n\r\nlet params =\r\n[{\r\n    filterType: \"zapshadow\",\r\n    filterId: \"myZap\",\r\n    alphaTolerance: 0.45,\r\n    rank: 2\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.H3rF4XGEf76ZylwP"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"plrHQXc754hjdoZ8"}
{"name":"24 - T04 - Shell - Moving Ice Disc","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myIceField\",\r\n    shieldType: 14,\r\n    gridPadding: 1.25,\r\n    color: 0x409090,\r\n    time: 0,\r\n    blend: 9,\r\n    intensity: 1,\r\n    lightAlpha: 2,\r\n    lightSize: 1,\r\n    scale: 1,\r\n    radius: 0.97,\r\n    chromatic: false,\r\n    discardThreshold: 0.2,\r\n    alphaDiscard: true,\r\n    animated :\r\n    {\r\n      posLightX:\r\n      {\r\n        active: true,\r\n        val1: 0.25,\r\n        val2: 0.75,\r\n        animType: \"syncCosOscillation\",\r\n        loopDuration: 5000\r\n      },\r\n      posLightY:\r\n      {\r\n        active: true,\r\n        val1: 0.25,\r\n        val2: 0.75,\r\n        animType: \"syncSinOscillation\",\r\n        loopDuration: 5000\r\n      },\r\n      lightSize:\r\n      {\r\n        active: true,\r\n        val1: 0.95,\r\n        val2: 1.05,\r\n        animType: \"sinOscillation\",\r\n        loopDuration: 900\r\n      }\r\n    }\r\n},{\r\n        filterType: \"xglow\",\r\n        filterId: \"myIceField\",\r\n        auraType: 1,\r\n        color: 0x5099DD,\r\n        thickness: 4.5,\r\n        scale: 1,\r\n        time: 0,\r\n        auraIntensity: 0.25,\r\n        subAuraIntensity: 0.25,\r\n        threshold: 0.1,\r\n        discard: false,\r\n        zOrder: 3000,\r\n        animated:\r\n        {\r\n            time:\r\n            {\r\n                active: true,\r\n                speed: 0.0018,\r\n                animType: \"move\"\r\n            },\r\n            thickness:\r\n            {\r\n                val1: 2, val2: 2.5,\r\n                animType: \"cosOscillation\",\r\n                loopDuration: 3000\r\n            },\r\n            subAuraIntensity:\r\n            {\r\n                val1: 0.45, val2: 0.65,\r\n                animType: \"cosOscillation\",\r\n                loopDuration: 6000\r\n            },\r\n            auraIntensity:\r\n            {\r\n                val1: 0.9, val2: 2.2,\r\n                animType: \"cosOscillation\",\r\n                loopDuration: 3000\r\n            }\r\n        }\r\n    }];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.tZZaP7yvqdNnqF2L"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"pnQtITlqgPB8vdym"}
{"name":"Repair Sturdy Shield (Moderate)","type":"script","author":"oiPWLVPNH7xQBULr","img":"modules/Nerps-For-Foundry/images/rpg-icons/ResourcesAndCrafting/Tools/en_craft_31.webp","scope":"global","command":"if (!actor) {\n\tui.notifications.warn(\"You must have an actor selected\");\n} else {\n\tconst skillName = \"Craft\";\n\tconst skillKey = \"cra\";\n\tconst actionSlug = \"repair\"\n\tconst actionName = \"Repair\"\n\n\tconst modifiers = []\n\t// list custom modifiers for a single roll here\n\t//const modifiers = [\n\t//new game.pf2e.Modifier('Expanded Healer\\'s Tools', 1, 'item')\n\t//];\n\tconst level = token.actor.data.data.details.level.value;\n\n  \t// const DC = 14 + level + Math.floor(level / 3);\n//\tconst DC = 19; // Sturdy Shield (Lesser)\n  \tconst DC = 27; // Sturdy Shield (Moderate)\n\n    const skillRank = token.actor.data.data.skills[skillKey].rank\n\n    const repairSuccessTotal = 5 + (CheckFeat(\"crafters-eyepiece\") ? (skillRank * 10) : (skillRank * 5));\n    const hasCraftersEyepiece = CheckFeat(\"crafters-eyepiece\") ? `Crafter's Eyepiece: +${skillRank*5}` : \"\";\n\n\tconst notes = [...token.actor.data.data.skills[skillKey].notes]; // add more notes if necessary\n\tconst options = token.actor.getRollOptions(['all', 'skill-check', skillName.toLowerCase()]);\n\toptions.push(`action:${actionSlug}`); // add more traits here in new lines\n\tgame.pf2e.Check.roll(\n\t\tnew game.pf2e.CheckModifier(\n\t\t\t`<span class=\"pf2-icon\">A</span> <b>${actionName}</b> - <p class=\"compact-text\">${skillName} Skill Check</p><p class=\"compact-text\"><i>Repairs <b>${repairSuccessTotal} HP</b> on success, <b>${repairSuccessTotal*2} HP</b> on Critical Success, and deals 2d6 damage on Critical Fail.</i></p>${hasCraftersEyepiece}`,\n\t\t\ttoken.actor.data.data.skills[skillKey], modifiers),\n\t\t{ actor: token.actor, type: 'skill-check', options, notes, dc: { value: DC } },\n\t\tevent\n\t\t//, (Roll) => { console.log(Roll); } // for callback\n\t);\n}\n\nfunction CheckFeat(slug) {\n    if (token.actor.items.find(\n        (i) => i.data.data.slug === slug && i.type === 'equipment' && i.isInvested === true)) {\n        return true;\n    }\n    return false;\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"rKUvXQS5vwnu9xmB"}
{"name":"00 - B - Delete filters by Placeable","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// Delete all filters on the placeable in parameter (token or tile)\nTokenMagic.deleteFilters(_token);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.As1JrHLEm38Nm667"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"sEKUmlQpBQhxQrVA"}
{"name":"F - 06 - Export Template Settings","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"TokenMagic.exportTemplateSettings();","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.Ku4jBl972O7hHczs"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"sEnJhON9udocKff2"}
{"name":"07 - Distortion","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// you can change the mask of the filter\n// the mask must have a power of 2 h and w (512x512, 128x128, ...) \n// the distortion applies on black and white and shades of grey\n// after testing the first version of this macro try this :\n// -> maskPath: \"modules/tokenmagic/fx/assets/waves-2.png\"\n\nlet params =\n[{\n    filterType: \"distortion\",\n    filterId: \"myDistortion\",\n    maskPath: \"modules/tokenmagic/fx/assets/distortion-1.png\",\n    maskSpriteScaleX: 5,\n    maskSpriteScaleY: 5,\n    padding: 20,\n    animated:\n    {\n        maskSpriteX: { active: true, speed: 0.05, animType: \"move\" },\n        maskSpriteY: { active: true, speed: 0.07, animType: \"move\" }\n    }\n}];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.yHYwADWdYDAMTuCR"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"sNOh5pc586FG2uqX"}
{"_id":"tb5wNLch7TPi9A8w","name":"24 - T02 - Fire Shield 3 - Ring","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"zapshadow\",\r\n    filterId: \"myZap\",\r\n    alphaTolerance: 0.45\r\n},{\r\n    filterType: \"field\",\r\n    filterId: \"myFireField\",\r\n    shieldType: 1,\r\n    gridPadding: 1.1,\r\n    color: 0xE58550,\r\n    time: 0,\r\n    blend: 2,\r\n    intensity: 1.2,\r\n    lightAlpha: 1,\r\n    lightSize: 0.7,\r\n    scale: 1,\r\n    radius: 1,\r\n    chromatic: false,\r\n    discardThreshold: 0.9,\r\n    hideRadius: 0.95,\r\n    alphaDiscard: true,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n},{\r\n    filterType: \"xglow\",\r\n    filterId: \"myBurningAura\",\r\n    auraType: 2,\r\n    color: 0x903010,\r\n    thickness: 9.8,\r\n    scale: 4.,\r\n    time: 0,\r\n    auraIntensity: 2,\r\n    subAuraIntensity: 1.5,\r\n    threshold: 0.40,\r\n    discard: true,\r\n    zOrder: 3000,\r\n    animated:\r\n    {\r\n        time : \r\n        {  \r\n           active: true,\r\n           speed: 0.0027, \r\n           animType: \"move\" \r\n        },\r\n        thickness:\r\n        {\r\n           active: true,\r\n           loopDuration: 3000, \r\n           animType: \"cosOscillation\", \r\n           val1:2, \r\n           val2:5\r\n        }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.world.token-magic-dev.Uw5icMEGsNrCToeV"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
{"name":"Effect: Align Armament (Good)","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/spells/weapon-storm.webp","scope":"global","command":"const actors = canvas.tokens.controlled.flatMap((token) => token.actor ?? []);\nif (!actors.length && game.user.character) {\n    actors.push(game.user.character);\n}\nconst ITEM_UUID = 'Compendium.pf2e.feat-effects.bl4HXm1e4NQ0iJs5'; // Effect: Align Armament (Good)\nconst source = (await fromUuid(ITEM_UUID)).toObject();\nsource.flags.core ??= {};\nsource.flags.core.sourceId = ITEM_UUID;\nfor await (const actor of actors) {\n    const existing = actor.itemTypes.effect.find((effect) => effect.getFlag('core', 'sourceId') === ITEM_UUID);\n    if (existing) {\n        await existing.delete();\n    } else {\n        await actor.createEmbeddedDocuments('Item', [source]);\n    }\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_qs7elflrmm","path":"PC Macros#/CF_SEP/Marc","color":"#3328cc"}},"_id":"te1QxgMnlrHvEEdo"}
{"name":"24 - T11 - Grid Force Field","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myGridField\",\r\n    shieldType: 11,\r\n    gridPadding: 2,\r\n    color: 0x00CCCC,\r\n    time: 0,\r\n    blend: 2,\r\n    intensity: 1,\r\n    lightAlpha: 1,\r\n    lightSize: 0.3,\r\n    scale: 0.5,\r\n    radius: 1,\r\n    chromatic: false,\r\n    zOrder: 512,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0009, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.VuMHH9LMD51MNJzZ"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"uC6noHi16ux0UWxl"}
{"name":"10 - T02 - Pinch (transform)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n    [{\r\n        filterType: \"transform\",\r\n        filterId: \"myPinchTransform\",\r\n        bpRadiusPercent: 70,\r\n        padding: 100,\r\n        animated:\r\n        {\r\n            bpStrength:\r\n            {\r\n                animType: \"cosOscillation\",\r\n                val1: 0,\r\n                val2: -0.65,\r\n                loopDuration: 3500,\r\n            }\r\n        }\r\n    }];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.wT26Z1cjH4pFmtFO"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"ufVNOkf32f9w0iIT"}
{"name":"29 - T01 - Foul Fog (xfog)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params = \r\n[{\r\n    filterType: \"xfog\",\r\n    filterId: \"foulfog\",\r\n    color: 0xFFFFFF,\r\n    time: 0,\r\n    animated:\r\n        {\r\n            time:\r\n            {\r\n                active: true,\r\n                speed: 0.0005,\r\n                animType: \"move\"\r\n            }\r\n        }\r\n}]\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.T1cSEVif6eETPeQw"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"uvV7zR8NAhCDE7hL"}
{"name":"18 - Electric","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// Because the shader is dynamically compiled,\r\n// intensity is a one time init and can't be updated.\r\n// you must delete the filters to \"change\" it.\r\nlet params =\r\n[{\r\n    filterType: \"electric\",\r\n    filterId: \"myElectric\",\r\n    color: 0xFFFFFF,\r\n    time: 0,\r\n    blend: 1,\r\n    intensity: 5,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0020, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.YJjeB7N0L1rGfZD2"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"uwciF4YVoYl43pZ6"}
{"name":"09 - T01 - Twist (transform)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n    [{\n        filterType: \"transform\",\n        filterId: \"myTwistTransform\",\n        twRadiusPercent: 70,\n        padding: 10,\n        animated:\n        {\n            twRotation:\n            {\n                animType: \"sinOscillation\",\n                val1: -90,\n                val2: +90,\n                loopDuration: 5000,\n            }\n        }\n    }];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.OWgJD9lvBlDzXALz"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"v2S2op0GG9uMsLLm"}
{"name":"Add Treat Wounds Immunity Timer","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/clockwork.svg","scope":"global","command":"// Apply to selected token\nawait applyTreatWoundsImmunity(actor, false)\n\n// if (game.modules.get(\"combat-utility-belt\")?.active) {}\n\n// Check for an Effect from an actor\nfunction hasTreatWoundsImmunity(treatedActor) {\n\treturn Boolean(treatedActor.items.find(item => item.type === 'effect' && item.name.includes(\"Timer: Treat Wounds Immunity\")));\n}\n\nasync function applyTreatWoundsImmunity(treatedActor, useContinualRecovery = false) {\n\tconst treatedActorName = treatedActor.data.name;\n\t// const continualRecovery = actor.itemTypes.feat.some(i => i.data.name.startsWith('Continual Recovery'));\n\tlet immunityTimer = { seconds: 10 }\n\n\t// console.log(`${treatedActorName} hasTreatWoundsImmunity()? ` + hasTreatWoundsImmunity(treatedActor))\n\n\tif (!hasTreatWoundsImmunity(treatedActor)) {\n\t\timmunityTimer = { hours: 1 }\n\t\tlet timeDescription = \" for 1 hour.\"\n\n\t\tif (useContinualRecovery) {\n\t\t\timmunityTimer = { minutes: 10 }\n\t\t\ttimeDescription = \" for 10 minutes.\"\n\t\t}\n\n\t\tlet reminderID = game.Gametime.reminderIn(immunityTimer, `${treatedActorName} is no longer immune to Treat Wounds.`);\n\t\tconsole.log(`reminderID: ${reminderID}`);\n\n\t\tlet macroTimer = game.Gametime.doIn(immunityTimer, () => removeTreatWoundsImmunity(treatedActor))\n\t\tconsole.log(`macroTimer: ${reminderID}`);\n\n\t\tlet effect = game.items.getName(\"Timer: Treat Wounds Immunity\").data\n\t\tlet originalText = effect.data.description.value\n\t\tlet doc = new DOMParser().parseFromString(originalText, \"text/html\");\n\n\t\teffect.data.description.value = \"<p>\" + doc.body.innerText + timeDescription + \"</p>\"\n\n\t\tawait treatedActor.createOwnedItem(effect)\n\t\teffect.data.description.value = originalText\n\n\t\tui.notifications.warn(`Target is now immune to Treat Wounds${timeDescription}`);\n\t} else {\n\t\tui.notifications.warn(\"Target is already immune to Treat Wounds.\");\n\t}\n\n\treturn immunityTimer\n}\n\n// Remove an Effect from an actor\nasync function removeTreatWoundsImmunity(treatedActor) {\n\tlet hasTreatWoundsImmunity = treatedActor.items.find(item => item.type === 'effect' && item.name.includes(\"Timer: Treat Wounds Immunity\"));\n\n\tif (hasTreatWoundsImmunity) {\n\t\tconsole.log(hasTreatWoundsImmunity);\n\t\thasTreatWoundsImmunity.delete();\n\t\treturn true\n\t}\n\n\treturn false\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true},"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"cf":{"id":"temp_qx20rfr41e","path":"PC Macros","color":"#0068b8"}},"_id":"v5M5v55uHkYOEY1b"}
{"name":"00 - C - TMFX GUI - Book of Fire Sample","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// Big thanks to Bruno Calado!\n// You can create your own compendium, and put any effects in it\n// Just change MyCompendium below with your custom compendium\n\nconst MyCompendium = 'TokenMagic Book of Fire';\n\nconst macroVersion = 'v0.1';\n/* Simple GUI - Token Magic\n/* Author : brunocalado\nFeatures\n- Detect token selected/targeted\n- Realtime preview\nSource: \nIcon: \n*/\n//\nlet filterType;\n(async () => {\n    let msgtoken = ``;\n    if (canvas.tokens.controlled != 0) {\n        msgtoken = `<h2>Selected Token: <span style=\"color: darkred\">${canvas.tokens.controlled[0].name}</span></h2>`;\n        filterType = 'selected';\n    } else if (game.user.targets.size != 0) {\n        let t = game.user.targets.values().next().value;\n        msgtoken = `<h2>Targeted Token: <span style=\"color: darkred\">${t.name}</span></h2>`;\n        filterType = 'targeted';\n    } else {\n        ui.notifications.warn(\"Select a token!\");\n        return;\n    }\n\n    let template =\n        `<style>\n  #tokenmagic-quickpreview header {\n    background: #9c0972;\n    border-radius: 0;    \n    border: none;    \n    margin-bottom: 2px;\n    font-size: .75rem;\n  }\n  #tokenmagic-quickpreview form {\n    margin-bottom: 30px;   \n  }\n  #tokenmagic-quickpreview .window-content {    \n    height: 600px;    \n  }  \n  #tokenmagic-quickpreview .form-fields.buttons {\n    justify-content: flex-start !important;\n  }\n  #tokenmagic-quickpreview .button {\n    height: 35px;\n    box-shadow: inset 0 0 0 1px #1111FF,inset 0 0 0 1.5px var(--tertiary),inset 0 0 0 1px #1111FF;\n    font-size: 12px;\n    padding: 0;\n    background: #eb34b7;\n    color: white;\n    cursor: pointer;\n  }\n  #tokenmagic-quickpreview .button:hover {\n    box-shadow: 0 0 4px red;\n  }\n  #tokenmagic-quickpreview .meuitem input[type=\"radio\"] {\n    opacity: 0;\n    position: fixed;\n    width: 0;  \n  }\n  #tokenmagic-quickpreview .minhalista {    \n    display: inline-block;\n    list-style-type: none; \n    text-align: left; \n    margin: 0; \n    padding: 0; \n    width: 100%;\n  }\n  #tokenmagic-quickpreview .meuitem {    \n    display: inline-block;    \n    padding: 2px; \n  }  \n  #tokenmagic-quickpreview .meuitem label {    \n    cursor: pointer;    \n    margin: 0px 3px ;\n    \n    height: 100%;\n    width: 100%;\n    border-radius: 3px;\n    font-size: 16px;\n    font-family: \"Signika\", sans-serif;  \n    background: #9c0972;        \n    color: white;    \n  }\n  \n  #tokenmagic-quickpreview .radios label i {\n    margin-right: 5px;\n    color: white;\n    background: #eb34b7;\n  }\n  #tokenmagic-quickpreview .meuitem label:hover {\n    box-shadow: 0 0 14px black;\n  }\n  #tokenmagic-quickpreview .meuitem input[type=\"radio\"]:checked + label {\n    background: rgba(0, 0, 150, 0.7);\n  }\n  #tokenmagic-quickpreview .dialog-button {\n    height: 50px;\n    background: #9c0972;\n    color: white;\n    justify-content: space-evenly;\n    align-items: center;\n    cursor: pointer;\n  }\n\n  </style>\n  \n  ${msgtoken}  \n  \n  \n  <div class=\"form-fields\">\n  <ul class=\"minhalista\">\n    ${await loadMacroButton()}\n  </ul>\n  \n  </div>\n  \n  \n\n  <!------ Javascript ------->   \n  <script>  \n    ${await removeAll()}\n    ${await loadMacros(filterType)}\n  </script>`;\n\n    new Dialog({\n        title: `TMFX GUI - ${macroVersion}`,\n        content: template,\n        buttons: {\n            yes: {\n                icon: \"<i class='fas fa-check'></i>\",\n                label: \"Apply\",\n                callback: () => { }\n            },\n            clear: {\n                icon: \"<i class='fas fa-skull'></i>\",\n                label: \"Clear\",\n                callback: async (html) => {\n                    removeOnSelected(html);\n                }\n            }\n        },\n        default: \"yes\",\n        close: html => {\n        }\n    }, { id: 'tokenmagic-quickpreview' }).render(true);\n    //} ).render(true);  \n})()\n\n// ==============================\n// Main\n// ==============================\n\n\n// ==============================\n// Common Functions \n// ==============================\nasync function removeOnSelected() {\n    await TokenMagic.deleteFilters(_token);\n    await TokenMagic.deleteFiltersOnSelected(); // Delete all filters on the selected tokens/tiles\n}\n\nasync function loadMacroButton() {\n    const list_compendium = await game.packs.filter(p => p.entity == 'Macro');\n    const inside = await list_compendium.filter(p => p.metadata.label == MyCompendium)[0].getContent();\n    let msg = ``;\n    let tmp;\n    let counter = 1;\n\n    inside.map((el) => {\n        tmp = el.data.name.split(' ').join('');\n        msg += `<li class=\"meuitem\"><input type=\"radio\" name=\"Type\" id=\"${tmp.toLowerCase()}\" value=\"${tmp}\"><label for=\"${tmp.toLowerCase()}\" onclick=\"effect${counter}(1)\">${tmp}</label></li>`;\n        counter += 1;\n    });\n\n    return msg;\n}\n\nasync function loadMacros(filterType) {\n    const list_compendium = await game.packs.filter(p => p.entity == 'Macro');\n    const inside = await list_compendium.filter(p => p.metadata.label == MyCompendium)[0].getContent();\n    let msg = ``;\n    let tmp;\n    let counter = 1;\n\n    inside.map((el) => {\n        let macro = el.data.command;\n        if (filterType == 'selected') {\n            macro = macro.replace(\"OnTargeted\", \"OnSelected\");\n        } else {\n            macro = macro.replace(\"OnSelected\", \"OnTargeted\");\n        }\n        tmp = el.data.name.split(' ').join('');\n        msg += `async function effect${counter}() {`;\n        msg += `await removeOnSelected();`;\n        msg += `${macro}`;\n        msg += `}`;\n        counter += 1;\n    });\n    return msg;\n}\n\nfunction removeAll() {\n    const clean = `async function removeOnSelected() {await TokenMagic.deleteFilters(_token);await TokenMagic.deleteFiltersOnSelected()}`;\n    return clean;\n}","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Macro.XRWXP76FjjOWRd5t"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"vBU833sBPCHv7q9k"}
{"name":"32 - T02 - Devoured by the Bewitched Flames (ripples+glow)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params = \r\n[{\r\n    filterType: \"ripples\",\r\n    filterId: \"SolarRipples\",\r\n    color: 0x508000,\r\n    time: 0,\r\n    alphaDiscard: true,\r\n    zOrder:50,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0009, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n},\r\n{\r\n    filterType: \"glow\",\r\n    filterId: \"glowripples\",\r\n    outerStrength: 2,\r\n    innerStrength: 1,\r\n    color: 0xFF3000,\r\n    quality: 0.5,\r\n    padding: 10,\r\n    zOrder: 100,\r\n    animated:\r\n    {\r\n        color: \r\n        {\r\n           active: true, \r\n           loopDuration: 3000, \r\n           animType: \"colorOscillation\", \r\n           val1:0xFF3000, \r\n           val2:0x30FF00\r\n        }\r\n    }\r\n}]\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.v9CPcenfjU6hH5mO"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"vZjhbsbhyd9rW7tU"}
{"name":"24 - T01 - Hexa Force Field","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"field\",\r\n    filterId: \"myHexaField\",\r\n    shieldType: 2,\r\n    gridPadding: 2,\r\n    color: 0xCC00CC,\r\n    time: 0,\r\n    blend: 3,\r\n    intensity: 1,\r\n    lightAlpha: 0.5,\r\n    lightSize: 0.5,\r\n    scale: 0.5,\r\n    radius: 1,\r\n    chromatic: false,\r\n    alphaDiscard: true,\r\n    zOrder: 5000,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.sbP8KX50YRYtxVyB"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"wHih6z06oFlwFkHv"}
{"name":"35 - T03 - Sparks (xfire)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n[{\r\n    filterType: \"xfire\",\r\n    filterId: \"mySparksXFire\",\r\n    time: 0,\r\n    blend: 2,\r\n    amplitude: 0.7,\r\n    dispersion: 0,\r\n    chromatic: false,\r\n    scaleX: 2,\r\n    scaleY: 2,\r\n    inlay: false,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: -0.0015, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.GKxtep2eo55zKl1Z"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"wORm9zrX4PDEzfme"}
{"name":"C - Electric Multi-Filters","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// works better with tokens or tiles with no shadows\r\nlet params =\r\n[{\r\n    filterType: \"shadow\",\r\n    blur: 2,\r\n    quality: 5,\r\n    distance: 0,\r\n    alpha: 1.,\r\n    padding: 100,\r\n    color: 0xFFFFFF,\r\n    animated:\r\n    {\r\n        blur:     \r\n        { \r\n           active: true, \r\n           loopDuration: 500, \r\n           animType: \"syncCosOscillation\", \r\n           val1: 2, \r\n           val2: 4\r\n        },\r\n     }\r\n},\r\n{\r\n    filterType: \"electric\",\r\n    color: 0xFFFFFF,\r\n    time: 0,\r\n    blend: 2,\r\n    intensity: 5,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0020, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}];\r\n\r\nTokenMagic.addFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.Ia0tPcllVQq96yXF"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"wVHXzX0gluH3Vbvu"}
{"name":"Show GM Screen","type":"script","author":"oiPWLVPNH7xQBULr","img":"stuff/Gm_Screen.jpg","scope":"global","command":"let journal = game.journal.getName(\"!GM Screen\");\n\nif (journal.sheet.rendered) \n\n  journal.sheet.close();\n\nelse\n\n  journal.sheet.render(true)","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"cf":{"id":"temp_w4f9l9idxk","path":"GM Macros","color":"#940000"}},"_id":"wlMkpgkRmL6CVLFK"}
{"name":"Roll Secret Perception Checks","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/magic/perception/eye-ringed-green.webp","scope":"global","command":"// TODO: Add option to select DC by level or default to PC APL?\nlet DCbyLevel = [14, 15, 16, 18, 19, 20, 22, 23, 24, 26, 27, 28, 30, 31, 32, 34, 35, 36, 38, 39, 40, 42, 44, 46, 48, 50]\nlet pcLevels = 0;\n\nconst ownedTokens = canvas.tokens.ownedTokens\n            .filter(t => t.actor.hasPlayerOwner)\n            .filter(t => t.actor.data.type == \"character\")\n\nownedTokens.forEach(token => pcLevels = pcLevels + token.actor.data.data.details.level.value);\n\nconst apl = Math.round(pcLevels / ownedTokens.length);\nconst partyLvlDC = DCbyLevel[apl]\n\n// TODO: Add PC Stealth DC's if rolling for NPC?\n\nasync function postSave($html) {\n    const DC = parseInt($html.find('[name=\"dc\"]')[0].value) || 0;\n    // const traits = $html.find('[name=\"traits\"]')[0].value || '';\n    // const flavor = $html.find('[name=\"flavor\"]')[0].value || '';\n    \n\tconst SEARCH_UUID = \"Compendium.world.pf2e-exploration-effects-nerps.XiVLHjg5lQVMX8Fj\"; // Search\n\n    let dcText = '';\n    if(DC > 0) {\n        dcText = `<b>DC ${DC}</b> `\n    }\n\n\n    let tokenList = canvas.tokens.controlled\n        .filter(t => t.actor.hasPlayerOwner)\n        .filter(t => t.actor.data.type == \"character\");\n    \n    let messageContent = `<p>Rolling Secret ${dcText}Perception checks for selected PC's.</p><hr><p>${tokenList.map(t => \" \" + t.actor.name)}</p>`;\n    \n    // OK, you didn't select any PC tokens, lets check for NPC's only?\n    if(tokenList.length == 0) {\n        // console.log(\"TEST\", canvas.tokens)\n        tokenList = canvas.tokens.controlled\n            .filter(t => t.actor.data.type == \"npc\");\n    \n        messageContent = `<p>Rolling Secret ${dcText}Perception checks for selected NPC's.</p><hr><p>${tokenList.map(t => \" \" + t.actor.name)}</p>`;\n    }\n    \n    \n    // Ok, you didn't select any tokens so I assume you want all PC's that are \"Searching\"\n    if(tokenList.length == 0) {\n        console.log(canvas.tokens)\n        // tokenList = canvas.tokens.ownedTokens\n        \n        tokenList = canvas.tokens.ownedTokens\n            .filter(t => t.actor.hasPlayerOwner)\n            .filter(t => t.actor.data.type == \"character\")\n            .filter(t => t.actor.itemTypes.effect.find((e) => e.data.flags.core?.sourceId === SEARCH_UUID));\n    \n        messageContent = `<p>Rolling Secret ${dcText}Perception checks for PC's using the @Compendium[pf2e.actionspf2e.TiNDYUGlMmxzxBYU]{Search} Exploration Activity.</p><hr><p>${tokenList.map(t => \" \" + t.actor.name)}</p>`;\n    }\n    \n    // OK, so there are NO PC's searching, I assume you aren't doing exploration mode\n    // OR your party is really dumb and has NO BODY keeping an eye out? Which in that case, why\n    // roll perception? Ok, maybe you have your reasons, here, I'll roll for ALL PC's then...\n    if(tokenList.length == 0) {\n        console.log(canvas.tokens)\n        // tokenList = canvas.tokens.ownedTokens\n        \n        tokenList = canvas.tokens.ownedTokens\n            .filter(t => t.actor.hasPlayerOwner)\n            .filter(t => t.actor.data.type == \"character\");\n    \n        messageContent = `<p>Rolling Secret ${dcText}Perception checks for all PC's.</p><hr><p>${tokenList.map(t => \" \" + t.actor.name)}</p>`;\n    }\n    \n    // create the message and output to chat\n    if (messageContent !== '') {\n\t    let chatData = {\n\t\t    blind: true,\n\t\t    user: game.user._id,\n\t\t    speaker: ChatMessage.getSpeaker(game.user.name),\n\t\t    whisper: ChatMessage.getWhisperRecipients(game.user.name),\n\t\t    content: messageContent,\n\t    };\n\t    ChatMessage.create(chatData, {});\n    }\n    \n    for (let token of tokenList) {\n        const tokenActor = token.actor\n        const checkMod = new game.pf2e.CheckModifier(`<span class=\"pf2-icon\">A</span> <b>Search</b> - <p class=\"compact-text\">Perception Check</p>`, tokenActor.data.data.attributes.perception);\n        const rollMode = 'whisper: \"Jamz\"'\n        let options = actor.getRollOptions(['all', 'wis-based', 'perception'])\n        options.push(\"action:search\"); // add more traits here in new lines\n        options.push(\"secret\");\n\n        if(DC > 0) {\n            game.pf2e.Check.roll(checkMod, {type: \"perception-check\", actor: tokenActor, options: options, rollMode, skipDialog: true, dc: {value: DC}}, null);    \n        } else {\n            game.pf2e.Check.roll(checkMod, {type: \"perception-check\", actor: tokenActor, options: options, rollMode, skipDialog: true}, null);   \n        }\n    }\n}\n\nconst dialog = new Dialog({\n    title: 'Set Perception DC',\n    content: `\n        <form>\n        <div class=\"form-group\">\n            <label>DC: (APL DC ${partyLvlDC})</label>\n            <input id=\"dc\" name=\"dc\" type=\"number\"/>\n        </div>\n        `\n        ,\n    buttons: {\n        yes: {\n            label: 'Roll Perception Checks',\n            callback: postSave,\n        },\n        no: {\n            label: 'Cancel',\n        },\n    },\n    default: 'yes',\n    render: html => html.find('#dc').focus()\n});\n\ndialog.render(true);","folder":null,"sort":0,"flags":{"exportSource":{"world":"age-of-ashes","system":"pf2e","coreVersion":"0.7.9","systemVersion":"1.10.25.2784"},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_w4f9l9idxk","path":"GM Macros","color":"#940000"}},"_id":"x0W7ScATL0nBK9FW","ownership":{"default":0,"oiPWLVPNH7xQBULr":3},"_stats":{"systemId":"pf2e","systemVersion":"4.0.6","coreVersion":"10.285","createdTime":null,"modifiedTime":1663521749468,"lastModifiedBy":"bvlTPmzDPuQBXfIC"}}
{"name":"Process Persistent Damage","type":"script","author":"oiPWLVPNH7xQBULr","img":"systems/pf2e/icons/conditions/persistentDamage.webp","scope":"global","command":"PF2EPersistentDamage.processPersistentDamage(canvas.tokens.controlled);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"cf":{"id":"temp_w4f9l9idxk","path":"GM Macros","color":"#940000"}},"_id":"x84PaWKV26WQZcsz"}
{"name":"Export Compendium Mapping","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"// https://gitlab.com/-/snippets/2138719\n\nconst folderName = encodeURL(`${game.system.id}CompendiumMappingBackup`)\n\ntry {\n    FilePicker.createDirectory('data', folderName, {});\n} catch (error) { return\n}\n\nui.notifications.info(\"Starting export, this may take a few moments.\")\n\nasync function exportMapping(gamePack){\n    const pack = game.packs.get(gamePack);\n    const actors = await pack.getDocuments();\n    const mappedImages = actors.map(a => ({id: a.id, img: a.img, data: { token:{ img: a.data.token.img, randomImg: a.data.token.randomImg, scale: a.data.token.scale}}}));\n    const fileName = encodeURI(`${gamePack}.json`);\n    const file = new File([JSON.stringify(mappedImages, null, '')], fileName, { type: 'application/json'});\n    await FilePicker.upload('data', folderName, file)\n}\n\nconst gamePacks = game.packs.filter(entry => entry.documentName === \"Actor\")\n\nfor (let pack of gamePacks) {\n    let gamePack = pack.collection;\n\n    await exportMapping(gamePack);\n}\n\nui.notifications.info(\"done\")","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_jgmri56d4gm","path":"System Macros","color":"#02ac24"}},"_id":"xEWrtwcCZEJ5Y3UH"}
{"name":"Reset Path","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"const combat = game.combats.active;\nconst combatant = combat.turns[combat.turn];\nconst flags = {trackedRound: 0, rulerState: null};\nimport(\"/modules/drag-ruler/src/socket.js\").then(module => module.updateCombatantDragRulerFlags(combat, combatant, flags));","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"advanced-macros":{"runAsGM":false},"cf":{"id":"temp_5lpecs4iq07","path":"Under Construction","color":"#e68600"}},"_id":"yQjEBK2I3dFLwpfL"}
{"name":"33 - T01 - Evade Stance (transform)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\r\n    [{\r\n        filterType: \"transform\",\r\n        filterId: \"dodgeStance\",\r\n        padding: 50,\r\n        animated:\r\n        {\r\n            translationX:\r\n            {\r\n                animType: \"sinOscillation\",\r\n                val1: -0.125,\r\n                val2: +0.125,\r\n                loopDuration: 1400,\r\n            },\r\n            translationY:\r\n            {\r\n                animType: \"cosOscillation\",\r\n                val1: -0.035,\r\n                val2: +0.035,\r\n                loopDuration: 1400,\r\n            }\r\n        }\r\n    }];\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Compendium.tokenmagic.tmMacros.0U6lS2hR1uMm7iFI"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"zHG1T8lRks8H5DJg"}
{"name":"D - Auto-Destroy Example","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params = \r\n[{\r\n    filterType: \"bevel\",\r\n    autoDestroy: true,\r\n    rotation: 0,\r\n    thickness: 5,\r\n    lightColor: 0x00FF00,\r\n    lightAlpha: 0.7,\r\n    shadowColor: 0xFF0000,\r\n    shadowAlpha: 0.4,\r\n    animated :\r\n    {\r\n       rotation: \r\n       { \r\n          active: true,\r\n          clockWise: true, \r\n          loopDuration: 1000,\r\n          loops: 5,\r\n          animType: \"rotation\"\r\n       }\r\n    }\r\n}];\r\n\r\nTokenMagic.addFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.HjzhkTFUng8sxWkH"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"zMAfnm9ysnDAWdSZ"}
{"name":"24 - T11 - Grid Force Field 2 - Chromatic","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params =\n[{\n    filterType: \"field\",\n    filterId: \"myGridField\",\n    shieldType: 11,\n    gridPadding: 2,\n    color: 0xC1C1C1,\n    time: 0,\n    blend: 2,\n    intensity: 1,\n    lightAlpha: 0,\n    lightSize: 0.3,\n    scale: 0.5,\n    radius: 1,\n    chromatic: true,\n    alphaDiscard: true,\n    discardThreshold: 0.3,\n    zOrder: 512,\n    animated :\n    {\n      time : \n      { \n        active: true, \n        speed: 0.0009, \n        animType: \"move\" \n      }\n    }\n}];\n\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Macro.3cAW4Jy8eXV4IvlZ"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}},"_id":"zfj9qZVbtR1ZRxk0"}
{"_id":"zjf6mYT0iZQzFjlT","name":"32 - T01 - Solar Ripples (ripples)","type":"script","author":"oiPWLVPNH7xQBULr","img":"icons/svg/dice-target.svg","scope":"global","command":"let params = \r\n[{\r\n    filterType: \"ripples\",\r\n    filterId: \"SolarRipples\",\r\n    color: 0xCC9000,\r\n    time: 0,\r\n    alphaDiscard: false,\r\n    animated :\r\n    {\r\n      time : \r\n      { \r\n        active: true, \r\n        speed: 0.0009, \r\n        animType: \"move\" \r\n      }\r\n    }\r\n}]\r\n\r\nTokenMagic.addUpdateFiltersOnSelected(params);","folder":null,"sort":0,"permission":{"default":0,"oiPWLVPNH7xQBULr":3},"flags":{"core":{"sourceId":"Compendium.tokenmagic.tmMacros.qMZ03TZJuNYwudlg"},"cf":{"id":"temp_whysdkezapj","path":"FX Macros","color":"#f52493"}}}
