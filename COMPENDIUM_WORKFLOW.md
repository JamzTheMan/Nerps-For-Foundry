# Compendium Workflow Guide

## Overview

This module uses Foundry VTT's LevelDB format for compendium storage. LevelDB automatically generates and updates
various database files when Foundry accesses or modifies compendium data.

## Auto-Generated Files (Ignored by Git)

The following files are automatically generated by Foundry VTT and should **NOT** be tracked in version control:

- `*.idb` - Index database files
- `*.ldb` - LevelDB data files
- `CURRENT` - Current manifest pointer
- `LOG` and `LOG.*` - Database operation logs
- `MANIFEST-*` - Database state metadata
- `lost/` folder - Recovery files for potential corruption
- `*.bak` - Backup files

These patterns are already configured in `.gitignore` and will be ignored by git.

## Working with Compendia

### Development Workflow

1. **Edit in Foundry VTT**
    - Open your test world in Foundry VTT
    - Edit compendium content directly in the UI
    - Lock compendia when not actively editing to prevent unnecessary updates

2. **What Gets Tracked**
    - Only the "source of truth" compendium structure files are tracked
    - LevelDB files will be regenerated automatically by Foundry
    - Your actual compendium data is preserved in the `.ldb` files locally

3. **Git Operations**
    - When you commit/push, LevelDB files are ignored
    - When others pull your changes, Foundry will regenerate the necessary database files
    - The compendium data is still shared through the LevelDB files

### Locking Compendia

To prevent unnecessary database updates:

1. Right-click a compendium in Foundry VTT
2. Select "Configure"
3. Check "Lock compendium"
4. Unlock only when you need to edit

## Troubleshooting

### Files Keep Showing as Modified

If you see `.idb`, `.ldb`, `MANIFEST-*`, `CURRENT`, or `LOG` files showing as modified:

1. Verify `.gitignore` includes the patterns shown above
2. Run: `git status --ignored` to see if they're being ignored
3. If they were previously tracked, remove them: `git rm --cached <file>`

### Lost Folder Growing

The `lost/` folder contains recovery manifests. This is normal LevelDB behavior. The folder is ignored by git and can be
safely deleted if it grows too large (Foundry will recreate it as needed).

### Compendium Data Not Syncing

Remember that the LevelDB `.ldb` files contain your actual data. These files are ignored by git, which means:

- **For version control**: Only structural changes are tracked
- **For deployment**: Foundry regenerates databases from module structure
- **For backups**: Include the `.ldb` files in your backup strategy

## Alternative: JSON Source Format

For better version control (future consideration), you could use JSON source files with the Foundry CLI:

```bash
# Export compendium to JSON
fvtt package unpack --type Item --name shared-items

# Import JSON to compendium  
fvtt package pack --type Item --name shared-items
```

This would allow you to track human-readable JSON files instead of binary LevelDB files.

## Current Setup

✅ `.gitignore` configured to ignore all LevelDB auto-generated files  
✅ Previously tracked LevelDB files removed from git history  
✅ Working tree is clean and ready for development

You can now work normally in Foundry VTT without worrying about these files cluttering your git status!
